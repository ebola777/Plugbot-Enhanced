/**
 * @license
 * Copyright (C) 2013-2014  Shawn
 * This program is licensed under the MIT license.
 */

define("plugbot/controllers/module",["angular"],function(t){return t.module("app.controllers",[])}),define("plugbot/controllers/MainCtrl",["plugbot/controllers/module"],function(t){t.controller("MainCtrl",["$scope","Settings","SiteApi",function(t,e,n){var i=e.read().main;t.items=[{id:"autoWoot",text:"Auto Woot",click:function(t){n.autoWoot(t)}},{id:"autoJoin",text:"Auto Join",click:function(t){n.autoJoin(t)}}],t.isEnabled=function(t){return i[t.id]},t.switchEnabled=function(t){var n=!i[t.id];t.click&&t.click(n),i[t.id]=n,e.save()},t.handleButtonClick=function(){return"toggle"},_.each(t.items,function(t){t.click(i[t.id])})}])}),define("plugbot/controllers/SettingsCtrl",["plugbot/controllers/module"],function(t){t.controller("SettingsCtrl",["$scope","$window","Settings",function(t,e,n){t.items=[{text:"Reset Settings",click:function(){e.confirm("Reset Settings?\nPlease Reload the Page Immediately after Resetting.")&&n.reset()}}],t.handleButtonClick=function(){return"hide"}}])}),define("plugbot/controllers/index",["plugbot/controllers/MainCtrl","plugbot/controllers/SettingsCtrl"],_.identity),define("plugbot/directives/module",["angular"],function(t){return t.module("app.directives",[])}),define("plugbot/directives/draggable",["plugbot/directives/module","angular"],function(t,e){t.directive("draggable",["$document","$window","DomGeometry","Settings",function(t,n,i,o){return{restrict:"A",scope:{dragGrid:"&"},controller:["$scope",function(t){t.settings=o.read(),t.saveSettings=function(){o.save()}}],link:function(o,a,r){function l(){var t=C.iframe,e=t.css("pointer-events");t.css("pointer-events","none"),I.originalPointerEvents=e}function s(){var t=C.iframe;t.css("pointer-events",I.originalPointerEvents)}function d(){C.id&&I.currentPosition&&(R[C.id]=I.currentPosition,o.saveSettings())}function c(t){a.css("z-index",t)}function u(t,e){var n=e.outerWidth(),i=e.outerHeight();return{left:t.x,top:t.y,right:t.x+n,bottom:t.y+i,width:n,height:i}}function g(t){var e,n,o,r=C.containment,l={x:t.x,y:t.y};return C.grid&&(l.x-=l.x%C.grid[0],l.y-=l.y%C.grid[1]),_.each(C.snap,function(t){var e=i.getSnap(t,u(l,a),C.snapMode,C.snapTolerance);(e.x||e.y)&&(l.x+=e.x,l.y+=e.y)}),r.length&&(e=u(l,a),n=i.isContain(r,e),n.x&&n.y||(o=i.getRestraint(r,e),n.x||(l.x=o.left),n.y||(l.y=o.top))),l}function p(t){var e=!0,n=u(t,a),o=C.containment;return o.length&&(e=i.isContain(o,n)),e&&_.each(C.elemNoOverlap,function(t){e&&(e=!i.isIntersect(t,n))}),e}function f(t){I.currentPosition=t,a.css({left:t.x,top:t.y})}function m(t){var e=g(t);p(e)&&f(e)}function h(){o.$apply(function(){var t,e,n,i=C.elemKeepZoom;i.length&&(t={width:i.width(),height:i.height()},e={width:t.width/I.originalKeepZoomSize.width,height:t.height/I.originalKeepZoomSize.height},n={x:I.currentPosition.x*e.width,y:I.currentPosition.y*e.height},n=g(n),p(n)&&f(n),I.originalKeepZoomSize=t)})}function v(){o.$apply(function(){var t=I.currentMouseOffset,e={x:k.scrollLeft()-S.x,y:k.scrollTop()-S.y},n={x:y.x+t.x+e.x,y:y.y+t.y+e.y};I.currentScrollOffset=e,m(n)})}function b(t){var e=I.currentScrollOffset,n={x:t.clientX-w.x,y:t.clientY-w.y},i={x:y.x+n.x+e.x,y:y.y+n.y+e.y};return I.currentMouseOffset=n,m(i),!1}function x(){c(I.originalZIndex),s(),d(),k.unbind("scroll",v),t.unbind("mousemove",b),t.unbind("mouseup",x)}var y,w,S,C,I,R=o.settings.window,k=e.element(n),$=a.find(r.dragHandle)||a;a.css({position:"absolute"}),C={id:r.dragId,zIndex:r.dragZIndex,containment:e.element(r.dragContainment),containmentTolerance:r.dragContainmentTolerance,iframe:e.element(r.dragIframeFix),grid:o.dragGrid(),snap:e.element(r.dragSnap),snapMode:r.dragSnapMode,snapTolerance:r.dragSnapTolerance||8,elemNoOverlap:e.element(r.dragNoOverlap),elemKeepZoom:e.element(r.dragKeepZoom)},C.elemKeepZoom.length&&(I={originalKeepZoomSize:{width:C.elemKeepZoom.width(),height:C.elemKeepZoom.height()}}),R[C.id]&&p(R[C.id])&&f(R[C.id]),k.bind("resize",h),$.bind("mousedown",function(n){return y={x:a.prop("offsetLeft"),y:a.prop("offsetTop")},w={x:n.clientX,y:n.clientY},S={x:k.scrollLeft(),y:k.scrollTop()},_.extend(C,{containment:e.element(r.dragContainment),iframe:e.element(r.dragIframeFix),snap:e.element(r.dragSnap),elemNoOverlap:e.element(r.dragNoOverlap),elemKeepZoom:e.element(r.dragKeepZoom)}),_.extend(I,{currentMouseOffset:{x:0,y:0},currentScrollOffset:{x:0,y:0},currentPosition:void 0,originalZIndex:a.css("z-index"),originalPointerEvents:void 0}),c(C.zIndex),l(),k.bind("scroll",v),t.bind("mousemove",b),t.bind("mouseup",x),!1}),a.on("$destroy",function(){k.unbind("resize",h)})}}}])}),define("plugbot/directives/window",["plugbot/directives/module","angular"],function(t,e){t.directive("window",function(){return{restrict:"A",link:function(t,n,i){function o(t,i){var o=e.element(t.data("window-toggle"));o.length?o[i]():n[i]()}function a(n){t.$apply(function(){var i,a=e.element(n.target);t.handleButtonClick&&(i=t.handleButtonClick(a.data("window-id")),o(a,i))})}var r,l=n.find(".handle-buttons");i.window&&n[i.window](),l.length&&(r=l.children(),r.length&&r.bind("click",a)),n.on("$destroy",function(){r.unbind("click",a)})}}})}),define("plugbot/directives/index",["plugbot/directives/draggable","plugbot/directives/window"],_.identity),define("plugbot/services/module",["angular"],function(t){return t.module("app.services",[])}),define("plugbot/services/utils/DomGeometry",["plugbot/services/module","angular"],function(t,e){t.factory("DomGeometry",["$window",function(t){return{isContainRect:function(t,e){var n={x:!1,y:!1};return t.left-e.left<=0&&e.right-t.right<=0&&(n.x=!0),t.top-e.top<=0&&e.bottom-t.bottom<=0&&(n.y=!0),n},isIntersectRect:function(t,e){return t.left-e.right<0&&e.left-t.right<0&&t.top-e.bottom<0&&e.top-t.bottom<0},isContain:function(t,e){var n=this.getBoundingRect(t),i=this.getBoundingRect(e);return this.isContainRect(n,i)},isIntersect:function(t,e){var n=this.getBoundingRect(t),i=this.getBoundingRect(e);return this.isIntersectRect(n,i)},getSnap:function(t,e,n,i){var o,a,r=this.getBoundingRect(t),l=this.getBoundingRect(e),s=["left","right"],d=["top","bottom"],c=[],u={x:0,y:0};for(("inner"===n||"both"===n)&&c.push([0,0],[1,1]),("outer"===n||"both"===n)&&c.push([0,1],[1,0]),o=0;o<c.length;o+=1)a=r[s[c[o][0]]]-l[s[c[o][1]]],Math.abs(a)<=i&&r.top<=l.bottom&&l.top<=r.bottom&&(u.x+=a),a=r[d[c[o][0]]]-l[d[c[o][1]]],Math.abs(a)<=i&&r.left<=l.right&&l.left<=r.right&&(u.y+=a);return u},getRestraint:function(t,e){var n=this.getBoundingRect(t),i=this.getBoundingRect(e),o=this.isContainRect(n,i),a=i;return o.x||(i.left<n.left?(a.left=n.left,a.right=n.left+i.width):(a.right=n.right,a.left=n.right-i.width)),o.y||(i.top<n.top?(a.top=n.top,a.bottom=n.top+i.height):(a.bottom=n.bottom,a.top=n.bottom-i.height)),a},offsetRect:function(t,e){e=_.clone(e),_.defaults(e,{x:0,y:0}),t.left+=e.x,t.right+=e.x,t.top+=e.y,t.bottom+=e.y},getBoundingRect:function(n){var i,o=e.element(t),a=["left","right","top","bottom","width","height"],r={x:o.scrollLeft(),y:o.scrollTop()};return n instanceof e.element?(i=_.pick(n[0].getBoundingClientRect(),a),this.offsetRect(i,r)):n instanceof HTMLElement?(i=_.pick(n.getBoundingClientRect(),a),this.offsetRect(i,r)):i=n,i}}}])}),define("plugbot/services/Export",["plugbot/services/module","angular"],function(t,e){t.factory("Export",["$window","Settings",function(t,n){t.plugbot={dev:{getSiteHighestZIndex:function(){var t=e.element("#audience, #dj-booth, #playback-container, #dj-button, #vote, .app-right"),n={element:null,zIndex:-1};return _.each(t,function(t){var i=e.element(t).css("z-index");i>n.zIndex&&(n={element:t,zIndex:i})}),n}},resetSettings:function(){n.reset()}}}])}),define("plugbot/services/DomInjection",["plugbot/services/module","angular"],function(t,e){t.factory("DomInjection",["$templateCache",function(t){var n=e.element("#app");n.append(t.get("main.tpl.html")),n.append(t.get("settings.tpl.html"))}])}),define("plugbot/services/Settings",["plugbot/services/module"],function(t){t.factory("Settings",["$window",function(t){var e,n="plugbotEnhanced",i=t.localStorage,o={main:{autoWoot:!0,autoJoin:!1},window:{main:{x:70,y:85},settings:{x:80,y:100}}};return{read:function(){var t;return e?t=e:(t=i[n]?JSON.parse(i[n]):this._clone(),e=t),t},save:function(){this._debounceSave()},reset:function(){delete i[n]},_debounceSave:_.debounce(function(){i[n]=JSON.stringify(e)},1e3),_clone:function(){return JSON.parse(JSON.stringify(o))}}}])}),define("plugbot/services/SiteApi",["plugbot/services/module","angular"],function(t,e){t.factory("SiteApi",["$interval","$window",function(t,n){var i,o,a=n.API,r=e.element("#woot");return{woot:function(){var e=this;this.stopWoot(),i=t(function(){var t=a.getUser().vote;0===t?r.click():e.stopWoot()},1e3)},join:function(){var e=this;this.stopJoin(),o=t(function(){var t=a.djJoin();t||e.stopJoin()},1e3)},stopWoot:function(){t.cancel(i)},stopJoin:function(){t.cancel(o)},autoWoot:function(t){t?(a.on(a.ADVANCE,this.woot,this),this.woot()):(a.off(a.ADVANCE,this.woot),this.stopWoot())},autoJoin:function(t){t?(a.on(a.WAIT_LIST_UPDATE,this.join,this),this.join()):(a.off(a.WAIT_LIST_UPDATE,this.join),this.stopJoin())},destroy:function(){this.autoWoot(!1),this.autoJoin(!1)}}}])}),define("plugbot/services/index",["plugbot/services/utils/DomGeometry","plugbot/services/Export","plugbot/services/DomInjection","plugbot/services/Settings","plugbot/services/SiteApi"],_.identity),angular.module("app.views",["main.tpl.html","settings.tpl.html"]),angular.module("main.tpl.html",[]).run(["$templateCache",function(t){t.put("main.tpl.html",'<div class="plugbot-window plugbot-main"\n     data-window\n     data-draggable\n     data-drag-id="main"\n     data-drag-z-index="1000000"\n     data-drag-containment="#app"\n     data-drag-iframe-fix="#yt-frame"\n     data-drag-handle=".handle"\n     data-drag-grid="[4, 4]"\n     data-drag-snap=".app-header, #audience, #dj-booth, #playback-container, #dj-button, #vote, .app-right, #footer"\n     data-drag-snap-mode="outer"\n     data-drag-snap-tolerance="8"\n     data-drag-no-overlap=".app-header, #footer"\n     data-drag-keep-zoom="#app"\n     data-ng-controller="MainCtrl">\n    <div class="handle">\n        <span class="title">Plugbot</span>\n        <span class="handle-buttons">\n            <i class="icon icon-settings-white" data-window-id="settings" data-window-toggle=".plugbot-settings"></i>\n        </span>\n    </div>\n    <div class="body">\n        <ul>\n            <li class="item"\n                data-ng-class="{ \'enabled\': isEnabled(item) }"\n                data-ng-repeat="item in items"\n                data-ng-click="switchEnabled(item)">{{item.text}}</li>\n        </ul>\n    </div>\n</div>\n')}]),angular.module("settings.tpl.html",[]).run(["$templateCache",function(t){t.put("settings.tpl.html",'<div class="plugbot-window plugbot-settings"\n     data-window="hide"\n     data-draggable\n     data-drag-id="settings"\n     data-drag-z-index="1000000"\n     data-drag-containment="#app"\n     data-drag-iframe-fix="#yt-frame"\n     data-drag-handle=".handle"\n     data-drag-grid="[8, 8]"\n     data-drag-snap="#app"\n     data-drag-snap-mode="inner"\n     data-drag-snap-tolerance="16"\n     data-drag-no-overlap=".app-header, #footer"\n     data-drag-keep-zoom="#app"\n     data-ng-controller="SettingsCtrl">\n    <div class="handle">\n        <span class="title">Settings</span>\n        <span class="handle-buttons">\n            <i class="icon icon-dialog-close" data-window-id="close"></i>\n        </span>\n    </div>\n    <div class="body">\n        <ul>\n            <li class="item"\n                data-ng-repeat="item in items"\n                data-ng-click="item.click()">{{item.text}}</li>\n        </ul>\n    </div>\n</div>\n')}]),define("plugbot/views/index",function(){}),define("plugbot/app",["angular","plugbot/controllers/index","plugbot/directives/index","plugbot/services/index","plugbot/views/index"],function(t){var e=t.module("app",["app.controllers","app.directives","app.services","app.views"]);return e.run(["DomInjection","Export",_.identity]),e}),require(["angular"],function(t){require(["domReady!","plugbot/app"],function(){t.bootstrap(t.element("#app"),["app"])})}),define("main",function(){});