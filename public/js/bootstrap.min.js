/**
 * Site bootstrap
 * Load order: bootstrap.js -> main.js -> app.js
 *
 * @license
 * Copyright (C) 2013-2014  Shawn
 * This program is licensed under the MIT license.
 */

var VAR_AUTO_DEBUG=!0,REMOTE_REPO=!1;!function(){var e=function(){return{DOMAIN:"plug.dj",DEBUG:VAR_AUTO_DEBUG,TIMEOUT_LOADING:5e3,INTERVAL_WAIT_DEPS:1e3,INTERVAL_RETRY:1e3,MAX_NUM_RETRIES:2,PROTOCOL:"https://",isAborted:!1,numFiles:void 0,numLoadedFiles:0,loadedFiles:{},excludedPaths:["/","/dashboard"],requiredVariables:["require","define","jQuery","_","API"],dirs:{script:"js/",stylesheet:"css/",vendor:"vendor/"},baseDirs:{debug:"localhost/Plugbot-Enhanced/assets/",release:REMOTE_REPO?"localhost/Plugbot-Enhanced/public/":"localhost/not-found/"},files:{debug:"main.js",release:"main.min.js"},scripts:[],stylesheets:["project!style.css"],init:function(){var e=this;this.verifySite()?(this.DEBUG&&console.info("Plugbot Initializing..."),this.removeBookmarkScript(),this.waitCore(function(){e.waitRoom(function(){e.loadFiles()})})):console.warn("Plugbot Not Bootstrapped Because of Wrong Url.")},config:function(){var e=this.PROTOCOL+(this.DEBUG?this.baseDirs.debug:this.baseDirs.release),t=this.PROTOCOL+this.baseDirs.release+this.dirs.vendor;requirejs.config({paths:{angular:"https://ajax.googleapis.com/ajax/libs/angularjs/1.2.23/angular.min",ngStorage:t+"ngstorage/js/ngStorage.min",domReady:t+"requirejs-domready/js/domReady.min",plugbot:e+this.dirs.script},shim:{angular:{exports:"angular"}}})},loadApp:function(){var e=this,t=this.PROTOCOL+(this.DEBUG?this.baseDirs.debug:this.baseDirs.release),i=this.DEBUG?this.files.debug:this.files.release,s=t+this.dirs.script+i;this.config(),require(["angular"],function(){require([s],function(){e.DEBUG&&console.info("Plugbot Bootstrapped.")})})},loadFiles:function(){function e(e,n,r){var a,l;for(t=0;t<e.length;t+=1)a=e[t],l=a.substr(0,o.length),n.push(o===l?s+r+a.substr(a.length-o.length-1):i.PROTOCOL+a)}var t,i=this,s=this.PROTOCOL+(this.DEBUG?this.baseDirs.debug:this.baseDirs.release),o="project!",n=[],r=[];for(e(this.scripts,n,this.dirs.script),e(this.stylesheets,r,this.dirs.stylesheet),this.numFiles=n.length+r.length,t=0;t!==n.length;t+=1)this.loadScript(n[t]);for(t=0;t!==r.length;t+=1)this.loadStylesheet(r[t]);0===this.numFiles&&this.loadApp()},loadScript:function(e,t){var i=this;this.getScript(e,{timeout:this.TIMEOUT_LOADING},function(){i.isAborted||i.fileDone(e)},function(s){i.isAborted||(t=t||0,t===i.MAX_NUM_RETRIES?i.fileFail(e,{error:s.status}):setTimeout(function(){i.isAborted||i.isFileLoaded(e)||i.loadScript(e,t+1)},i.INTERVAL_RETRY))})},loadStylesheet:function(e,t){var i=this;this.getCss(e,{timeout:this.TIMEOUT_LOADING,"class":"plugbot-css"},function(){i.isAborted||i.fileDone(e)},function(){i.isAborted||(t=t||0,t===i.MAX_NUM_RETRIES?i.fileFail(e,{error:"Timeout"}):setTimeout(function(){i.isAborted||i.isFileLoaded(e)||i.loadStylesheet(e,t+1)},i.INTERVAL_RETRY))})},getScript:function(e,t,i,s){$.ajax({url:e,dataType:"script",crossDomain:!0,timeout:t.timeout,cache:this.DEBUG}).done(i).fail(s)},getCss:function(e,t,i,s){var o,n;o=$("<link>",{"class":t.class,rel:"stylesheet",type:"text/css",href:e}),n=setTimeout(s,t.timeout),o[0].onload=function(){clearTimeout(n),i()},$(document.head).append(o)},fileDone:function(e){this.isFileLoaded(e)||(this.numLoadedFiles+=1,this.loadedFiles[e]=!0,this.numLoadedFiles===this.numFiles&&this.loadApp())},fileFail:function(e,t){this.isAborted||(this.isAborted=!0,_.defaults(t,{error:"Unknown"}),alert("[Plugbot] Failed to Load the File, Stopping Now.\n\nFile: "+e+"\nError: "+t.error))},isFileLoaded:function(e){return void 0!==this.loadedFiles[e]},removeBookmarkScript:function(){var e=document.getElementById("plugbot-js");e&&e.parentElement.removeChild(e)},verifySite:function(){var e=_.map(this.excludedPaths,function(e){return e.toUpperCase()});return this.DOMAIN.toUpperCase()===document.domain.toUpperCase()&&!_.contains(e,window.location.pathname.toUpperCase())},waitCore:function(e){var t,i,s=0,o=this.requiredVariables;i=this.requiredVariables[0],t=setInterval(function(){window[i]&&(s+=1,s>=o.length?(clearInterval(t),e()):i=o[s])},this.INTERVAL_WAIT_DEPS)},waitRoom:function(e){var t;t=setInterval(function(){requirejs.specified("core")&&(clearInterval(t),e())},this.INTERVAL_WAIT_DEPS)}}}();e.init()}(),define("bootstrap",function(){});