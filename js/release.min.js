/* @license
 * Copyright (C) 2013  Shawn
 * This program is licensed under the MIT license.
 */
!function(){"use strict";var t;return t=document.getElementById("plugbot-js"),null!==t&&t.parentElement.removeChild(t),window.hasOwnProperty("Plugbot")?(Plugbot.hasOwnProperty("reload")&&Plugbot.reload(),void 0):(window.Plugbot={},Plugbot.simpleRemove=function(){void 0!==window.requirejs&&(requirejs.undef("Plugbot/Entry"),requirejs.undef("Plugbot/Loader")),delete window.Plugbot},Plugbot.initDone=function(){delete Plugbot.simpleRemove},void 0===window.require||void 0===window.API?(Plugbot.simpleRemove(),void 0):requirejs.specified("room")?(require(["Plugbot/Loader"],function(t){t.initialize()}),void 0):(Plugbot.simpleRemove(),void 0))}(),define("Plugbot/Entry",[],function(){"use strict";var t=function(){var t={environment:"RELEASE",baseUrl:"ebola777.github.io/files/Plugbot-Enhanced/",scriptDir:"js/",cssDir:"css/",scripts:["Plugbot/main/Init","Plugbot/main/Dispose","Plugbot/main/Settings","Plugbot/main/WindowManager","Plugbot/models/dialog/Taskbar","Plugbot/models/dialog/TaskbarItemModel","Plugbot/models/dialog/TaskbarCollection","Plugbot/models/dialog/FloatedWindow","Plugbot/models/MainUi/Model","Plugbot/models/MainUi/ItemModel","Plugbot/models/MainUi/ItemCollection","Plugbot/models/Userlist/Model","Plugbot/models/Userlist/ItemModel","Plugbot/models/Userlist/ItemCollection","Plugbot/views/utils/UiHelpers","Plugbot/views/Ui","Plugbot/views/dialog/Taskbar","Plugbot/views/dialog/TaskbarItemView","Plugbot/views/dialog/FloatedWindow","Plugbot/views/layout/TableLayout","Plugbot/views/MainUi/ItemView","Plugbot/views/MainUi/View","Plugbot/views/Userlist/HeadView","Plugbot/views/Userlist/UsersItemView","Plugbot/views/Userlist/UsersView","Plugbot/views/Userlist/View","Plugbot/events/BaseEvents","Plugbot/events/SiteEvents","Plugbot/events/dialog/FloatedWindowEvents","Plugbot/events/dialog/TaskbarItemEvents","Plugbot/utils/APIBuffer","Plugbot/utils/Helpers","Plugbot/utils/Ticker","Plugbot/utils/Watcher","Plugbot/utils/Countdown","Plugbot/store/LocalStorage"],scriptDep:["Plugbot/main/Settings","Plugbot/main/Init","Plugbot/main/Dispose"],refScriptsUrl:["ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/jquery-ui.min.js"],cssUrl:["style.min.css"],refCssUrl:["ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/themes/smoothness/jquery-ui.min.css"],cssClassname:"css-plugbot-enhanced",getRefScriptUrl:function(t){return"http://"+t},getCssUrl:function(e){return"http://"+t.baseUrl+t.cssDir+e},getRefCssUrl:function(t){return"http://"+t}};return t}();return t}),define("Plugbot/Loader",["Plugbot/Entry"],function(t){"use strict";var e=function(){var e={timeoutLoading:5e3,intervalRetry:1e3,maxNumRetry:2,numFiles:void 0,numLoadedFiles:void 0,loadedFiles:void 0,aborted:void 0,initialize:function(){e=this;var i,s=0,n=[],o=[];for(this.numFiles=0,this.numLoadedFiles=0,this.loadedFiles={},this.aborted=!1,i=0;i!==t.refScriptsUrl.length;i+=1)n.push(t.getRefScriptUrl(t.refScriptsUrl[i])),s+=1;for(i=0;i!==t.cssUrl.length;i+=1)o.push(t.getCssUrl(t.cssUrl[i])),s+=1;for(i=0;i!==t.refCssUrl.length;i+=1)o.push(t.getRefCssUrl(t.refCssUrl[i])),s+=1;if(0===s)return e.loadDep(),void 0;for(e.numFiles=s,i=0;i!==o.length;i+=1)e.loadCss(o[i]);for(i=0;i!==n.length;i+=1)e.loadScript(n[i],0)},loadDep:function(){var e,i,s=t.scriptDep;require(s,function(){for(e=0;e!==s.length;e+=1)i=require(s[e]),void 0!==i&&void 0!==i.initialize&&i.initialize()})},fileDone:function(t){e.isFileLoaded(t)||(e.loadedFiles[t]=!0,e.numLoadedFiles+=1,e.numLoadedFiles===e.numFiles&&e.loadDep())},fileFail:function(t,i){e.aborted||(e.aborted=!0,_.defaults(i,{textStatus:"Unknown"}),alert("Failed to load PlugBot file, stopping now.\n\nFile: "+t+"\nError: "+i.textError),Plugbot.simpleRemove())},loadScript:function(t,i){e.aborted||e.getScript(t,{timeout:e.timeoutLoading},function(){e.aborted||e.fileDone(t)},function(s){return e.aborted?void 0:(i=i||0,i+=1,i===e.maxNumRetry?(e.fileFail(t,{textError:s.status}),void 0):(setTimeout(function(){e.aborted||e.isFileLoaded(t)||e.loadScript(t,i)},e.intervalRetry),void 0))})},loadCss:function(i,s){e.aborted||e.getCss(i,{timeout:e.timeoutLoading,classname:t.cssClassname},function(){e.aborted||e.fileDone(i)},function(){return e.aborted?void 0:(s=s||0,s+=1,s===e.maxNumRetry?(e.fileFail(i,{textError:"Timeout"}),void 0):(setTimeout(function(){e.aborted||e.isFileLoaded(i)||e.loadCss(i,s)},e.intervalRetry),void 0))})},getScript:function(t,e,i,s){$.ajax({url:t,dataType:"script",crossDomain:!0,timeout:e.timeout,cache:!1}).done(i).fail(s)},getCss:function(t,e,i,s){var n,o;n=$(document.createElement("link")).prop({"class":e.classname,rel:"stylesheet",type:"text/css",href:t}),o=setTimeout(s,e.timeout),n[0].onload=function(){clearTimeout(o),i()},$(document.head).append(n)},isFileLoaded:function(t){return void 0!==e.loadedFiles[t]}};return e}();return e}),define("Plugbot/events/BaseEvents",[],function(){"use strict";var t={dispatch:function(t,e){var i=this[t];if(void 0===i)throw'Cannot find event "'+t+'".';this.trigger(this[t],e)}};return function(){_.extend(t,Backbone.Events)}(),t}),define("Plugbot/events/SiteEvents",["Plugbot/events/BaseEvents"],function(t){"use strict";function e(){$(window).on("resize",s)}function i(){$(window).off("resize",s)}function s(t){n.dispatch("RESIZE",[t])}var n={RESIZE:"resize"};return function(){_.extend(n,t)}(),{initDispatcher:e,removeDispatcher:i,dispatcher:n}}),define("Plugbot/events/dialog/FloatedWindowEvents",["Plugbot/events/BaseEvents"],function(t){"use strict";var e={CHANGEANY_MODEL:"change-any:model",AFTER_RENDER:"after:render",SHOW:"show",HIDE:"hide",RESIZE_START:"resize:start",RESIZE_NOW:"resize:now",RESIZE_STOP:"resize:stop",DRAG_START:"drag:start",DRAG_NOW:"drag:now",DRAG_STOP:"drag:stop",CONTROLBOX_MINIMIZE:"control-box:minimize",CONTROLBOX_MAXIMIZE:"control-box:maximize",CONTROLBOX_CLOSE:"control-box:close",MOUSE_ENTER:"mouse-enter",MOUSE_LEAVE:"mouse-leave"};return function(){_.extend(e,t)}(),e}),define("Plugbot/events/dialog/TaskbarItemEvents",["Plugbot/events/BaseEvents"],function(t){"use strict";var e={MOUSE_ENTER:"mouse-enter",MOUSE_LEAVE:"mouse-leave"};return function(){_.extend(e,t)}(),e}),define("Plugbot/main/Dispose",["Plugbot/Entry","Plugbot/Loader","Plugbot/store/LocalStorage","Plugbot/utils/Helpers","Plugbot/events/SiteEvents","Plugbot/main/WindowManager"],function(t,e,i,s,n,o){"use strict";function l(){Plugbot.disposeAndClose=function(){i.clearSettings(),Plugbot.close({saveSettings:!1})},Plugbot.disposeAndReload=function(){i.clearSettings(),Plugbot.reload({saveSettings:!1})},Plugbot.close=function(t){a(t),delete window.Plugbot},Plugbot.reload=function(t){var i,s=["simpleRemove","initDone"],n={};for(t=t||{},t.removeEntryLoader=!1,a(t),i=0;i!==s.length;i+=1)n[s[i]]=Plugbot[s[i]];for(delete window.Plugbot,window.Plugbot={},i=0;i!==s.length;i+=1)Plugbot[s[i]]=n[s[i]];e.initialize()}}function a(t){t=t||{},_.defaults(t,{saveSettings:!0,removeEntryLoader:!0}),t.saveSettings&&i.saveSettings(),s.removeHandlebarsHelpers(),Plugbot.ticker.close(),Plugbot.watcher.close(),n.removeDispatcher(),u(),r(t.removeEntryLoader),d()}function r(e){var i;if(e&&(requirejs.undef("Plugbot/Entry"),requirejs.undef("Plugbot/Loader")),"DEBUG"===t.environment)for(i=0;i!==t.scripts.length;i+=1)requirejs.undef(t.scripts[i])}function d(){$(document.head).children("."+t.cssClassname).remove()}function u(){o.removeTaskbar(),o.removeWindows(),o.removeEvents()}return{initialize:l}}),define("Plugbot/main/Init",["Plugbot/main/WindowManager","Plugbot/store/LocalStorage","Plugbot/utils/Helpers","Plugbot/utils/Ticker","Plugbot/utils/Watcher","Plugbot/events/SiteEvents"],function(t,e,i,s,n,o){"use strict";function l(){e.readSettings(),i.initHandlebarsHelpers(),Plugbot.ticker=new s({interval:Plugbot.tickerInterval.defaults}),Plugbot.watcher=new n({exitWhenNoCall:!1}),o.initDispatcher(),a(),Plugbot.initDone()}function a(){t.initTaskbar(),t.initWindows(),t.initEvents(),t.initPublicMethods()}return{initialize:l}}),define("Plugbot/main/Settings",["Plugbot/store/LocalStorage"],function(t){"use strict";function e(){s()}function i(){Plugbot.ticker.add(t.saveSettings,{interval:Plugbot.tickerInterval.saveLocalStorage})}function s(){Plugbot.tickerInterval=Plugbot.tickerInterval||{},_.defaults(Plugbot.tickerInterval,{defaults:1e3,APICallback:3e3,saveLocalStorage:5e3})}return{initialize:e,saveSettingsDelay:i}}),define("Plugbot/main/WindowManager",["Plugbot/utils/Watcher","Plugbot/main/Settings","Plugbot/events/SiteEvents","Plugbot/views/Ui","Plugbot/models/dialog/FloatedWindow","Plugbot/views/dialog/FloatedWindow","Plugbot/models/dialog/Taskbar","Plugbot/views/dialog/Taskbar","Plugbot/models/dialog/TaskbarItemModel"],function(t,e,i,s,n,o,l,a,r){"use strict";function d(){var t=function(t){var e,i=Plugbot.windows,s=t?"removeClass":"addClass";Plugbot.taskbar.$el[s]("plugbot-taskbar-hidden");for(e in i)i.hasOwnProperty(e)&&i[e].$el[s]("plugbot-floated-window-hidden")};Plugbot.hide=function(){return t(!1),this},Plugbot.show=function(){return t(!0),this}}function u(){var t,e;t=new l({windows:Plugbot.settings.windows,windowTop:$(s.plugdj.header).height()}),e=new a({model:t}),$(document.body).append(e.render().el),Plugbot.taskbar=e,x()}function h(){var t,e,i,s,l=Plugbot.settings.windows;Plugbot.windows=Plugbot.windows||{};for(t in l)l.hasOwnProperty(t)&&(e=l[t],i=new n(e),s=new o({model:i}),$(document.body).append(s.render().el),Plugbot.windows[t]=s,k(s))}function c(){p(),P(),b()}function g(){v()}function m(){Plugbot.taskbar.close()}function f(){var t,e=Plugbot.windows;for(t in e)e.hasOwnProperty(t)&&e[t].close()}function b(){var t={},e=i.dispatcher,n=$(s.plugdj.room),o=n.width();_.extend(t,Backbone.Events),t.listenTo(e,e.RESIZE,function(){var t,e,i=n.width(),s=i/o,l=Plugbot.windows;x();for(t in l)l.hasOwnProperty(t)&&(e=l[t],e.model.set("x",e.model.get("x")*s),e.model.set("oldX",e.model.get("oldX")*s));o=i})}function p(){$(window).on("scroll",w)}function v(){$(window).off("scroll",w)}function w(){x()}function P(){var t=$(s.plugdj.playlistPanel),e=!0;Plugbot.watcher.add(function(){t.is(":visible")?e&&(Plugbot.hide(),e=!1):e||(Plugbot.show(),e=!0)})}function k(t){var i={},s=t.options.dispatcher;_.extend(i,Backbone.Events),i.listenTo(s,s.CHANGEANY_MODEL,function(){var i=t.model.get("name"),s=_.clone(t.model.attributes);delete s.tableLayout,Plugbot.settings.windows[i]=s,e.saveSettingsDelay()}).listenTo(s,s.AFTER_RENDER,function(){var e=t.model.get("status");"minimized"===e&&C(t,{recordOldPos:!1})}).listenTo(s,s.CONTROLBOX_MINIMIZE,function(){var e=t.model.get("status");"minimized"!==e&&C(t)}).listenTo(s,s.CONTROLBOX_MAXIMIZE,function(){var e=t.model.get("status");"minimized"===e&&E(t)})}function x(){Plugbot.taskbar.$el.css({top:$(s.plugdj.header).height()-$(window).scrollTop(),height:$(s.plugdj.room).height()})}function C(t,e){e=e||{},_.defaults(e,{recordOldPos:!0}),t.model.set("status","minimized"),t.switchResizable(!1),t.switchDraggable(!1),e.recordOldPos&&t.model.set({oldX:t.model.get("x"),oldY:t.model.get("y"),oldZIndex:t.model.get("zIndex")}),t.hide(),Plugbot.taskbar.collection.add(new r({name:t.model.get("name"),title:t.model.get("title"),window:t}))}function E(t){var e=Plugbot.taskbar.collection;t.model.set("status","normal"),t.switchResizable(!0),t.switchDraggable(!0),t.model.set({x:t.model.get("oldX"),y:t.model.get("oldY"),zIndex:t.model.get("oldZIndex")}),t.show(),e.remove(e.findWhere({name:t.model.get("name")}))}return{initPublicMethods:d,initTaskbar:u,initWindows:h,initEvents:c,removeEvents:g,removeTaskbar:m,removeWindows:f}}),define("Plugbot/models/dialog/FloatedWindow",[],function(){"use strict";var t=Backbone.Model.extend({defaults:function(){return{name:void 0,bodyClass:"",status:"normal",view:void 0,visible:!0,narrowAction:"hidden",title:"Untitled",callsign:"AAA",zIndex:void 0,oldZIndex:void 0,resizable:!1,draggable:!1,x:0,y:0,oldX:0,oldY:0,width:"auto",height:"auto",minWidth:0,maxWidth:0,minHeight:0,maxHeight:0,minimizeBox:!1,restireBox:!1,closeBox:!1}},NarrowActions:{none:0,hidden:1,callsign:2,expanded:3},Status:{hidden:0,minimized:1,normal:2}});return t}),define("Plugbot/models/dialog/Taskbar",[],function(){"use strict";var t=Backbone.Model.extend({defaults:function(){return{windows:void 0,windowTop:0}}});return t}),define("Plugbot/models/dialog/TaskbarCollection",["Plugbot/models/dialog/TaskbarItemModel"],function(t){"use strict";var e=Backbone.Collection.extend({model:t,initialize:function(){_.bindAll(this)},comparator:function(t,e){var i=0,s=-1,n=t.get("window").model,o=e.get("window").model,l=n.get("oldZIndex"),a=o.get("oldZIndex");return a>l?i=-s:l>a&&(i=s),i},close:function(){this.reset()}});return e}),define("Plugbot/models/dialog/TaskbarItemModel",[],function(){"use strict";var t=Backbone.Model.extend({defaults:function(){return{name:void 0,title:"Unnamed",window:void 0}}});return t}),define("Plugbot/models/MainUi/ItemCollection",["Plugbot/models/MainUi/ItemModel"],function(t){"use strict";var e=Backbone.Collection.extend({model:t,initialize:function(){_.bindAll(this)},close:function(){this.reset()}});return e}),define("Plugbot/models/MainUi/ItemModel",[],function(){"use strict";var t=Backbone.Model.extend({defaults:function(){return{id:void 0,text:void 0,enabled:!1}},initialize:function(){_.bindAll(this),this.listenTo(this,"change:enabled",this.setSettings)},setSettings:function(){var t=this.get("enabled");switch(this.get("id")){case"plugbot-btn-woot":Plugbot.settings.ui.autoWoot=t;break;case"plugbot-btn-queue":Plugbot.settings.ui.autoQueue=t}}});return t}),define("Plugbot/models/MainUi/Model",[],function(){"use strict";var t=Backbone.Model.extend({defaults:function(){return{data:[{id:"plugbot-btn-woot",text:"auto-woot",enabled:Plugbot.settings.ui.autoWoot},{id:"plugbot-btn-queue",text:"auto-queue",enabled:Plugbot.settings.ui.autoQueue},{id:"plugbot-btn-skip-video",text:"skip video",enabled:!1}]}}});return t}),define("Plugbot/models/Userlist/ItemCollection",["Plugbot/models/Userlist/ItemModel"],function(t){"use strict";var e=Backbone.Collection.extend({model:t,initialize:function(){_.bindAll(this)},comparator:function(t,e){var i=0,s=1,n=t.get("user"),o=e.get("user"),l=+n.permission,a=+o.permission,r=n.username.toUpperCase(),d=o.username.toUpperCase();return l>a?i=-s:a>l?i=s:d>r?i=-s:r>d&&(i=s),i},close:function(){this.reset()}});return e}),define("Plugbot/models/Userlist/ItemModel",[],function(){"use strict";var t=Backbone.Model.extend({defaults:function(){return{id:void 0,user:void 0}}});return t}),define("Plugbot/models/Userlist/Model",[],function(){"use strict";var t=Backbone.Model.extend({defaults:function(){return{numUsers:void 0,waitListPos:void 0,users:void 0}},updateAll:function(){this.updateUsers(),this.updateWaitList()},updateUsers:function(){this.set("users",API.getUsers())},updateWaitList:function(){this.set("waitListPos",API.getWaitListPosition()),this.set("waitListNum",API.getWaitList().length)}});return t}),define("Plugbot/store/LocalStorage",["Plugbot/views/Ui","Plugbot/views/utils/UiHelpers"],function(t,e){"use strict";function i(){try{Plugbot.settings=JSON.parse(localStorage.getItem(o))||{}}catch(t){Plugbot.settings={}}Plugbot.settings.version!==l.version&&(l.overrideOldSettings?Plugbot.settings={}:Plugbot.settings.version=l.version),_.defaults(Plugbot.settings,l)}function s(){void 0!==Plugbot&&localStorage.setItem(o,JSON.stringify(Plugbot.settings))}function n(){localStorage.removeItem(o)}var o="PlugbotEnhanced",l={version:"1.0.3.pre",overrideOldSettings:!0,windows:{MainUi:{name:"MainUi",bodyClass:e.getClass(t.plugbot.mainUi),status:"normal",view:"Plugbot/views/MainUi/View",narrowAction:"none",title:"Plugbot",callsign:"PB",zIndex:22,oldZIndex:22,resizable:!1,draggable:!0,x:70,y:85,oldX:70,oldY:85,width:"auto",height:"auto"},Userlist:{name:"Userlist",bodyClass:e.getClass(t.plugbot.userlist),status:"minimized",view:"Plugbot/views/Userlist/View",narrowAction:"callsign",title:"Userlist",callsign:"UL",zIndex:21,oldZIndex:21,resizable:!0,draggable:!0,x:730,y:70,oldX:730,oldY:70,width:240,height:400,minWidth:120,maxWidth:320,minHeight:0,maxHeight:720}},ui:{autoWoot:!0,autoQueue:!1}};return function(){Plugbot.settings=Plugbot.settings||{}}(),{readSettings:i,saveSettings:s,clearSettings:n}}),define("Plugbot/utils/APIBuffer",["Plugbot/events/BaseEvents"],function(t){"use strict";function e(t,e,i,s){var n,o=function(i,s){e.listenTo(API,i,function(){Plugbot.ticker.addId(t,function(){void 0!==s.fnCheck?s.fnCheck()&&s.callback():s.callback()},{interval:Plugbot.tickerInterval.APICallback})})};for(s=s||{},_.defaults(s,{fnCheck:void 0,callback:void 0}),n=0;n!==i.length;n+=1)o(i[n],s)}function i(t){t.stopListening(API)}function s(){var t,e;for(t in API)API.hasOwnProperty(t)&&(e=API[t],"string"==typeof e&&(n[t]=e))}var n={};return function(){_.extend(n,t),s()}(),{Events:n,addListening:e,stopListening:i}}),define("Plugbot/utils/Countdown",[],function(){"use strict";var t=Backbone.Model.extend({defaults:function(){return{interval:"optimal",optimalHz:12,autoStart:!0,exitWhenNoCall:!1,call:void 0,countdown:0,elapsed:0,suspended:!1,waitCallbacks:[],enabled:!1,items:{},idInterval:void 0,suspendedAll:!1}},initialize:function(){_.bindAll(this),_.defaults(this,this.attributes),_.defaults(this,this.defaults())},start:function(){return"optimal"===this.interval?this.interval=Math.round(1e3/this.optimalHz):"hz"===this.interval.substr(-2)&&(this.interval=Math.round(1e3/+this.interval.substr(0,this.interval.length-2))),this.idInterval=window.setInterval(this.fnTick,+this.interval),this.enabled=!0,this},fnTick:function(){var t,e,i,s,n,o,l;if(!this.suspendedAll){i=!0,e=this.items;for(s in e)if(e.hasOwnProperty(s)&&(i=!1,n=e[s],o=n.options,l=n.runtime,!l.suspended))if(l.elapsed+=this.interval,l.elapsed>=o.countdown){if(void 0!==o.call)for(o.call(),t=0;t<l.waitCallbacks.length;t+=1)l.waitCallbacks[t]();this.remove(s)}else this.items[s].runtime=l;i&&this.exitWhenNoCall&&this.close()}},invoke:function(){return this.fnTick(),this},suspendAll:function(){return this.suspendedAll=!0,this},resumeAll:function(){return this.suspendedAll=!1,this},add:function(t,e){return void 0!==this.items[t]?this:(e=e||{},_.defaults(e,{call:this.call,countdown:this.countdown}),this.items[t]={options:e,runtime:{elapsed:this.elapsed,suspended:this.suspended,waitCallbacks:this.waitCallbacks}},this.enabled||this.autoStart&&this.start(),this)},remove:function(t){return void 0===this.items[t]?this:(delete this.items[t],this)},hasId:function(t){return void 0!==this.items[t]},wait:function(t,e){this.items[t].runtime.waitCallbacks.push(e)},setOptions:function(t,e){return this.items[t].options=e,this},setRuntime:function(t,e){return this.items[t].runtime=e,this},suspend:function(t){return this.items[t].runtime.suspended=!0,this},resume:function(t){return this.items[t].runtime.suspended=!1,this},setCountdown:function(t,e){return this.items[t].options.countdown=e,this},callAndRemove:function(t){return this.items[t].options.call(),delete this.items[t],this},setElapsed:function(t,e){return this.items[t].runtime.elapsed=e,this},resetElapsed:function(t){return this.items[t].runtime.elapsed=0,this},delay:function(t,e){return this.items[t].runtime.elapsed-=e,this},forward:function(t,e){return this.items[t].runtime.elapsed+=e,this},clear:function(){return this.items={},this},close:function(){clearInterval(this.idInterval),this.clear()}});return t}),define("Plugbot/utils/Helpers",["handlebars"],function(t){"use strict";function e(){t.registerHelper("getName",function(t){return t.substr(1)})}function i(){delete t.helpers.getName}function s(t,e,i){var n,o;for(n in t)t.hasOwnProperty(n)&&(o=t[n],Object!==o.constructor?void 0===i?e[n]=o:i(e,n,o):s(o,e[n],i))}function n(t,e,i,s,o){var l,r;for(l in t)t.hasOwnProperty(l)&&(r=t[l],Object!==r.constructor?a(e,i,l,r,s,o):n(r,e[l],i[l],s,o))}function o(t,e,i,s,n){if(Object!==t.constructor)return l(t,e,i,s,n),void 0;var a;for(a in t)t.hasOwnProperty(a)&&o(t[a],e[a],i,s,n)}function l(t,e,i,s,n){var o,l=e.split(s),a=i;for(o=0;o<l.length-1;o+=1)a=a[l[o]];void 0===n?a[l[o]]=t:n(t,a,l[o])}function a(t,e,i,s,n,o){var l=r(t,i,n),a=r(e,s,n);void 0===o?a.obj[a.key]=l.obj[l.key]:o(l,a)}function r(t,e,i){var s,n=e.split(i),o=t;for(s=0;s<n.length-1;s+=1)o=o[n[s]];return{obj:o,key:n[s]}}return{initHandlebarsHelpers:e,removeHandlebarsHelpers:i,setBinding:s,setBindingObjToObj:n,setBindingByProxy:o}}),define("Plugbot/utils/Ticker",[],function(){"use strict";var t=Backbone.Model.extend({defaults:function(){return{interval:1e3,calls:[]}},initialize:function(){_.bindAll(this),_.defaults(this,this.attributes),_.defaults(this,this.defaults())},add:function(t,e){var i,s,n,o=this;-1===this.calls.indexOf(t)&&(e=e||{},_.defaults(e,{interval:this.interval}),i=e.interval,this.calls.push(t),s=(new Date).getTime(),n=i-s%i,setTimeout(function(){var e;e=o.calls.indexOf(t),-1!==e&&(t(),o.calls.splice(e,1))},n))},addId:function(t,e,i){var s,n,o,l=this;-1===this.calls.indexOf(t)&&(i=i||{},_.defaults(i,{interval:this.interval}),s=i.interval,this.calls.push(t),n=(new Date).getTime(),o=s-n%s,setTimeout(function(){var i;i=l.calls.indexOf(t),-1!==i&&(e(),l.calls.splice(i,1))},o))},remove:function(t){var e=this.calls.indexOf(t);-1!==e&&this.calls.splice(e,1)},removeId:function(t){this.remove(t)},clear:function(){this.calls=[]},close:function(){this.clear()}});return t}),define("Plugbot/utils/Watcher",[],function(){"use strict";var t=Backbone.Model.extend({defaults:function(){return{interval:"optimal",optimalHz:12,autoStart:!0,exitWhenNoCall:!0,exitValue:0,exitCall:null,maxNumCall:0,watching:!1,call:[],numCall:[],options:[],idInterval:void 0,isSuspended:!1}},initialize:function(){_.bindAll(this),_.defaults(this,this.attributes),_.defaults(this,this.defaults())},watch:function(){"optimal"===this.interval?this.interval=Math.round(1e3/this.optimalHz):"hz"===this.interval.substr(-2)&&(this.interval=Math.round(1e3/+this.interval.substr(0,this.interval.length-2))),this.watching=!0,this.idInterval=window.setInterval(this.fnWatch,+this.interval)},fnWatch:function(){var t,e,i,s,n,o;if(!this.isSuspended){for(t=0;t<this.call.length;)if(s=this.numCall[t],i=this.options[t],e=this.call[t](i.args),s+=1,i.exitValue===e?n=!0:(n=!1,o=0!==i.maxNumCall&&s>i.maxNumCall?!0:!1),n||o){if(null!==i.exitCall&&i.exitCall(),this.call.splice(t,1),this.numCall.splice(t,1),this.options.splice(t,1),0===this.call.length&&this.exitWhenNoCall)return this.close(),void 0}else 0!==i.maxNumCall&&(this.numCall[t]=s),t+=1;0===t&&this.exitWhenNoCall&&this.close()}},add:function(t,e){-1===this.call.indexOf(t)&&(e=e||{},_.defaults(e,{exitValue:this.exitValue,exitCall:this.exitCall,maxNumCall:this.maxNumCall}),this.call.push(t),this.numCall.push(0),this.options.push(e),this.watching||this.autoStart&&this.watch())},remove:function(t){var e=this.call.indexOf(t);-1!==e&&(this.call.splice(e,1),this.numCall.splice(e,1),this.options.splice(e,1))},invoke:function(){this.fnWatch()},suspend:function(){this.isSuspended=!0},resume:function(){this.isSuspended=!1},clear:function(){this.call=[],this.numCall=[],this.options=[]},close:function(){clearInterval(this.idInterval),this.clear()}});return t}),define("Plugbot/views/Ui",[],function(){"use strict";var t={header:"#header",room:"#room",playback:"#playback",playlistPanel:"#playlist-panel",chatInputField:"#chat-input-field",woot:"#woot"},e={mainUi:".plugbot-ui",userlist:".plugbot-userlist"};return{plugdj:t,plugbot:e}}),define("Plugbot/views/dialog/FloatedWindow",["handlebars","Plugbot/utils/Watcher","Plugbot/events/dialog/FloatedWindowEvents","Plugbot/models/dialog/FloatedWindow","Plugbot/views/Ui","Plugbot/views/utils/UiHelpers"],function(t,e,i,s,n,o){"use strict";var l=Backbone.View.extend({defaults:function(){return{dispatcher:_.clone(i),hasRenderedWindow:!1,hasRenderedBody:!1,bodyView:void 0,tableLayout:void 0,nowNarrowAction:this.NarrowActions.expanded}},events:{mouseenter:"onMouseEnter",mouseleave:"onMouseLeave"},initialize:function(){_.bindAll(this),_.defaults(this.options,this.defaults()),this.listenTo(this.model,"change",this.onChangeAll),this.listenTo(this.model,"change:visible",this.onChangeVisible),this.listenTo(this.model,"change:zIndex",this.onChangeZIndex),this.listenTo(this.model,"change:x change:y",this.onChangePos),this.listenTo(this.model,"change:width change:height",this.onChangeSize),this.listenTo(this.model,"change:resizable",this.onChangeResizable),this.listenTo(this.model,"change:draggable",this.onChangeDraggable),this.hide()},NarrowActions:s.prototype.NarrowActions,Status:s.prototype.Status,minWidth:160,minHeight:40,buttonClasses:["ui-icon-minus","ui-icon-extlink","ui-icon-close"],buttonNames:["minimize","maximize","close"],elHeader:".header",elTitle:".title",elControlBox:".control-box",elMinimize:".minimize",elMaximize:".maximize",elClose:".close",elBody:".body",template:t.compile('    <div class="plugbot-floated-window">    <div class="{{getName classHeader}}">        <h1 class="{{getName classTitle}}">{{textTitle}}</h1>        <div class="{{getName classControlBox}}">            <button class="{{getName classMinimize}}" title="Minimize"></button>            <button class="{{getName classMaximize}}" title="Restore"></button>            <button class="{{getName classClose}}" title="Close"></button>        </div>    </div>    <div class="{{getName classBody}}"></div></div>'),render:function(){var t,e,i,s=this;for(this.setElement(this.template({textTitle:this.model.get("title"),classHeader:this.elHeader,classTitle:this.elTitle,classControlBox:this.elControlBox,classMinimize:this.elMinimize,classMaximize:this.elMaximize,classClose:this.elClose,classBody:this.elBody})),this.$el.addClass("scheme-default-plugbot-floated-window"),e=[this.$(this.elMinimize),this.$(this.elMaximize),this.$(this.elClose)],i=this.$(this.elBody),t=0;t!==e.length;t+=1)e[t].button({icons:{primary:this.buttonClasses[t]},text:!1}),e[t].data("name",this.buttonNames[t]),e[t].on("click",this.onClickControlBoxButton);return i.addClass(this.model.get("bodyClass")),this.$el.css({position:"absolute",left:this.model.get("x"),top:this.model.get("y"),width:this.model.get("width"),height:this.model.get("height"),"min-width":this.minWidth,"min-height":this.minHeight,"z-index":this.model.get("zIndex")}),this.bindUiEvents(),Plugbot.watcher.add(function(){var t;return s.$el.is(":visible")&&(s.afterRender(),s.options.hasRenderedWindow=!0,t=0),t}),require([this.model.get("view")],function(t){s.options.bodyView=new t({el:i,modWindow:s.model,dispatcherWindow:s.options.dispatcher}),s.options.bodyView.render(),s.show(),s.options.hasRenderedBody=!0}),this},afterRender:function(){this.updateTitle(),this.resizeBody(),this.resizeTableLayout(),this.options.dispatcher.dispatch("AFTER_RENDER")},show:function(){this.model.set("visible",!0),this.resizeBody(),this.options.dispatcher.dispatch("SHOW")},hide:function(){this.model.set("visible",!1),this.options.dispatcher.dispatch("HIDE")},getBodyView:function(){return this.options.bodyView},getRemainingHeaderSpace:function(t){var e=this.$(this.elHeader),i=this.$(this.elTitle),s=this.$(this.elControlBox);return e.width()-i.outerWidth(!0)-s.outerWidth(!0)-t},resizeBody:function(){var t=this.$(this.elBody),e=this.$(this.elHeader);this.model.get("visible")&&o.fitElement(t,this.$el,"both",0,-e.outerHeight(!0))},resizeTableLayout:function(){var t=this.model.get("tableLayout");void 0!==t&&t.resize()},updateTitle:function(){var t,e=this.$(this.elTitle),i=this.NarrowActions,s=i[this.model.get("narrowAction")],n=this.model.get("title"),o=this.model.get("callsign"),l=8;switch(this.options.nowNarrowAction){case i.expanded:if(t=this.getRemainingHeaderSpace(l),0>t)switch(s){case i.none:this.$el.css("min-width",this.$el.width()-t),this.options.nowNarrowAction=i.none;break;case i.hidden:e.hide(),this.options.nowNarrowAction=i.hidden;break;case i.callsign:e.text("<"+o+">"),this.options.nowNarrowAction=i.callsign}break;case i.none:break;case i.hidden:e.text(n),e.show(),t=this.getRemainingHeaderSpace(l),t>=0?this.options.nowNarrowAction=i.expanded:e.hide();break;case i.callsign:e.text(n),t=this.getRemainingHeaderSpace(l),t>=0?this.options.nowNarrowAction=i.expanded:e.text("<"+o+">")}},switchResizable:function(t){this.model.get("resizable")&&(t?this.$el.resizable("enable"):this.$el.resizable("disable"))},switchDraggable:function(t){this.model.get("draggable")&&(t?this.$el.draggable("enable"):(this.$el.draggable("disable"),this.$el.css("opacity",1)))},bindUiEvents:function(){var t,i,s=this;this.model.get("resizable")&&this.$el.resizable({containment:"document",handles:"n, e, s, w, se",distance:0,grid:8,minWidth:Math.max(this.minWidth,this.model.get("minWidth")),minHeight:Math.max(this.minHeight,this.model.get("minHeight")),maxWidth:this.model.get("maxWidth"),maxHeight:this.model.get("maxHeight"),start:function(l,a){t=o.iframeFix($(n.plugdj.playback)),void 0!==s.model.get("tableLayout")&&(i=new e,i.add(s.resizeTableLayout)),s.options.dispatcher.dispatch("RESIZE_START",[l,a])},resize:function(t,e){s.updateTitle(),s.resizeBody(),s.options.dispatcher.dispatch("RESIZE_NOW",[t,e])},stop:function(e,n){o.removeIframeFix(t),void 0!==i&&i.close(),s.model.set({width:n.size.width,height:n.size.height}),s.options.dispatcher.dispatch("RESIZE_STOP",[e,n])}}),this.model.get("draggable")&&this.$el.draggable({containment:"document",zIndex:10001,handle:".header",scroll:!0,scrollSensitivity:8,snap:"div",snapMode:"both",snapTolerance:8,cursor:"move",start:function(e,i){var l=$(this);l.css({width:l.width(),height:l.height()}).data({diffOfs:{X:i.position.left-i.offset.left,Y:i.position.top-i.offset.top}}),t=o.iframeFix($(n.plugdj.playback)),s.options.dispatcher.dispatch("DRAG_START",[e,i])},drag:function(t,e){var i=$(this).data("diffOfs");e.position.left-=i.X,e.position.top-=i.Y,s.options.dispatcher.dispatch("DRAG_NOW",[t,e])},stop:function(e,i){o.removeIframeFix(t),s.model.set({x:i.position.left,y:i.position.top}),s.options.dispatcher.dispatch("DRAG_STOP",[e,i])}})},onMouseEnter:function(){this.options.dispatcher.dispatch("MOUSE_ENTER")},onMouseLeave:function(){this.options.dispatcher.dispatch("MOUSE_LEAVE")},onChangeVisible:function(){this.model.get("visible")?this.$el.show():this.$el.hide()},onChangeZIndex:function(){this.$el.css("z-index",this.model.get("zIndex"))},onChangePos:function(){this.$el.css({left:this.model.get("x"),top:this.model.get("y")})},onChangeSize:function(){this.$el.css({width:this.model.get("width"),height:this.model.get("height")})},onClickControlBoxButton:function(t){var e=this,i={cancel:!1,enabledCallback:!1,callback:function(){i.cancel||e.close()}};switch($(t.currentTarget).data("name")){case"minimize":this.options.dispatcher.dispatch("CONTROLBOX_MINIMIZE",i);break;case"maximize":this.options.dispatcher.dispatch("CONTROLBOX_MAXIMIZE",i);break;case"close":this.options.dispatcher.dispatch("CONTROLBOX_CLOSE",i),!i.enabledCallback}},onChangeAll:function(){this.options.dispatcher.dispatch("CHANGEANY_MODEL")},close:function(){this.remove(),this.options.bodyView.close()}});return l}),define("Plugbot/views/dialog/Taskbar",["handlebars","Plugbot/utils/Countdown","Plugbot/views/utils/UiHelpers","Plugbot/models/dialog/Taskbar","Plugbot/models/dialog/TaskbarCollection","Plugbot/views/dialog/TaskbarItemView"],function(t,e,i,s,n,o){"use strict";var l=Backbone.View.extend({defaults:function(){return{views:{},countdownSlide:new e,countdownTask:new e,currentWindow:void 0}},events:{mouseenter:"onMouseEnter",mouseleave:"onMouseLeave"},initialize:function(){_.bindAll(this),_.defaults(this.options,this.defaults()),this.collection=new n,this.listenTo(this.collection,"add",this.addOne),this.listenTo(this.collection,"remove",this.removeOne),this.bindUiEvents()},elContent:".content",elHandle:".handle",elContainer:".container",template:t.compile('    <div class="plugbot-taskbar">    <div class="{{getName classContent}}">        <ul class="{{getName classContainer}}"></ul>    </div>    <div class="{{getName classHandle}}"></div></div>'),render:function(){return this.setElement(this.template({classContent:this.elContent,classHandle:this.elHandle,classContainer:this.elContainer})),this.$el.trigger("mouseleave"),this
},addOne:function(t){var e,s=new o({model:t}),n=this.$(this.elContainer);this.options.views[t.cid]=s,e=this.collection.indexOf(t),i.insertAt(s.render().el,n,e),this.listenToItem(s),this.listenToWindow(t.get("window"))},removeOne:function(t){var e=t.cid,i=this.options.views;this.stopListeningItem(this.options.views[t.cid]),this.stopListeningWindow(t.get("window")),this.options.countdownSlide.resumeAll(),this.options.countdownTask.resumeAll(),this.options.currentWindow=void 0,i[e].close(),delete i[e]},listenToItem:function(t){var e=this,i=t.options.dispatcher,s=t.model.cid,n="mouse-enter",o="mouse-leave";this.listenTo(i,i.MOUSE_ENTER,function(t){e.options.countdownTask.remove(n+":"+s).add(n+":"+s,{call:function(){var i=t.model.get("window");e.options.currentWindow=i,e.showWindow(i)},countdown:300})}),this.listenTo(i,i.MOUSE_LEAVE,function(t){e.options.countdownTask.remove(o+":"+s).add(o+":"+s,{call:function(){var i=t.model.get("window");e.options.currentWindow=void 0,e.hideWindow(i)},countdown:300})})},listenToWindow:function(t){var e=t.options.dispatcher,i=this.options.countdownSlide,s=this.options.countdownTask;this.listenTo(e,e.MOUSE_ENTER,function(){i.suspendAll(),s.suspendAll()}),this.listenTo(e,e.MOUSE_LEAVE,function(){i.resumeAll(),s.resumeAll()})},stopListeningItem:function(t){var e=t.options.dispatcher,i=t.model.cid;this.stopListening(e),this.options.countdownTask.remove("mouse-enter:"+i).remove("mouse-leave:"+i)},stopListeningWindow:function(t){var e=t.options.dispatcher;this.stopListening(e)},showWindow:function(t){t.model.set({x:this.$el.width()+$(window).scrollLeft(),y:this.model.get("windowTop"),zIndex:1e4}),t.show()},hideWindow:function(t){t.hide()},expand:function(){this.$el.animate({left:0},200)},collapse:function(){var t=this.$(this.elContent);this.$el.animate({left:-t.width()},200)},bindUiEvents:function(){$(window).on("scroll",this.onWindowScroll)},unbindUiEvents:function(){$(window).off("scroll",this.onWindowScroll)},onWindowScroll:function(){var t=this.options.currentWindow;void 0!==t&&this.showWindow(this.options.currentWindow)},onMouseEnter:function(){var t=this,e=this.options.countdownSlide;e.remove("mouse-leave").add("mouse-enter",{call:function(){t.expand()},countdown:100})},onMouseLeave:function(){var t=this,e=this.options.countdownSlide;e.remove("mouse-enter").add("mouse-leave",{call:function(){t.collapse()},countdown:500})},close:function(){var t,e=this.options.views;this.unbindUiEvents(),this.remove(),this.collection.close();for(t in e)e.hasOwnProperty(t)&&e[t].close()}});return l}),define("Plugbot/views/dialog/TaskbarItemView",["handlebars","Plugbot/events/dialog/TaskbarItemEvents"],function(t,e){"use strict";var i=Backbone.View.extend({defaults:function(){return{dispatcher:_.clone(e)}},events:{mouseenter:"onMouseEnter",mouseleave:"onMouseLeave"},initialize:function(){_.bindAll(this),_.defaults(this.options,this.defaults())},template:t.compile('    <li class="task">{{title}}</li>'),render:function(){return this.setElement(this.template({title:this.model.get("title")})),this},onMouseEnter:function(){this.options.dispatcher.dispatch("MOUSE_ENTER",{model:this.model})},onMouseLeave:function(){this.options.dispatcher.dispatch("MOUSE_LEAVE",{model:this.model})},close:function(){this.remove()}});return i}),define("Plugbot/views/layout/TableLayout",["Plugbot/views/utils/UiHelpers"],function(t){"use strict";var e=Backbone.View.extend({defaults:function(){return{display:void 0,classes:[],values:[],styles:[],grows:[]}},initialize:function(){_.bindAll(this),_.defaults(this.options,this.defaults)},elTableLayout:".plugbot-table-layout",render:function(){this.$el.addClass(t.getClass(this.elTableLayout)),this.$el.children("div").addClass(this.options.display),this.resize()},resize:function(){var t,e,i,s,n,o,l,a,r="row"===this.options.display?"width":"height",d="row"===this.options.display?"outerWidth":"outerHeight";for(l=this.$el[r](),a=[],o=0,t=0;t!==this.options.classes.length;t+=1)switch(e=this.$("."+this.options.classes[t]),i=this.options.values[t],s=this.options.styles[t],n=this.options.grows[t],s){case"auto":e.css(r,"auto"),l-=e[d](!0);break;case"px":e.css(r,i+"px"),l-=e[d](!0);break;case"%":e.css(r,i+"%"),l-=e[d](!0);break;case"?":e.css(r,"auto"),o+=n,a.push(t)}if(0!==o)for(l/=o,t=0;t!==a.length;t+=1)e=this.$("."+this.options.classes[a[t]]),n=this.options.grows[a[t]],e.css(r,l*n-(e[d](!0)-e[r]())+"px")},close:function(){}});return e}),define("Plugbot/views/MainUi/ItemView",["handlebars"],function(t){"use strict";var e=Backbone.View.extend({initialize:function(){_.bindAll(this),this.listenTo(this.model,"change:enabled",this.render2)},events:{click:"onClick"},template:t.compile('<p id="{{id}}" class="{{class}}">{{text}}</p>'),render:function(){return this.setElement(this.template({id:this.model.get("id"),"class":this.getClass(this.model.get("enabled")),text:this.model.get("text")})),this},render2:function(){return this.$el.prop("class",this.getClass(this.model.get("enabled"))),this},getClass:function(t){return t?"item-enabled":"item-disabled"},onClick:function(){this.model.set("enabled",!this.model.get("enabled"))},close:function(){this.remove()}});return e}),define("Plugbot/views/MainUi/View",["handlebars","Plugbot/utils/APIBuffer","Plugbot/utils/Watcher","Plugbot/views/Ui","Plugbot/models/MainUi/Model","Plugbot/models/MainUi/ItemModel","Plugbot/models/MainUi/ItemCollection","Plugbot/views/MainUi/ItemView"],function(t,e,i,s,n,o,l,a){"use strict";var r=Backbone.View.extend({defaults:function(){return{dispatcherWindow:void 0,watcherAutoQueue:new i({interval:"2 hz",exitWhenNoCall:!1}),watcherSkipVideo:new i({interval:"1 hz",exitWhenNoCall:!1,exitValue:!0,exitCall:this.disableSkipVideo}),views:{},elemDialogAsk:void 0,lastPlaybackVolume:void 0}},model:new n,initialize:function(){_.bindAll(this),_.defaults(this.options,this.defaults()),this.collection=new l,this.listenTo(this.collection,"add",this.addOne),this.listenToWindow(),this.listenToAPI(),this.onClickWoot(Plugbot.settings.ui.autoWoot).onClickQueue(Plugbot.settings.ui.autoQueue).onClickSkipVideo(!1)},el:s.plugbot.mainUi,templateDialogAsk:t.compile('    <div title="Exit PlugBot">    <p>Exit PlugBot?    </p></div>'),events:{click:"onClick"},render:function(){var t,e,i=this.model.get("data");for(this.options.elemDialogAsk=$(this.templateDialogAsk()),t=0;t!==i.length;t+=1)e=new o(i[t]),this.collection.add(e);return this},addOne:function(t){var e=new a({model:t});this.options.views[t.id]=e,this.$el.append(e.render().el)},listenToAPI:function(){var t=this.model.cid;e.addListening("auto-woot-"+t,this,[API.DJ_ADVANCE],{fnCheck:function(){return Plugbot.settings.ui.autoWoot},callback:function(){$(s.plugdj.woot).click()}}),e.addListening("auto-queue-"+t,this,[API.WAIT_LIST_UPDATE],{fnCheck:function(){return Plugbot.settings.ui.autoQueue},callback:this.enableAutoQueue})},listenToWindow:function(){var t=this.options.dispatcherWindow;this.listenTo(t,t.CONTROLBOX_CLOSE,function(t){t.enabledCallback=!0,this.options.elemDialogAsk.dialog({modal:!0,draggable:!1,resizable:!1,buttons:{OK:function(){t.callback(),Plugbot.close(),$(this).dialog("close")},Cancel:function(){t.cancel=!0,t.callback(),$(this).dialog("close")}}})})},onClick:function(t){var e=t.target.id,i=this.collection.get(e),s=i.get("enabled");switch(e){case"plugbot-btn-woot":this.onClickWoot(s);break;case"plugbot-btn-queue":this.onClickQueue(s);break;case"plugbot-btn-skip-video":this.onClickSkipVideo(s)}},onClickWoot:function(){return this},onClickQueue:function(t){return t?this.enableAutoQueue():this.disableAutoQueue(),this},onClickSkipVideo:function(t){return t?this.enableSkipVideo():this.disableSkipVideo(),this},enableAutoQueue:function(){var t=API.djJoin();0!==t&&this.options.watcherAutoQueue.add(this.fnWatcherAutoQueue)},disableAutoQueue:function(){this.options.watcherAutoQueue.remove(this.fnWatcherAutoQueue)},enableSkipVideo:function(){this.options.lastPlaybackVolume=API.getVolume(),API.setVolume(0),this.options.watcherSkipVideo.add(this.fnWatcherSkipVideo)},disableSkipVideo:function(){var t;void 0!==this.options.lastPlaybackVolume&&(t=this.collection.get("plugbot-btn-skip-video"),t.set("enabled",!1),API.setVolume(this.options.lastPlaybackVolume),this.options.lastPlaybackVolume=void 0),this.options.watcherSkipVideo.remove(this.fnWatcherSkipVideo)},fnWatcherAutoQueue:function(){return API.djJoin()},fnWatcherSkipVideo:function(){return API.getTimeRemaining()<=1},close:function(){var t,e=this.options.views;this.remove(),this.collection.close();for(t in e)e.hasOwnProperty(t)&&e[t].close();this.options.watcherAutoQueue.close(),this.options.watcherSkipVideo.close()}});return r}),define("Plugbot/views/Userlist/HeadView",["handlebars"],function(t){"use strict";var e=Backbone.View.extend({initialize:function(){_.bindAll(this)},template:t.compile('   <h1 class="userlist-queuespot">{{textQueueSpot}}</h1>'),render:function(){var t=this.model.get("waitListPos");return this.$el.html(this.template({textQueueSpot:"Waitlist: "+(-1===t?"-":t)+" / "+this.model.get("waitListNum")})),this},close:function(){this.remove()}});return e}),define("Plugbot/views/Userlist/UsersItemView",["handlebars"],function(t){"use strict";var e=Backbone.View.extend({initialize:function(){_.bindAll(this)},template:t.compile('    <li class="userlist-item {{classVote}}" data-id="{{id}}">{{text}}</li>'),render:function(){var t=this.model.get("user");return this.setElement(this.template({id:this.model.get("id"),classVote:this.getClass(+t.vote),text:t.username})),this},getClass:function(t){var e;switch(t){case 1:e="item-woot";break;case-1:e="item-meh";break;case 0:e="item-undecided"}return e},close:function(){this.remove()}});return e}),define("Plugbot/views/Userlist/UsersView",["Plugbot/views/Ui","Plugbot/models/Userlist/ItemCollection","Plugbot/views/Userlist/UsersItemView"],function(t,e,i){"use strict";var s=Backbone.View.extend({defaults:function(){return{views:{}}},initialize:function(){_.bindAll(this),_.defaults(this.options,this.defaults()),this.collection=new e,this.render()},events:{"click .userlist-item":"onClick"},render:function(){var t,e,s,n,o,l=this.model.get("users");for(this.removeViews(),this.collection.reset(),t=0;t<l.length;t+=1)e=l[t],this.collection.add({id:e.id,user:e});for(s=this.collection.models,t=0;t!==s.length;t+=1)n=s[t],o=new i({model:n}),this.$el.append(o.render().$el),this.options.views[n.get("id")]=o},onClick:function(e){var i=$(e.currentTarget).data("id"),s=this.collection.get(i),n=s.get("user");$(t.plugdj.chatInputField).val("@"+n.username+" ").focus()},removeViews:function(){var t,e=this.options.views;for(t in e)e.hasOwnProperty(t)&&e[t].close()},close:function(){var t;this.remove(),this.collection.reset();for(t in this.views)this.views.hasOwnProperty(t)&&this.views[t].close()}});return s}),define("Plugbot/views/Userlist/View",["handlebars","Plugbot/utils/APIBuffer","Plugbot/views/layout/TableLayout","Plugbot/models/Userlist/Model","Plugbot/views/Userlist/HeadView","Plugbot/views/Userlist/UsersView"],function(t,e,i,s,n,o){"use strict";var l=Backbone.View.extend({defaults:function(){return{modWindow:void 0,dispatcherWindow:void 0,renderOverElapsed:5,pendingRenderHead:!1,pendingRenderList:!1,tableLayout:void 0,viewHead:void 0,viewList:void 0}},model:new s,initialize:function(){_.bindAll(this),_.defaults(this.options,this.defaults()),this.listenToAPI()},elHead:".head",elWrapList:".wrap-list",elList:".list",template:t.compile('    <div class="row-head">    <div class="{{getName classHead}}"></div></div><div class="row-list">    <div class="{{getName classWrapList}}">        <ul class="{{getName classList}}"></ul>    </div></div>'),render:function(){return this.model.updateAll(),this.$el.html(this.template({classHead:this.elHead,classWrapList:this.elWrapList,classList:this.elList})),this.$el.addClass("scheme-default-plugbot-userlist"),this.options.tableLayout=new i({el:this.$el,display:"column",classes:["row-head","row-list"],values:[0,0],styles:["auto","?"],grows:[0,1]}),this.options.modWindow.set("tableLayout",this.options.tableLayout),this.options.viewHead=new n({model:this.model,el:this.$(this.elHead)}),this.options.viewList=new o({model:this.model,el:this.$(this.elList)}),this.options.tableLayout.render(),this.options.viewHead.render(),this.options.viewList.render(),this.options.tableLayout.resize(),this.listenToWindow(),this},renderHead:function(){return this.model.updateWaitList(),this.options.viewHead.render(),this.options.pendingRenderHead=!1,this},renderList:function(){return this.model.updateUsers(),this.options.viewList.render(),this.options.pendingRenderList=!1,this},listenToAPI:function(){var t=this,i=this.model.cid,s=function(e){var i;if(t.options.modWindow.get("visible"))i=API.getTimeElapsed()>=t.options.renderOverElapsed?!0:!1;else{switch(e){case"head":t.options.pendingRenderHead=!0;break;case"list":t.options.pendingRenderList=!0}i=!1}return i};e.addListening("head-"+i,this,[API.WAIT_LIST_UPDATE,API.DJ_UPDATE],{fnCheck:function(){return s("head")},callback:this.renderHead}),e.addListening("list-"+i,this,[API.VOTE_UPDATE,API.USER_JOIN,API.USER_LEAVE],{fnCheck:function(){return s("list")},callback:this.renderList})},listenToWindow:function(){var t=this,e=this.options.modWindow,i=this.options.dispatcherWindow;this.listenTo(e,"change:visible",function(){e.get("visible")&&(t.updateUsersRearSpace(),t.options.pendingRenderHead&&t.renderHead(),t.options.pendingRenderList&&t.renderList())}),this.listenTo(i,i.AFTER_RENDER,function(){t.updateUsersRearSpace()}).listenTo(i,i.RESIZE_NOW,function(){t.updateUsersRearSpace()}).listenTo(i,i.RESIZE_START,function(){t.updateUsersRearSpace()})},updateUsersRearSpace:function(){var t=this.$(this.elWrapList),e=this.$(this.elList);e.css("padding-bottom",.5*t.height())},close:function(){this.remove(),this.options.tableLayout.close(),this.options.viewHead.close(),this.options.viewList.close()}});return l}),define("Plugbot/views/utils/UiHelpers",["Plugbot/utils/Watcher"],function(t){"use strict";function e(t){var e;return e="#"===t[0]?t.substr(1):null}function i(t){var e;return e="."===t[0]?t.substr(1):null}function s(t,e){var i;switch(e){case"width":i=t.outerWidth()-t.innerWidth();break;case"height":i=t.outerHeight()-t.innerHeight();break;case"both":i={width:t.outerWidth()-t.innerWidth(),height:t.outerHeight()-t.innerHeight()}}return i}function n(t,e){var i;switch(e){case"width":i=t.innerWidth()-t.width();break;case"height":i=t.innerWidth()-t.width();break;case"both":i={width:t.innerWidth()-t.width(),height:t.innerWidth()-t.width()}}return i}function o(t,e){var i;switch(e){case"width":i=t.outerWidth(!0)-t.outerWidth();break;case"height":i=t.outerHeight(!0)-t.outerWidth();break;case"both":i={width:t.outerWidth(!0)-t.outerWidth(),height:t.outerHeight(!0)-t.outerWidth()}}return i}function l(t,e){var i,s,o=t.children();switch(e){case"width":s=n(t,"width");break;case"height":s=n(t,"height");break;case"both":s={width:n(t,"width"),height:n(t,"height")}}for(i=0;i!==o.length;i+=1)switch(e){case"width":s+=o[i].outerWidth(!0);break;case"height":s+=o[i].outerHeight(!0);break;case"both":s.width+=o[i].outerWidth(!0),s.height+=o[i].outerHeight(!0)}return s}function a(t,e,i){0===i?e.prepend(t):e.children().eq(i-1).after(t)}function r(t,e,i,s,n){var o=t.outerWidth(!0)-t.width(),l=t.outerHeight(!0)-t.height();switch(s=s||0,n=n||0,i){case"width":t.width(e.width()-o+s);break;case"height":t.height(e.height()-l+n);break;case"both":t.width(e.width()-o+s),t.height(e.height()-l+n)}}function d(t){var e,i=null;return e=t.next(),0===e.length&&(i=t.parent()),t=t.detach(),{elem:t,nextSibling:e,parent:i}}function u(t){null===t.parent?t.nextSibling.before(t.elem):t.parent.append(t.elem)}function h(e,i){var s={ori:{},now:{}},n=function(t){s[t]={pos:e.position(),size:{width:e.width(),height:e.height()},parentSize:{width:i.width(),height:i.height()}}},o=new t,l=function(){var t,n,l,a;return 0===i.parent().length?(o.close(),0):0===e.length?1:(t=e.position(),n={width:e.width(),height:e.height()},l={width:i.width(),height:i.height()},(t.left!==s.now.pos.left||l.width!==s.now.parentSize.width)&&e.width(s.ori.size.width+s.ori.pos.left-t.left+l.width-s.ori.parentSize.width),(t.top!==s.now.pos.top||l.height!==s.now.parentSize.height)&&e.height(s.ori.size.height+s.ori.pos.top-t.top+l.height-s.ori.parentSize.height),a={width:i.width(),height:i.height()},(a.width!==l.width||a.height!==l.height)&&(e.width(n.width),e.height(n.height)),s.now={pos:t,size:n,parentSize:l},1)};return n("ori"),n("now"),o.add(l),o}function c(t){t.invoke(),t.close()}function g(e){var i=e.css("pointer-events"),s=new t,n=function(t){return 0===t.length?0:(t.css("pointer-events","none"),1)};return s.add(n,{args:e}),n(e),{watcher:s,iframe:e,oriPointerEvents:i}}function m(t){t.iframe.css("pointer-events",t.oriPointerEvents),t.watcher.close()}return{getId:e,getClass:i,getBorder:s,getPadding:n,getMargin:o,getMinFloatSize:l,insertAt:a,fitElement:r,detach:d,reattach:u,autoResize:h,removeAutoResize:c,iframeFix:g,removeIframeFix:m}});
//# sourceMappingURL=release.min.js.map