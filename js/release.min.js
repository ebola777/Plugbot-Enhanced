/* @license
 * Copyright (C) 2013  Shawn
 * This program is licensed under the MIT license.
 */
!function(){"use strict";var e;return e=document.getElementById("plugbot-js"),null!==e&&e.parentElement.removeChild(e),void 0!==window.Plugbot?void(void 0!==Plugbot.reload&&Plugbot.reload()):(window.Plugbot={},Plugbot.simpleRemove=function(){void 0!==window.requirejs&&(requirejs.undef("Plugbot/Entry"),requirejs.undef("Plugbot/Loader")),delete window.Plugbot},Plugbot.initDone=function(){delete Plugbot.simpleRemove},void 0!==window.API&&requirejs.specified("room")?void require(["Plugbot/Loader"],function(e){e.initialize()}):void Plugbot.simpleRemove())}(),define("Plugbot/Entry",[],function(){"use strict";var e=function(){return{environment:"RELEASE",baseUrl:"ebola777.github.io/files/Plugbot-Enhanced/",scriptDir:"js/",cssDir:"css/",scripts:["Plugbot/base/Events","Plugbot/base/SubView","Plugbot/base/Template","Plugbot/base/Timer","Plugbot/colls/Taskbar/ItemCollection","Plugbot/colls/Userlist/ItemCollection","Plugbot/events/FloatedWindow/Events","Plugbot/events/MainUi/Events","Plugbot/events/mgrs/WindowManager","Plugbot/events/site/Events","Plugbot/events/site/RoomSize","Plugbot/events/Taskbar/ItemEvents","Plugbot/main/mgrs/ResourceManager","Plugbot/main/mgrs/SiteManager","Plugbot/main/mgrs/TaskbarManager","Plugbot/main/mgrs/WindowManager","Plugbot/main/Dispose","Plugbot/main/Init","Plugbot/main/Settings","Plugbot/models/FloatedWindow/Model","Plugbot/models/MainUi/Model","Plugbot/models/Taskbar/ItemModel","Plugbot/models/Taskbar/Model","Plugbot/models/Userlist/HeadModel","Plugbot/models/Userlist/Model","Plugbot/models/Userlist/UsersModel","Plugbot/store/LocalStorage","Plugbot/store/LZString","Plugbot/tmpls/FloatedWindow/View","Plugbot/tmpls/MainUi/View","Plugbot/tmpls/Taskbar/ItemView","Plugbot/tmpls/Taskbar/View","Plugbot/tmpls/Userlist/HeadView","Plugbot/tmpls/Userlist/UsersItemView","Plugbot/tmpls/Userlist/View","Plugbot/utils/API","Plugbot/utils/APIBuffer","Plugbot/utils/Countdown","Plugbot/utils/Helpers","Plugbot/utils/Ticker","Plugbot/utils/Watcher","Plugbot/views/FloatedWindow/View","Plugbot/views/layout/TableLayout","Plugbot/views/MainUi/View","Plugbot/views/Taskbar/View","Plugbot/views/Taskbar/ItemView","Plugbot/views/Userlist/HeadView","Plugbot/views/Userlist/UsersItemView","Plugbot/views/Userlist/UsersView","Plugbot/views/Userlist/View","Plugbot/views/utils/Ui","Plugbot/views/utils/UiHelpers"],scriptDep:["Plugbot/main/Settings","Plugbot/main/Init","Plugbot/main/Dispose"],refScriptsUrl:["ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/jquery-ui.min.js"],cssUrl:["style.min.css"],refCssUrl:["ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/themes/smoothness/jquery-ui.min.css"],cssClassname:"css-plugbot-enhanced",getRefScriptUrl:function(e){return"http://"+e},getCssUrl:function(e){return"http://"+this.baseUrl+this.cssDir+e},getRefCssUrl:function(e){return"http://"+e}}}();return e}),define("Plugbot/Loader",["Plugbot/Entry"],function(e){"use strict";var t=function(){return{TIMEOUT_LOADING:5e3,INTERVAL_RETRY:1e3,MAX_NUM_RETRIES:2,FUNC_NAME_LOAD_DEP:"initialize",numFiles:void 0,numLoadedFiles:void 0,loadedFiles:void 0,aborted:void 0,initialize:function(){var t,i=0,s=[],n=[];for(this.numFiles=0,this.numLoadedFiles=0,this.loadedFiles={},this.aborted=!1,t=0;t!==e.refScriptsUrl.length;t+=1)s.push(e.getRefScriptUrl(e.refScriptsUrl[t])),i+=1;for(t=0;t!==e.cssUrl.length;t+=1)n.push(e.getCssUrl(e.cssUrl[t])),i+=1;for(t=0;t!==e.refCssUrl.length;t+=1)n.push(e.getRefCssUrl(e.refCssUrl[t])),i+=1;if(0===i)return void this.loadDep();for(this.numFiles=i,t=0;t!==n.length;t+=1)this.loadCss(n[t]);for(t=0;t!==s.length;t+=1)this.loadScript(s[t],0)},loadDep:function(){var t,i,s,n=this,o=e.scriptDep;require(o,function(){for(t=0;t!==o.length;t+=1)i=require(o[t]),void 0!==i&&(s=i[n.FUNC_NAME_LOAD_DEP],_.isFunction(s)&&i[n.FUNC_NAME_LOAD_DEP]())})},fileDone:function(e){this.isFileLoaded(e)||(this.loadedFiles[e]=!0,this.numLoadedFiles+=1,this.numLoadedFiles===this.numFiles&&this.loadDep())},fileFail:function(e,t){this.aborted||(this.aborted=!0,_.defaults(t,{textError:"Unknown"}),alert("Failed to load Plugbot file, stopping now.\n\nFile: "+e+"\nError: "+t.textError),Plugbot.simpleRemove())},loadScript:function(e,t){var i=this;this.aborted||this.getScript(e,{timeout:this.TIMEOUT_LOADING},function(){i.aborted||i.fileDone(e)},function(s){return i.aborted?void 0:(t=t||0,t+=1,t===i.MAX_NUM_RETRIES?void i.fileFail(e,{textError:s.status}):void setTimeout(function(){i.aborted||i.isFileLoaded(e)||i.loadScript(e,t)},i.INTERVAL_RETRY))})},loadCss:function(t,i){var s=this;this.aborted||this.getCss(t,{timeout:this.TIMEOUT_LOADING,classname:e.cssClassname},function(){s.aborted||s.fileDone(t)},function(){return s.aborted?void 0:(i=i||0,i+=1,i===s.MAX_NUM_RETRIES?void s.fileFail(t,{textError:"Timeout"}):void setTimeout(function(){s.aborted||s.isFileLoaded(t)||s.loadCss(t,i)},s.INTERVAL_RETRY))})},getScript:function(e,t,i,s){$.ajax({url:e,dataType:"script",crossDomain:!0,timeout:t.timeout,cache:!1}).done(i).fail(s)},getCss:function(e,t,i,s){var n,o;n=$(document.createElement("link")).prop({"class":t.classname,rel:"stylesheet",type:"text/css",href:e}),o=setTimeout(s,t.timeout),n[0].onload=function(){clearTimeout(o),i()},$(document.head).append(n)},isFileLoaded:function(e){return void 0!==this.loadedFiles[e]}}}();return t}),define("Plugbot/base/Events",[],function(){"use strict";var e={dispatch:function(e,t){var i=this[e];if(void 0===i)throw new Error('Cannot find event "'+e+'".');return this.trigger(this[e],t),this}};return function(){_.extend(e,Backbone.Events)}(),e}),define("Plugbot/base/SubView",[],function(){"use strict";var e=Backbone.View.extend({initialize:function(){this._objSubViews={}},renderSub:function(e,t){var i,s;if(null===e||void 0===e){s=this._objSubViews;for(i in s)s.hasOwnProperty(i)&&s[i].renderFromParent(t)}else this._objSubViews[e].renderFromParent(t);return this},subViews:function(e,t){var i;return void 0===e?i=this._getSubViews():(this._setSubViews(e,t),i=this),i},setSubView:function(e,t){this._objSubViews[e]=t},getSubView:function(e){return this._objSubViews[e]},closeSubView:function(e){this._objSubViews[e].close(),delete this._objSubViews[e]},closeAllSubViews:function(){var e,t=this._objSubViews;for(e in t)t.hasOwnProperty(e)&&t[e].close();this._objSubViews={}},_getSubViews:function(){return this._objSubViews},_setSubViews:function(e,t){var i,s;this._objSubViews=e;for(i in e)e.hasOwnProperty(i)&&(s=e[i],void 0!==t&&(s.options.optionsParent=t))}});return e}),define("Plugbot/base/Template",["handlebars","Plugbot/views/utils/UiHelpers"],function(e,t){"use strict";var i=Backbone.View.extend({options:function(){return{view:void 0}},initialize:function(){_.bindAll(this,"_getElement","_getId","_getClass"),this.rendered=!1,this.cachedElements=!1,this.precompiledHbs=void 0,this.settingsElem=void 0,this.memGetElement=_.memoize(this._getElement),this.memGetId=_.memoize(this._getId),this.memGetClass=_.memoize(this._getClass)},cacheElements:function(){var e,t=this.elements,i=this.options.view;for(e in t)t.hasOwnProperty(e)&&(i["$"+e]=i.$(t[e]));return this.cachedElements=!0,this},setSelf:function(e){return this.options.view.setElement(this.getCompiledHbs(e)),this.rendered=!0,this},setHtml:function(e){return this.options.view.$el.html(this.getCompiledHbs(e)),this.rendered=!0,this},setElementIds:function(){var e,t,i=this.options.view,s=this.elements,n=this.elementIds;for(e in n)n.hasOwnProperty(e)&&(t=n[e],null===t&&(t=s[e]),this.cachedElements?i["$"+e].data("id",t):i.$(s[e]).data("id",t))},isRendered:function(){return this.rendered},delegateEvents:function(){var t,i=this.events,s=this.elements,n=this.options.view,o=n.events||{};for(t in i)i.hasOwnProperty(t)&&(o[e.compile(t)(s)]=i[t]);return n.delegateEvents(o),this},getElement:function(e){return this.memGetElement(e)},getId:function(e){return this.memGetId(e)},getClass:function(e){return this.memGetClass(e)},getCompiledHbs:function(e){var t;return this._precompile(),this._prepareSettings(),t=_.clone(this.settingsElem),this.precompiledHbs(_.defaults(t,e))},_getElement:function(e){var i=this.elements[e];return t.getId(i)||t.getClass(i)},_getId:function(e){return t.getId(this.ids[e])},_getClass:function(e){return t.getClass(this.classes[e])},_precompile:function(){void 0===this.precompiledHbs&&(this.precompiledHbs=e.compile(this.template))},_prepareSettings:function(){var e,t,i;if(void 0===this.settingsElem){t=this.elements,i={};for(e in t)t.hasOwnProperty(e)&&(i[e]=this._getElement(e));this.settingsElem=i}}});return i}),define("Plugbot/base/Timer",[],function(){"use strict";var e=Backbone.Model.extend({defaults:function(){return{interval:"optimal",optimalHz:12,autoStart:!0,exitWhenNoCall:!1}},initialize:function(){_.bindAll(this,"fnTick"),this.enabled=!1,this.interval=void 0,this.items={},this.idInterval=void 0,this.suspendedAll=!1},start:function(){var e=this.get("interval");return _.isNumber(e)||("optimal"===e?e=Math.round(1e3/this.get("optimalHz")):"hz"===e.substr(-2)&&(e=Math.round(1e3/+e.substr(0,e.length-2)))),this.interval=e,this.idInterval=setInterval(this.fnTick,e),this.enabled=!0,this},fnTick:void 0,invoke:function(){return this.fnTick(),this},suspendAll:function(){return this.suspendedAll=!0,this},resumeAll:function(){return this.suspendedAll=!1,this},has:function(e){return void 0!==this.items[e]},setOptions:function(e,t){return this.items[e].options=t,this},setRuntime:function(e,t){return this.items[e].runtime=t,this},clear:function(){return this.items={},this},close:function(){clearInterval(this.idInterval),this.idInterval=null,this.clear()}});return e}),define("Plugbot/colls/Taskbar/ItemCollection",["Plugbot/models/Taskbar/ItemModel"],function(e){"use strict";var t=Backbone.Collection.extend({model:e,comparator:function(e,t){var i=0,s=-1,n=e.get("window").model,o=t.get("window").model,r=n.get("oldZIndex"),l=o.get("oldZIndex");return l>r?i=-s:r>l&&(i=s),i},close:function(){this.reset()}});return t}),define("Plugbot/colls/Userlist/ItemCollection",[],function(){"use strict";var e=Backbone.Collection.extend({comparator:function(e,t){var i=0,s=1,n=e.get("permission"),o=t.get("permission"),r=e.get("username"),l=t.get("username"),a=r.toLowerCase(),u=l.toLowerCase();return n>o?i=-s:o>n?i=s:u>a?i=-s:a>u?i=s:l>r?i=-s:r>l&&(i=s),i},close:function(){this.reset()}});return e}),define("Plugbot/events/FloatedWindow/Events",["Plugbot/base/Events"],function(e){"use strict";function t(){return _.clone(i)}var i={AFTER_RENDER:"after:render",SHOW:"show",HIDE:"hide",RESIZE_START:"resize:start",RESIZE_NOW:"resize:now",RESIZE_STOP:"resize:stop",DRAG_START:"drag:start",DRAG_NOW:"drag:now",DRAG_STOP:"drag:stop",CONTROLBOX_MINIMIZE:"control-box:minimize",CONTROLBOX_RESTORE:"control-box:restore",CONTROLBOX_CLOSE:"control-box:close",MOUSE_ENTER:"mouse-enter",MOUSE_LEAVE:"mouse-leave",CHANGE_POS:"change:pos",CHANGE_SIZE:"change:size",CHANGE_SETTINGS:"change:settings"};return function(){_.extend(i,e)}(),{getDispatcher:t}}),define("Plugbot/events/MainUi/Events",["Plugbot/base/Events"],function(e){"use strict";function t(){return _.clone(i)}var i={CHANGE_SETTINGS:"change:settings"};return function(){_.extend(i,e)}(),{getDispatcher:t}}),define("Plugbot/events/mgrs/WindowManager",["Plugbot/base/Events"],function(e){"use strict";function t(){return _.clone(i)}var i={CHANGE_SETTINGS:"change-settings"};return function(){_.extend(i,e)}(),{getDispatcher:t}}),define("Plugbot/events/site/Events",["Plugbot/base/Events","Plugbot/events/site/RoomSize","Plugbot/views/utils/Ui"],function(e,t,i){"use strict";function s(){return l}function n(){t.getLastRoomSize(),i.plugdj.$window.on("resize",r)}function o(){i.plugdj.$window.off("resize",r)}function r(e){var i=t.getLastRoomSize(),s=t.getCurrentRoomSize(),n=t.getRatio();l.dispatch("RESIZE",{e:e,lastRoomSize:i,currentRoomSize:s,ratio:n}),t.setLastRoomSize(s)}var l={RESIZE:"resize"};return function(){_.extend(l,e)}(),{getDispatcher:s,initDispatcher:n,removeDispatcher:o}}),define("Plugbot/events/site/RoomSize",["Plugbot/views/utils/Ui"],function(e){"use strict";function t(){return{width:r.width(),height:r.height()}}function i(){return void 0===o&&(o=t()),o}function s(){var e=t(),s=i();return{width:e.width/s.width,height:e.height/s.height}}function n(e){o=e}var o,r=e.plugdj.$room;return{getCurrentRoomSize:t,getLastRoomSize:i,getRatio:s,setLastRoomSize:n}}),define("Plugbot/events/Taskbar/ItemEvents",["Plugbot/base/Events"],function(e){"use strict";function t(){return _.clone(i)}var i={MOUSE_ENTER:"mouse-enter",MOUSE_LEAVE:"mouse-leave"};return function(){_.extend(i,e)}(),{getDispatcher:t}}),define("Plugbot/main/Dispose",["Plugbot/Entry","Plugbot/Loader","Plugbot/events/site/Events","Plugbot/main/mgrs/ResourceManager","Plugbot/main/Settings"],function(e,t,i,s,n){"use strict";function o(){Plugbot.disposeAndClose=function(){n.clearSettings(),Plugbot.close({saveSettings:!1})},Plugbot.disposeAndReload=function(){n.clearSettings(),Plugbot.reload({saveSettings:!1})},Plugbot.close=function(e){r(e),delete window.Plugbot},Plugbot.reload=function(e){var i,s=["initDone"];e=e||{},e.removeEntryAndLoader=!1,e.removeOtherScripts=!1,r(e),i=_.pick(Plugbot,s),delete window.Plugbot,window.Plugbot={},_.defaults(Plugbot,i),t.initialize()}}function r(e){e=e||{},_.defaults(e,{saveSettings:!0,removeEntryAndLoader:!0,removeOtherScripts:!0}),e.saveSettings&&n.saveSettings({immediate:!0}),i.removeDispatcher(),s.close(),l(e),a()}function l(t){var i;if(t.removeEntryAndLoader&&(requirejs.undef("Plugbot/Entry"),requirejs.undef("Plugbot/Loader")),t.removeOtherScripts)for(i=0;i!==e.scripts.length;i+=1)requirejs.undef(e.scripts[i])}function a(){$(document.head).children("."+e.cssClassname).remove()}return{initialize:o}}),define("Plugbot/main/Init",["Plugbot/events/site/Events","Plugbot/main/mgrs/SiteManager","Plugbot/main/mgrs/TaskbarManager","Plugbot/main/mgrs/WindowManager","Plugbot/main/mgrs/ResourceManager","Plugbot/main/Settings","Plugbot/utils/APIBuffer","Plugbot/utils/Watcher"],function(e,t,i,s,n,o,r,l){"use strict";function a(){o.readSettings(),e.initDispatcher(),u(),Plugbot.initDone()}function u(){var e,o,l,a;e=new r({tickerInterval:Plugbot.settings.tickerInterval.APICallback}),n.set("API-buffer",e),d(function(){o=new t,l=new s({windowSettings:Plugbot.settings.windows}),a=new i,h(l),n.set({"site-manager":o,"window-manager":l,"taskbar-manager":a}),o.render(),l.render(),a.render(),Plugbot.siteManager=o,Plugbot.windowManager=l,Plugbot.taskbarManager=a})}function d(e){var t=new l({interval:"1 hz",exitWhenNoCall:!0,exitValue:!0,exitCall:e});t.addFn(function(){return API.enabled}).invoke()}function h(e){var t=e.dispatcher;c.listenTo(t,t.CHANGE_SETTINGS,function(e){Plugbot.settings.windows=e.windowSettings,o.saveSettings()})}var c=_.clone(Backbone.Events);return{initialize:a}}),define("Plugbot/main/Settings",["Plugbot/store/LocalStorage","Plugbot/utils/Helpers","Plugbot/views/FloatedWindow/View","Plugbot/views/utils/Ui","Plugbot/views/utils/UiHelpers"],function(e,t,i,s,n){"use strict";function o(){Plugbot.settings=Plugbot.settings||{},Plugbot.VERSION=f,h=_.throttle(u,b)}function r(){var i=w(),s=e.readSettings(),n=d(f,s.version,g),o=d(s.version,m,g),r=function(e){var i=p();return t.extendDeep(e,i),i},l=function(){var e=w();t.applyDeep(s,e),Plugbot.settings=r(e)},a=function(){Plugbot.settings=r(i)},u=function(){Plugbot.settings.version=f};void 0!==s.version?0===n?l():1===n?1===o?(l(),u()):a():a():a()}function l(e){e=e||{},_.defaults(e,{immediate:!1}),c=e.immediate,e.immediate?u(!0):h()}function a(){e.clearSettings()}function u(i){var s;(!c||i)&&(s=w(),t.applyDeep(Plugbot.settings,s),e.saveSettings(s))}function d(e,t,i){var s,n,o,r,l,a=0,u=function(e){var t=e;return _.isFinite(e)&&(t=+e),t};if(void 0===e||void 0===t)a=null;else{for(n=e.split(i),o=t.split(i),s=0;s!==n.length&&s!==o.length;s+=1){if(r=u(n[s]),l=u(o[s]),r>l){a=1;break}if(l>r){a=-1;break}}n.length!==o.length&&(a=n>o?1:-1)}return a}var h,c,g=".",m="1.0.5.pre",f="1.0.13.pre",b=3e3,p=function(){return{tickerInterval:{defaults:1e3,APICallback:1e3},windows:{MainUi:{name:"MainUi",bodyClass:n.getClass(s.plugbot.mainUi),view:"Plugbot/views/MainUi/View",narrowAction:i.prototype.NARROW_ACTIONS.NONE,title:"Plugbot",callsign:"PB",zIndex:22,resizable:!1,draggable:!0},Userlist:{name:"Userlist",bodyClass:n.getClass(s.plugbot.userlist),view:"Plugbot/views/Userlist/View",narrowAction:i.prototype.NARROW_ACTIONS.CALLSIGN,title:"Userlist",callsign:"UL",zIndex:21,resizable:!0,draggable:!0,minWidth:120,maxWidth:320,minHeight:0,maxHeight:720}}}},w=function(){return{version:f,windows:{MainUi:{status:i.prototype.STATUS.NORMAL,x:70,y:85,width:"auto",height:"auto",settings:{autoWoot:!0,autoJoin:!1}},Userlist:{status:i.prototype.STATUS.MINIMIZED,x:730,y:70,width:240,height:400}}}};return{initialize:o,readSettings:r,saveSettings:l,clearSettings:a}}),define("Plugbot/main/mgrs/ResourceManager",[],function(){"use strict";function e(e){var t;return t=void 0!==e?s(e):n()}function t(e,t){_.isObject(e)?r(e):o(e,t)}function i(e){void 0===e?a():l(d[e])}function s(e){return d[e]}function n(){return d}function o(e,t){d[e]=t}function r(e){var t;for(t in e)e.hasOwnProperty(t)&&(d[t]=e[t])}function l(e){var t;void 0!==e&&(t=e[u],_.isFunction(t)&&e[u]())}function a(){var e;for(e in d)d.hasOwnProperty(e)&&l(d[e])}var u="close",d={};return{get:e,set:t,close:i}}),define("Plugbot/main/mgrs/SiteManager",["Plugbot/main/mgrs/ResourceManager","Plugbot/utils/Watcher","Plugbot/views/utils/Ui"],function(e,t,i){"use strict";var s=Backbone.View.extend({WATCHER_IDS:{PLAYLIST_PANEL_VISIBLE:"playlist-panel-visible"},initialize:function(){this.watcher=new t},render:function(){this._watchActivities()},_show:function(){var t=e.get("window-manager"),i=e.get("taskbar-manager");t.show(),i.show()},_hide:function(){var t=e.get("window-manager"),i=e.get("taskbar-manager");t.hide(),i.hide()},_watchActivities:function(){var e=this,t=i.plugdj.$playlistPanel,s=!0;this.watcher.add(this.WATCHER_IDS.PLAYLIST_PANEL_VISIBLE,function(){t.is(":visible")?s&&(e._hide(),s=!1):s||(e._show(),s=!0)})},_unwatchActivities:function(){this.watcher.remove(this.WATCHER_IDS.PLAYLIST_PANEL_VISIBLE)},close:function(){this.watcher.close(),this._unwatchActivities(),this.remove()}});return s}),define("Plugbot/main/mgrs/TaskbarManager",["Plugbot/models/Taskbar/Model","Plugbot/models/Taskbar/ItemModel","Plugbot/views/Taskbar/View","Plugbot/views/utils/Ui"],function(e,t,i,s){"use strict";var n=Backbone.View.extend({initialize:function(){this.taskbar=void 0},render:function(){this._initTaskbar()},show:function(){this._switchVisible(!0)},hide:function(){this._switchVisible(!1)},addOne:function(e){this.taskbar.collection.add(new t({window:e,name:e.model.get("name"),title:e.model.get("title")}))},removeOne:function(e){var t=this.taskbar.collection;t.remove(t.findWhere({name:e.model.get("name")}))},_initTaskbar:function(){var t,n;t=new e({windowTop:s.plugdj.$header.height()}),n=new i({model:t}),s.plugdj.$body.append(n.render().el),this.taskbar=n},_switchVisible:function(e){var t=this.taskbar,i=e?"removeClass":"addClass";t.$el[i](t.template.getClass("hidden"))},close:function(){this.taskbar.close(),this.remove()}});return n}),define("Plugbot/main/mgrs/WindowManager",["Plugbot/events/mgrs/WindowManager","Plugbot/main/mgrs/ResourceManager","Plugbot/models/FloatedWindow/Model","Plugbot/views/FloatedWindow/View","Plugbot/views/utils/Ui"],function(e,t,i,s,n){"use strict";var o=Backbone.View.extend({STATUS:s.prototype.STATUS,options:function(){return{windowSettings:{}}},initialize:function(){this.dispatcher=e.getDispatcher(),this.windows={},this.windowSettings={}},render:function(){this._initSettings(),this._initWindows()},show:function(){this._switchVisible(!0)},hide:function(){this._switchVisible(!1)},_initSettings:function(){this.windowSettings=this.options.windowSettings},_initWindows:function(){var e,t,o,r,l=this.options.windowSettings;for(e in l)l.hasOwnProperty(e)&&(t=l[e],o=new i(t),r=new s({model:o}),n.plugdj.$body.append(r.render().el),this.windows[e]=r,this._listenToWindow(r))},_removeWindows:function(){var e,t=this.windows;for(e in t)t.hasOwnProperty(e)&&t[e].close();this.windows={}},_switchVisible:function(e){var t,i,s=this.windows,n=e?"removeClass":"addClass";for(t in s)s.hasOwnProperty(t)&&(i=s[t],i.$el[n](i.template.getClass("hidden")))},_minimize:function(e){var i=e.model.get("name"),s=t.get("taskbar-manager");e.model.set("status",this.STATUS.MINIMIZED),this.windowSettings[i].status=this.STATUS.MINIMIZED,e.switchResizable(!1).switchDraggable(!1),e.hide(),s.addOne(e),this._dispatchChangeSettings()},_restore:function(e){var i=e.model.get("name"),s=t.get("taskbar-manager"),n=this.windowSettings[i];e.model.set("status",this.STATUS.NORMAL),this.windowSettings[i].status=this.STATUS.NORMAL,e.model.set(n),e.switchResizable(!0).switchDraggable(!0),e.show(),s.removeOne(e),this._dispatchChangeSettings()},_dispatchChangeSettings:function(){this.dispatcher.dispatch("CHANGE_SETTINGS",{windowSettings:this.windowSettings})},_listenToWindow:function(e){var t=this,i=e.dispatcher,s=e.model.get("name");this.listenTo(i,i.AFTER_RENDER,function(){var i=e.model.get("status");t.STATUS.MINIMIZED===i&&t._minimize(e)}).listenTo(i,i.CONTROLBOX_MINIMIZE,function(){var i=e.model.get("status");t.STATUS.NORMAL===i&&t._minimize(e)}).listenTo(i,i.CONTROLBOX_RESTORE,function(){var i=e.model.get("status");t.STATUS.MINIMIZED===i&&t._restore(e)}).listenTo(i,i.CHANGE_POS,function(i){var n=e.model.get("status");(t.STATUS.NORMAL===n||i.force)&&_.extend(t.windowSettings[s],i),t._dispatchChangeSettings()}).listenTo(i,i.CHANGE_SIZE,function(i){var n=e.model.get("status");t.STATUS.NORMAL===n&&_.extend(t.windowSettings[s],i),t._dispatchChangeSettings()}).listenTo(i,i.CHANGE_SETTINGS,function(e){_.extend(t.windowSettings[s].settings,e),t._dispatchChangeSettings()})},close:function(){this._removeWindows(),this.remove()}});return o}),define("Plugbot/models/FloatedWindow/Model",[],function(){"use strict";var e=Backbone.Model.extend({defaults:function(){return{name:void 0,bodyClass:"",tableLayout:void 0,status:"normal",view:void 0,visible:!0,narrowAction:"hidden",title:"Untitled",callsign:"AAA",zIndex:void 0,resizable:!1,draggable:!1,x:0,y:0,width:"auto",height:"auto",minWidth:0,maxWidth:0,minHeight:0,maxHeight:0,minimizeBox:!1,restireBox:!1,closeBox:!1}}});return e}),define("Plugbot/models/MainUi/Model",[],function(){"use strict";var e=Backbone.Model.extend({defaults:function(){return{autoWoot:!1,autoJoin:!1,skipVideo:!1}}});return e}),define("Plugbot/models/Taskbar/ItemModel",[],function(){"use strict";var e=Backbone.Model.extend({defaults:function(){return{name:void 0,title:"Unnamed",window:void 0}}});return e}),define("Plugbot/models/Taskbar/Model",[],function(){"use strict";var e=Backbone.Model.extend({defaults:function(){return{windowTop:0}}});return e}),define("Plugbot/models/Userlist/HeadModel",[],function(){"use strict";var e=Backbone.Model.extend({defaults:function(){return{waitListPos:void 0,waitListNum:void 0}},update:function(){this.set("waitListPos",API.getWaitListPosition()),this.set("waitListNum",API.getWaitList().length)}});return e}),define("Plugbot/models/Userlist/Model",[],function(){"use strict";var e=Backbone.Model.extend({});return e}),define("Plugbot/models/Userlist/UsersModel",[],function(){"use strict";var e=Backbone.Model.extend({defaults:function(){return{users:void 0}},update:function(){this.set("users",API.getUsers())}});return e}),define("Plugbot/store/LocalStorage",["Plugbot/store/LZString"],function(e){"use strict";function t(){var t,i,s={};try{t=localStorage.getItem(n),i=e.decompressFromUTF16(t)||"{}",s=JSON.parse(i)}catch(o){s={}}return s}function i(t){var i=_.compose(e.compressToUTF16,JSON.stringify)(t);localStorage.setItem(n,i)}function s(){localStorage.removeItem(n)}var n="PlugbotEnhanced";return{readSettings:t,saveSettings:i,clearSettings:s}}),define("Plugbot/store/LZString",[],function(){var e={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_f:String.fromCharCode,compressToBase64:function(t){if(null==t)return"";var i,s,n,o,r,l,a,u="",d=0;for(t=e.compress(t);d<2*t.length;)d%2==0?(i=t.charCodeAt(d/2)>>8,s=255&t.charCodeAt(d/2),n=d/2+1<t.length?t.charCodeAt(d/2+1)>>8:0/0):(i=255&t.charCodeAt((d-1)/2),(d+1)/2<t.length?(s=t.charCodeAt((d+1)/2)>>8,n=255&t.charCodeAt((d+1)/2)):s=n=0/0),d+=3,o=i>>2,r=(3&i)<<4|s>>4,l=(15&s)<<2|n>>6,a=63&n,isNaN(s)?l=a=64:isNaN(n)&&(a=64),u=u+e._keyStr.charAt(o)+e._keyStr.charAt(r)+e._keyStr.charAt(l)+e._keyStr.charAt(a);return u},decompressFromBase64:function(t){if(null==t)return"";var i,s,n,o,r,l,a,u,d="",h=0,c=0,g=e._f;for(t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");c<t.length;)r=e._keyStr.indexOf(t.charAt(c++)),l=e._keyStr.indexOf(t.charAt(c++)),a=e._keyStr.indexOf(t.charAt(c++)),u=e._keyStr.indexOf(t.charAt(c++)),s=r<<2|l>>4,n=(15&l)<<4|a>>2,o=(3&a)<<6|u,h%2==0?(i=s<<8,64!=a&&(d+=g(i|n)),64!=u&&(i=o<<8)):(d+=g(i|s),64!=a&&(i=n<<8),64!=u&&(d+=g(i|o))),h+=3;return e.decompress(d)},compressToUTF16:function(t){if(null==t)return"";var i,s,n,o="",r=0,l=e._f;for(t=e.compress(t),i=0;i<t.length;i++)switch(s=t.charCodeAt(i),r++){case 0:o+=l((s>>1)+32),n=(1&s)<<14;break;case 1:o+=l(n+(s>>2)+32),n=(3&s)<<13;break;case 2:o+=l(n+(s>>3)+32),n=(7&s)<<12;break;case 3:o+=l(n+(s>>4)+32),n=(15&s)<<11;break;case 4:o+=l(n+(s>>5)+32),n=(31&s)<<10;break;case 5:o+=l(n+(s>>6)+32),n=(63&s)<<9;break;case 6:o+=l(n+(s>>7)+32),n=(127&s)<<8;break;case 7:o+=l(n+(s>>8)+32),n=(255&s)<<7;break;case 8:o+=l(n+(s>>9)+32),n=(511&s)<<6;break;case 9:o+=l(n+(s>>10)+32),n=(1023&s)<<5;break;case 10:o+=l(n+(s>>11)+32),n=(2047&s)<<4;break;case 11:o+=l(n+(s>>12)+32),n=(4095&s)<<3;break;case 12:o+=l(n+(s>>13)+32),n=(8191&s)<<2;break;case 13:o+=l(n+(s>>14)+32),n=(16383&s)<<1;break;case 14:o+=l(n+(s>>15)+32,(32767&s)+32),r=0}return o+l(n+32)},decompressFromUTF16:function(t){if(null==t)return"";for(var i,s,n="",o=0,r=0,l=e._f;r<t.length;){switch(s=t.charCodeAt(r)-32,o++){case 0:i=s<<1;break;case 1:n+=l(i|s>>14),i=(16383&s)<<2;break;case 2:n+=l(i|s>>13),i=(8191&s)<<3;break;case 3:n+=l(i|s>>12),i=(4095&s)<<4;break;case 4:n+=l(i|s>>11),i=(2047&s)<<5;break;case 5:n+=l(i|s>>10),i=(1023&s)<<6;break;case 6:n+=l(i|s>>9),i=(511&s)<<7;break;case 7:n+=l(i|s>>8),i=(255&s)<<8;break;case 8:n+=l(i|s>>7),i=(127&s)<<9;break;case 9:n+=l(i|s>>6),i=(63&s)<<10;break;case 10:n+=l(i|s>>5),i=(31&s)<<11;break;case 11:n+=l(i|s>>4),i=(15&s)<<12;break;case 12:n+=l(i|s>>3),i=(7&s)<<13;break;case 13:n+=l(i|s>>2),i=(3&s)<<14;break;case 14:n+=l(i|s>>1),i=(1&s)<<15;break;case 15:n+=l(i|s),o=0}r++}return e.decompress(n)},compress:function(t){if(null==t)return"";var i,s,n,o={},r={},l="",a="",u="",d=2,h=3,c=2,g="",m=0,f=0,b=e._f;for(n=0;n<t.length;n+=1)if(l=t.charAt(n),Object.prototype.hasOwnProperty.call(o,l)||(o[l]=h++,r[l]=!0),a=u+l,Object.prototype.hasOwnProperty.call(o,a))u=a;else{if(Object.prototype.hasOwnProperty.call(r,u)){if(u.charCodeAt(0)<256){for(i=0;c>i;i++)m<<=1,15==f?(f=0,g+=b(m),m=0):f++;for(s=u.charCodeAt(0),i=0;8>i;i++)m=m<<1|1&s,15==f?(f=0,g+=b(m),m=0):f++,s>>=1}else{for(s=1,i=0;c>i;i++)m=m<<1|s,15==f?(f=0,g+=b(m),m=0):f++,s=0;for(s=u.charCodeAt(0),i=0;16>i;i++)m=m<<1|1&s,15==f?(f=0,g+=b(m),m=0):f++,s>>=1}d--,0==d&&(d=Math.pow(2,c),c++),delete r[u]}else for(s=o[u],i=0;c>i;i++)m=m<<1|1&s,15==f?(f=0,g+=b(m),m=0):f++,s>>=1;d--,0==d&&(d=Math.pow(2,c),c++),o[a]=h++,u=String(l)}if(""!==u){if(Object.prototype.hasOwnProperty.call(r,u)){if(u.charCodeAt(0)<256){for(i=0;c>i;i++)m<<=1,15==f?(f=0,g+=b(m),m=0):f++;for(s=u.charCodeAt(0),i=0;8>i;i++)m=m<<1|1&s,15==f?(f=0,g+=b(m),m=0):f++,s>>=1}else{for(s=1,i=0;c>i;i++)m=m<<1|s,15==f?(f=0,g+=b(m),m=0):f++,s=0;for(s=u.charCodeAt(0),i=0;16>i;i++)m=m<<1|1&s,15==f?(f=0,g+=b(m),m=0):f++,s>>=1}d--,0==d&&(d=Math.pow(2,c),c++),delete r[u]}else for(s=o[u],i=0;c>i;i++)m=m<<1|1&s,15==f?(f=0,g+=b(m),m=0):f++,s>>=1;d--,0==d&&(d=Math.pow(2,c),c++)}for(s=2,i=0;c>i;i++)m=m<<1|1&s,15==f?(f=0,g+=b(m),m=0):f++,s>>=1;for(;;){if(m<<=1,15==f){g+=b(m);break}f++}return g},decompress:function(t){if(null==t)return"";if(""==t)return null;var i,s,n,o,r,l,a,u,d=[],h=4,c=4,g=3,m="",f="",b=e._f,p={string:t,val:t.charCodeAt(0),position:32768,index:1};for(s=0;3>s;s+=1)d[s]=s;for(o=0,l=Math.pow(2,2),a=1;a!=l;)r=p.val&p.position,p.position>>=1,0==p.position&&(p.position=32768,p.val=p.string.charCodeAt(p.index++)),o|=(r>0?1:0)*a,a<<=1;switch(i=o){case 0:for(o=0,l=Math.pow(2,8),a=1;a!=l;)r=p.val&p.position,p.position>>=1,0==p.position&&(p.position=32768,p.val=p.string.charCodeAt(p.index++)),o|=(r>0?1:0)*a,a<<=1;u=b(o);break;case 1:for(o=0,l=Math.pow(2,16),a=1;a!=l;)r=p.val&p.position,p.position>>=1,0==p.position&&(p.position=32768,p.val=p.string.charCodeAt(p.index++)),o|=(r>0?1:0)*a,a<<=1;u=b(o);break;case 2:return""}for(d[3]=u,n=f=u;;){if(p.index>p.string.length)return"";for(o=0,l=Math.pow(2,g),a=1;a!=l;)r=p.val&p.position,p.position>>=1,0==p.position&&(p.position=32768,p.val=p.string.charCodeAt(p.index++)),o|=(r>0?1:0)*a,a<<=1;switch(u=o){case 0:for(o=0,l=Math.pow(2,8),a=1;a!=l;)r=p.val&p.position,p.position>>=1,0==p.position&&(p.position=32768,p.val=p.string.charCodeAt(p.index++)),o|=(r>0?1:0)*a,a<<=1;d[c++]=b(o),u=c-1,h--;break;case 1:for(o=0,l=Math.pow(2,16),a=1;a!=l;)r=p.val&p.position,p.position>>=1,0==p.position&&(p.position=32768,p.val=p.string.charCodeAt(p.index++)),o|=(r>0?1:0)*a,a<<=1;d[c++]=b(o),u=c-1,h--;break;case 2:return f}if(0==h&&(h=Math.pow(2,g),g++),d[u])m=d[u];else{if(u!==c)return null;m=n+n.charAt(0)}f+=m,d[c++]=n+m.charAt(0),h--,n=m,0==h&&(h=Math.pow(2,g),g++)}}};return e}),define("Plugbot/tmpls/FloatedWindow/View",["Plugbot/base/Template"],function(e){"use strict";var t=e.extend({elements:{elHeader:".header",elTitle:".title",elControlBox:".control-box",elMinimize:".minimize",elMaximize:".maximize",elClose:".close",elBody:".body"},elementIds:{elMinimize:null,elMaximize:null,elClose:null},classes:{hidden:".plugbot-floated-window-hidden"},template:'<div class="plugbot-floated-window">    <div class="{{elHeader}}">        <h1 class="{{elTitle}}">{{textTitle}}</h1>        <div class="{{elControlBox}}">            <button class="{{elMinimize}}" title="Minimize"></button>            <button class="{{elMaximize}}" title="Restore"></button>            <button class="{{elClose}}" title="Close"></button>        </div>    </div>    <div class="{{elBody}}"></div></div>'});return t}),define("Plugbot/tmpls/MainUi/View",["Plugbot/base/Template"],function(e){"use strict";var t=e.extend({elements:{clsItems:".item",elAutoWoot:"#plugbot-btn-auto-woot",elAutoJoin:"#plugbot-btn-auto-join",elSkipVideo:"#plugbot-btn-skip-video"},elementIds:{elAutoWoot:null,elAutoJoin:null,elSkipVideo:null},ids:{},classes:{enabled:".enabled"},events:{"click {{clsItems}}":"onClickItem"},template:'<p id="{{elAutoWoot}}" class="item">auto-woot</p><p id="{{elAutoJoin}}" class="item">auto-join</p><p id="{{elSkipVideo}}" class="item">skip-video</p>'});return t}),define("Plugbot/tmpls/Taskbar/ItemView",["Plugbot/base/Template"],function(e){"use strict";var t=e.extend({elements:{},template:'<li class="task">{{title}}</li>'});return t}),define("Plugbot/tmpls/Taskbar/View",["Plugbot/base/Template"],function(e){"use strict";var t=e.extend({elements:{elContent:".content",elHandle:".handle",elContainer:".container"},classes:{hidden:".plugbot-taskbar-hidden"},template:'<div class="plugbot-taskbar">    <div class="{{elContent}}">        <ul class="{{elContainer}}"></ul>    </div>    <div class="{{elHandle}}"></div></div>'});return t}),define("Plugbot/tmpls/Userlist/HeadView",["Plugbot/base/Template"],function(e){"use strict";var t=e.extend({elements:{},template:'<h1 class="userlist-wait-list-pos">{{textWaitListPos}}</h1>'});return t}),define("Plugbot/tmpls/Userlist/UsersItemView",["Plugbot/base/Template"],function(e){"use strict";var t=e.extend({elements:{clsItem:".item"},classes:{curated:".item-curated",woot:".item-woot",meh:".item-meh",undecided:".item-undecided"},template:'<li class="{{clsItem}} {{clsVote}}" data-id="{{id}}">{{text}}</li>'});return t}),define("Plugbot/tmpls/Userlist/View",["Plugbot/base/Template"],function(e){"use strict";
var t=e.extend({elements:{elHead:".head",elWrapUsers:".wrap-users",elUsers:".users",clsHead:".row-head",clsUsers:".row-users"},template:'<div class="{{clsHead}}">    <div class="{{elHead}}"></div></div><div class="{{clsUsers}}">    <div class="{{elWrapUsers}}">        <ul class="{{elUsers}}"></ul>    </div></div>'});return t}),define("Plugbot/utils/API",[],function(){"use strict";var e={VOLUME:{MUTE:0,MIN:0,MAX:100}},t={VOTE:{WOOT:1,UNDECIDED:0,MEH:-1}};return{PLAYBACK:e,USER:t}}),define("Plugbot/utils/APIBuffer",["Plugbot/utils/Ticker"],function(e){"use strict";var t=Backbone.Model.extend({options:function(){return{tickerInterval:1e3}},initialize:function(){this.ticker=new e},addListening:function(e,t,i,s){var n,o=this,r=function(i,s){t.listenTo(API,i,function(){o.ticker.add(e,function(){_.isFunction(s.fnCheck)?s.fnCheck()&&s.callback():s.callback()},{interval:o.options.tickerInterval})})};for(s=s||{},_.defaults(s,{fnCheck:void 0,callback:void 0}),n=0;n!==i.length;n+=1)r(i[n],s)},stopListening:function(e,t){var i,s=function(t){e.stopListening(API,t)};if(void 0===t)e.stopListening(API);else for(i=0;i!==t.length;i+=1)s(t[i])},close:function(){this.ticker.close()}});return t}),define("Plugbot/utils/Countdown",["Plugbot/base/Timer"],function(e){"use strict";var t=e.extend({defaults:function(){return{call:void 0,countdown:0}},initialize:function(){this.parent=e.prototype,this.parent.initialize.call(this),_.defaults(this.attributes,this.parent.defaults())},fnTick:function(){var e,t,i,s,n,o,r,l=this.interval;if(!this.suspendedAll){i=!0,t=this.items;for(s in t)if(t.hasOwnProperty(s)&&(i=!1,n=t[s],r=n.runtime,!r.suspended))if(o=n.options,r.elapsed+=l,r.elapsed>=o.countdown){if(_.isFunction(o.call))for(o.call.apply(this),e=0;e<r.waitCallbacks.length;e+=1)r.waitCallbacks[e]();this.remove(s)}else this.items[s].runtime=r;i&&this.get("exitWhenNoCall")&&this.close()}},add:function(e,t,i){return void 0!==this.items[e]?this:(i=i||{},_.defaults(i,{call:t,countdown:this.get("countdown")}),this.items[e]={options:i,runtime:{suspended:!1,elapsed:0,waitCallbacks:[]}},this.enabled||this.get("autoStart")&&this.start(),this)},remove:function(e){return void 0===this.items[e]?this:(delete this.items[e],this)},restart:function(e,t,i){void 0!==this.items[e]?this.resetElapsed(e):this.add(e,t,i)},wait:function(e,t){return this.items[e].runtime.waitCallbacks.push(t),this},suspend:function(e){return this.items[e].runtime.suspended=!0,this},resume:function(e){return this.items[e].runtime.suspended=!1,this},setCountdown:function(e,t){return this.items[e].options.countdown=t,this},callAndRemove:function(e){return this.items[e].options.call.apply(this),delete this.items[e],this},setElapsed:function(e,t){return this.items[e].runtime.elapsed=t,this},resetElapsed:function(e){return this.items[e].runtime.elapsed=0,this},delay:function(e,t){return this.items[e].runtime.elapsed-=t,this},forward:function(e,t){return this.items[e].runtime.elapsed+=t,this}});return t}),define("Plugbot/utils/Helpers",[],function(){"use strict";function e(t,i){var s;for(s in t)t.hasOwnProperty(s)&&(i.hasOwnProperty(s)?e(t[s],i[s]):i[s]=t[s])}function t(e,i){var s,n,o;for(s in e)e.hasOwnProperty(s)&&(n=e[s],i.hasOwnProperty(s)?(o=i[s],_.isObject(n)&&_.isObject(o)?t(n,o):i[s]=n):i[s]=n)}function i(e,t){var s,n,o;for(s in e)e.hasOwnProperty(s)&&(n=e[s],t.hasOwnProperty(s)&&(o=t[s],_.isObject(n)&&_.isObject(o)?i(n,o):t[s]=n))}function s(e){return JSON.parse(JSON.stringify(e))}return{defaultsDeep:e,extendDeep:t,applyDeep:i,cloneDeep:s}}),define("Plugbot/utils/Ticker",[],function(){"use strict";var e=Backbone.Model.extend({defaults:function(){return{interval:"optimal",optimalHz:1}},initialize:function(){this.ids={}},add:function(e,t,i){var s,n,o=this;return void 0!==this.ids[e]?this:(i=i||{},_.defaults(i,{interval:this.get("interval")}),s=i.interval,_.isNumber(s)||("optimal"===s?s=Math.round(1e3/this.get("optimalHz")):"hz"===s.substr(-2)&&(s=Math.round(1e3/+s.substr(0,s.length-2)))),n=s-Date.now()%s,this.ids[e]=setTimeout(function(){t.apply(o),delete o.ids[e]},n),this)},remove:function(e){return clearInterval(this.ids[e]),delete this.ids[e],this},has:function(e){return void 0!==this.ids[e]},clear:function(){var e,t=this.ids;for(e in t)t.hasOwnProperty(e)&&this.remove(e);return this},close:function(){this.clear()}});return e}),define("Plugbot/utils/Watcher",["Plugbot/base/Timer"],function(e){"use strict";var t=e.extend({defaults:function(){return{call:void 0,args:void 0,exitValue:0,exitCall:void 0,maxNumCall:0}},initialize:function(){this.parent=e.prototype,this.parent.initialize.call(this),_.defaults(this.attributes,this.parent.defaults())},fnTick:function(){var e,t,i,s,n,o,r,l;if(!this.suspendedAll){t=!0,e=this.items;for(i in e)e.hasOwnProperty(i)&&(t=!1,s=e[i],o=s.runtime,o.suspended||(n=s.options,l=0!==n.maxNumCall,r=n.call.apply(this,n.args),l&&(o.numCall+=1),r===n.exitValue||l&&o.numCall>n.maxNumCall?(_.isFunction(n.exitCall)&&n.exitCall(),this.remove(i)):this.items[i].runtime=o));t&&this.get("exitWhenNoCall")&&this.close()}},addFn:function(e,t){return this.add("d"+Date.now(),e,t),this},add:function(e,t,i){return void 0!==this.items[e]?this:(i=i||{},_.defaults(i,{call:t,exitValue:this.get("exitValue"),exitCall:this.get("exitCall"),maxNumCall:this.get("maxNumCall")}),this.items[e]={options:i,runtime:{suspended:!1,numCall:0}},this.enabled||this.get("autoStart")&&this.start(),this)},remove:function(e){return void 0===this.items[e]?this:(delete this.items[e],this)},suspend:function(e){return this.items[e].runtime.suspended=!0,this},resume:function(e){return this.items[e].runtime.suspended=!1,this}});return t}),define("Plugbot/views/FloatedWindow/View",["Plugbot/events/FloatedWindow/Events","Plugbot/events/site/Events","Plugbot/main/Settings","Plugbot/tmpls/FloatedWindow/View","Plugbot/utils/Watcher","Plugbot/views/utils/Ui","Plugbot/views/utils/UiHelpers"],function(e,t,i,s,n,o,r){"use strict";var l=Backbone.View.extend({STATUS:{NORMAL:"normal",HIDDEN:"hidden",MINIMIZED:"minimized"},MIN_WIDTH:160,MIN_HEIGHT:40,MAX_ZINDEX:1e4,NARROW_ACTIONS:{NONE:"none",HIDDEN:"hidden",CALLSIGN:"callsign",EXPANDED:"expanded"},CLASSES_BUTTON:["ui-icon-minus","ui-icon-extlink","ui-icon-close"],events:{mouseenter:"onMouseEnter",mouseleave:"onMouseLeave"},initialize:function(){_.bindAll(this,"resizeBody","resizeTableLayout","onClickControlBoxButton"),this.nowNarrowStatus=this.NARROW_ACTIONS.EXPANDED,this.dispatcher=e.getDispatcher(),this.template=new s({view:this}),this.bodyView=void 0,this.elemControlBox=void 0,this.listenTo(this.model,"change:visible",this.onChangeVisible).listenTo(this.model,"change:zIndex",this.onChangeZIndex).listenTo(this.model,"change:x change:y",this.onChangePos).listenTo(this.model,"change:width change:height",this.onChangeSize).listenTo(this.model,"change:resizable",this.onChangeResizable).listenTo(this.model,"change:draggable",this.onChangeDraggable),this.listenToSiteEvents()},render:function(){return this.template.setSelf({textTitle:this.model.get("title")}).cacheElements().setElementIds(),this.renderControlBoxes(),this.hide(),this.$el.css({position:"absolute",left:this.model.get("x"),top:this.model.get("y"),width:this.model.get("width"),height:this.model.get("height"),"min-width":this.MIN_WIDTH,"min-height":this.MIN_HEIGHT,"z-index":this.model.get("zIndex")}),this.$el.addClass("scheme-default-plugbot-floated-window"),this.$elBody.addClass(this.model.get("bodyClass")),this.bindUiEvents(),this.renderBody(),this},renderBody:function(){var e=this;require([this.model.get("view")],function(t){e.bodyView=new t({el:e.$elBody,settings:e.model.get("settings"),moduleWindow:e.model,dispatcherWindow:e.dispatcher}),e.listenToBody(),e.bodyView.render(),e.afterRenderBody()})},renderControlBoxes:function(){var e,t;for(this.elemControlBox=t=[this.$elMinimize,this.$elMaximize,this.$elClose],e=0;e!==t.length;e+=1)t[e].button({icons:{primary:this.CLASSES_BUTTON[e]},text:!1}),t[e].on("click",this.onClickControlBoxButton)},afterRenderBody:function(){this.show(),this.updateTitle(),this.resizeBody(),this.resizeTableLayout(),this.dispatcher.dispatch("AFTER_RENDER")},show:function(e){this.model.set("visible",!0),e=e||{},_.defaults(e,{x:this.model.get("x"),y:this.model.get("y")}),this.updatePos(e.x,e.y),this.dispatcher.dispatch("SHOW")},hide:function(){this.model.set("visible",!1),this.dispatcher.dispatch("HIDE")},resizeBody:function(){var e=this,t=function(t){r.fitElement(e.$elBody,e.$el,t,0,-e.$elHeader.outerHeight(!0))};"auto"!==this.model.get("width")&&t("width"),"auto"!==this.model.get("height")&&t("height")},resizeTableLayout:function(){var e=this.model.get("tableLayout");void 0!==e&&e.resize()},updateTitle:function(){var e,t=this.NARROW_ACTIONS,i=this.model.get("narrowAction"),s=this.model.get("title"),n=this.model.get("callsign"),o=8;switch(this.nowNarrowStatus){case t.EXPANDED:if(e=this._getRemainingHeaderSpace(o),0>e)switch(i){case t.NONE:this.$el.css("min-width",this.$el.width()-e),this.nowNarrowStatus=t.NONE;break;case t.HIDDEN:this.$elTitle.hide(),this.nowNarrowStatus=t.HIDDEN;break;case t.CALLSIGN:this.$elTitle.text("<"+n+">"),this.nowNarrowStatus=t.CALLSIGN}break;case t.NONE:break;case t.HIDDEN:this.$elTitle.text(s).show(),e=this._getRemainingHeaderSpace(o),e>=0?this.nowNarrowStatus=t.EXPANDED:this.$elTitle.hide();break;case t.CALLSIGN:this.$elTitle.text(s),e=this._getRemainingHeaderSpace(o),e>=0?this.nowNarrowStatus=t.EXPANDED:this.$elTitle.text("<"+n+">")}},updatePos:function(e,t){this.$el.css({left:e,top:t})},switchResizable:function(e){return this.model.get("resizable")&&this.$el.resizable(e?"enable":"disable"),this},switchDraggable:function(e){return this.model.get("draggable")&&(e?this.$el.draggable("enable"):(this.$el.draggable("disable"),this.$el.css("opacity",1))),this},bindUiEvents:function(){var e,t,i=this;this.model.get("resizable")&&this.$el.resizable({containment:"document",handles:"n, e, s, w, se",distance:0,grid:8,minWidth:Math.max(this.MIN_WIDTH,this.model.get("minWidth")),minHeight:Math.max(this.MIN_HEIGHT,this.model.get("minHeight")),maxWidth:this.model.get("maxWidth"),maxHeight:this.model.get("maxHeight"),start:function(s,l){e=r.iframeFix(o.plugdj.$playback),t=new n,t.addFn(i.resizeTableLayout),i.dispatcher.dispatch("RESIZE_START",{e:s,ui:l})},resize:function(e,t){i.updateTitle(),i.resizeBody(),i.dispatcher.dispatch("RESIZE_NOW",{e:e,ui:t})},stop:function(s,n){e.close(),t.invoke().close(),i.model.set({width:n.size.width,height:n.size.height}),i.dispatcher.dispatch("RESIZE_STOP",{e:s,ui:n})}}),this.model.get("draggable")&&this.$el.draggable({containment:"document",zIndex:this.MAX_ZINDEX,handle:".header",scroll:!0,scrollSensitivity:8,snap:"div",snapMode:"both",snapTolerance:8,cursor:"move",start:function(t,s){var n=$(this);n.css({width:n.width(),height:n.height()}).data({diffOfs:{X:s.position.left-s.offset.left,Y:s.position.top-s.offset.top}}),e=r.iframeFix(o.plugdj.$playback),i.dispatcher.dispatch("DRAG_START",{e:t,ui:s})},drag:function(e,t){var s=$(this).data("diffOfs");t.position.left-=s.X,t.position.top-=s.Y,i.dispatcher.dispatch("DRAG_NOW",{e:e,ui:t})},stop:function(t,s){e.close(),i.model.set({x:s.position.left,y:s.position.top}),i.dispatcher.dispatch("DRAG_STOP",{e:t,ui:s})}})},listenToSiteEvents:function(){var e=this,i=t.getDispatcher();this.listenTo(i,i.RESIZE,function(t){{var i=t.ratio;e.model.get("status")}e.resizeBody(),e.model.set({x:e.model.get("x")*i.width,y:e.model.get("y")*i.height}),this.dispatcher.dispatch("CHANGE_POS",{x:this.model.get("x"),y:this.model.get("y"),force:!0})})},listenToBody:function(){var e=this,t=this.bodyView.dispatcher;void 0!==t&&void 0!==t.CHANGE_SETTINGS&&this.listenTo(t,t.CHANGE_SETTINGS,function(t){e.dispatcher.dispatch("CHANGE_SETTINGS",t)})},onMouseEnter:function(){this.dispatcher.dispatch("MOUSE_ENTER")},onMouseLeave:function(){this.dispatcher.dispatch("MOUSE_LEAVE")},onChangeVisible:function(){this.model.get("visible")?(this.$el.show(),this.resizeBody()):this.$el.hide()},onChangeZIndex:function(){this.$el.css("z-index",this.model.get("zIndex"))},onChangePos:function(){var e=this.model.get("x"),t=this.model.get("y");this.updatePos(e,t),this.dispatcher.dispatch("CHANGE_POS",{x:e,y:t})},onChangeSize:function(){var e=this.model.get("width"),t=this.model.get("height");this.$el.css({width:e,height:t}),this.dispatcher.dispatch("CHANGE_SIZE",{width:e,height:t})},onClickControlBoxButton:function(e){var t=this,i=this.template.elements,s={cancel:!1,enabledCallback:!1,callback:function(){s.cancel||t.close()}};switch($(e.currentTarget).data("id")){case i.elMinimize:this.dispatcher.dispatch("CONTROLBOX_MINIMIZE",s);break;case i.elMaximize:this.dispatcher.dispatch("CONTROLBOX_RESTORE",s);break;case i.elClose:this.dispatcher.dispatch("CONTROLBOX_CLOSE",s),!s.enabledCallback}},_getRemainingHeaderSpace:function(e){return this.$elHeader.width()-this.$elTitle.outerWidth(!0)-this.$elControlBox.outerWidth(!0)-e},_closeControlBoxes:function(){var e,t=this.elemControlBox;for(e=0;e!==t.length;e+=1)t[e].off()},close:function(){this._closeControlBoxes(),this.bodyView.close(),this.remove()}});return l}),define("Plugbot/views/layout/TableLayout",["Plugbot/views/utils/UiHelpers"],function(e){"use strict";var t=Backbone.View.extend({options:function(){return{display:void 0,classes:[],values:[],styles:[],grows:[]}},initialize:function(){this.clsTableLayout=".plugbot-table-layout",this.cached=!1,this.elCached=[]},render:function(){this.$el.addClass(e.getClass(this.clsTableLayout)),this.$el.children("div").addClass(this.options.display),this.resize()},resize:function(){var e,t,i,s,n,o,r,l,a,u="row"===this.options.display?"width":"height",d="row"===this.options.display?"outerWidth":"outerHeight";for(this.cached||this._cacheElements(),l=this.$el[u](),a=[],r=0,e=0;e!==this.options.classes.length;e+=1)switch(i=this.elCached[e],s=this.options.values[e],n=this.options.styles[e],o=this.options.grows[e],n){case"auto":i.css(u,"auto"),l-=i[d](!0);break;case"px":i.css(u,s+"px"),l-=i[d](!0);break;case"%":i.css(u,s+"%"),l-=i[d](!0);break;case"?":i.css(u,"auto"),r+=o,a.push(e)}if(0!==r)for(l/=r,e=0;e!==a.length;e+=1)t=a[e],i=this.elCached[t],o=this.options.grows[t],i.css(u,l*o-(i[d](!0)-i[u]())+"px")},_cacheElements:function(){var e;for(e=0;e!==this.options.classes.length;e+=1)this.elCached[e]=this.$("."+this.options.classes[e]);this.cached=!0},close:function(){}});return t}),define("Plugbot/views/MainUi/View",["handlebars","Plugbot/events/MainUi/Events","Plugbot/main/mgrs/ResourceManager","Plugbot/models/MainUi/Model","Plugbot/tmpls/MainUi/View","Plugbot/utils/API","Plugbot/utils/Watcher","Plugbot/views/utils/Ui"],function(e,t,i,s,n,o,r,l){"use strict";var a=Backbone.View.extend({FADING_OVER_THRESHOLD:5,WATCHER_IDS:{AUTO_WOOT:"auto-woot",AUTO_JOIN:"auto-join",SKIP_VIDEO:"skip-video",DIALOG_PREVIEW_VISIBLE:"dialog-preview-visible",SKIP_VIDEO_AGAIN:"skip-video-again"},TEMPLATE_DIALOG_ASK:e.compile('    <div title="Exit">    <p>Exit Plugbot Enhanced?    </p></div>'),options:function(){return{settings:{},moduleWindow:void 0,dispatcherWindow:void 0}},initialize:function(){_.bindAll(this,"enableAutoWoot","disableAutoWoot","enableAutoJoin","disableAutoJoin","enableSkipVideo","disableSkipVideo","resumeSkipVideo"),this.model=new s(this.options.settings),this.dispatcher=t.getDispatcher(),this.lastVolume=void 0,this.watcher=new r({interval:"1 hz"}),this.watcherSkipVideoAgain=new r,this.pendingUpdate=!1,this.elemDialogAsk=void 0,this.template=new n({view:this}),this.listenTo(this.model,"change",this.onChangeAny),this.listenToWindow(),this.listenToAPI()},el:l.plugbot.mainUi,render:function(){return this.elemDialogAsk=$(this.TEMPLATE_DIALOG_ASK()),this.template.setHtml().cacheElements().delegateEvents().setElementIds(),this.onClickAutoWoot(this.model.get("autoWoot")).onClickAutoJoin(this.model.get("autoJoin")).onClickSkipVideo(this.model.get("skipVideo")),this.update(),this._watchActivities(),this},update:function(){var e=this.template.getClass("enabled");this.$clsItems.removeClass(e),this.model.get("autoWoot")&&this.$elAutoWoot.addClass(e),this.model.get("autoJoin")&&this.$elAutoJoin.addClass(e),this.model.get("skipVideo")&&this.$elSkipVideo.addClass(e)},listenToAPI:function(){var e=this,t=this.model.cid,s=i.get("API-buffer");s.addListening("auto-woot:"+t,this,[API.DJ_ADVANCE],{fnCheck:function(){return e.model.get("autoWoot")},callback:e.enableAutoWoot}),s.addListening("auto-join:"+t,this,[API.WAIT_LIST_UPDATE],{fnCheck:function(){return e.model.get("autoJoin")},callback:this.enableAutoJoin}),s.addListening("skip-video:"+t,this,[API.DJ_ADVANCE],{fnCheck:function(){return e.watcher.remove(e.WATCHER_IDS.SKIP_VIDEO),e.model.get("skipVideo")},callback:this.resumeSkipVideo})},listenToWindow:function(){var e=this,t=this.options.moduleWindow,i=this.options.dispatcherWindow;this.listenTo(t,"change:visible",function(t){t.get("visible")&&e.pendingUpdate&&(e.update(),e.pendindUpdate=!1)}).listenTo(i,i.CONTROLBOX_CLOSE,function(t){t.enabledCallback=!0,e.elemDialogAsk.dialog({modal:!0,draggable:!1,resizable:!1,buttons:{OK:function(){t.callback(),Plugbot.close(),$(this).dialog("close")},Cancel:function(){t.cancel=!0,t.callback(),$(this).dialog("close")}}})})},onChangeAny:function(e){var t=e.changedAttributes();this.options.moduleWindow.get("visible")?this.update():this.pendingUpdate=!0,this.dispatcher.dispatch("CHANGE_SETTINGS",t)},onClickItem:function(e){var t=$(e.currentTarget),i=this.template.elements,s=this.template.getClass("enabled"),n=!t.hasClass(s);switch(t.data("id")){case i.elAutoWoot:this.model.set("autoWoot",n),this.onClickAutoWoot(n);break;case i.elAutoJoin:this.model.set("autoJoin",n),this.onClickAutoJoin(n);break;case i.elSkipVideo:this.model.set("skipVideo",n),this.onClickSkipVideo(n)}},onClickAutoWoot:function(e){return e?this.enableAutoWoot():this.disableAutoWoot(),this},onClickAutoJoin:function(e){return e?this.enableAutoJoin():this.disableAutoJoin(),this},onClickSkipVideo:function(e){return e?this.enableSkipVideo():this.disableSkipVideo(),this},enableAutoWoot:function(){var e=API.getUser().vote,t=o.USER.VOTE.UNDECIDED,i=l.plugdj.$woot,s=function(){var s;return i.click(),e=API.getUser().vote,t!==e&&(s=0),s};t===e&&(i.click(),e=API.getUser().vote,t===e&&this.watcher.add(this.WATCHER_IDS.AUTO_WOOT,s))},disableAutoWoot:function(){this.watcher.remove(this.WATCHER_IDS.AUTO_WOOT)},enableAutoJoin:function(){var e=API.djJoin();0!==e&&this.watcher.add(this.WATCHER_IDS.AUTO_JOIN,function(){return API.djJoin()})},disableAutoJoin:function(){this.watcher.remove(this.WATCHER_IDS.AUTO_JOIN)},enableSkipVideo:function(){var e=o.PLAYBACK.VOLUME.MUTE;this.watcher.remove(this.WATCHER_IDS.SKIP_VIDEO),this.lastVolume=API.getVolume(),API.setVolume(e)},disableSkipVideo:function(){var e=this.lastVolume;this.watcher.remove(this.WATCHER_IDS.SKIP_VIDEO),this.watcherSkipVideoAgain.remove(this.WATCHER_IDS.SKIP_VIDEO_AGAIN),void 0!==e&&0===API.getVolume()&&(API.setVolume(e),this.lastVolume=void 0)},resumeSkipVideo:function(){var e,t=o.PLAYBACK.VOLUME.MAX,i=this.lastVolume;e=t===i?t-1:i+1,this.model.set("skipVideo",!1),this.disableSkipVideo(),0!==i&&this.watcher.add(this.WATCHER_IDS.SKIP_VIDEO,function(){var t,s=API.getVolume();return s===i?(API.setVolume(e),API.setVolume(i)):t=0,t})},_watchActivities:function(){var e,t,i=this,s=o.PLAYBACK.VOLUME.MUTE,n=!1,r=function(){var n,o=API.getVolume();return e?0===o?API.setVolume(s):n=0:(t.push(o),t.length>i.FADING_OVER_THRESHOLD&&t.splice(0,1),t.length===i.FADING_OVER_THRESHOLD&&_.every(t,function(e){return e===t[0]&&0!==e})&&(e=!0,API.setVolume(s),this.invoke())),n};this.watcher.add(this.WATCHER_IDS.DIALOG_PREVIEW_VISIBLE,function(){var s=$(l.plugdj.dialogPreview),o=i.model.get("skipVideo");s.is(":visible")?(i.watcherSkipVideoAgain.remove(i.WATCHER_IDS.SKIP_VIDEO_AGAIN),n=o):n&&(e=!1,t=[],i.watcherSkipVideoAgain.add(i.WATCHER_IDS.SKIP_VIDEO_AGAIN,r),n=!1)})},_unwatchActivities:function(){this.watcher.remove(this.WATCHER_IDS.DIALOG_PREVIEW_VISIBLE),this.watcherSkipVideoAgain.remove(this.WATCHER_IDS.SKIP_VIDEO_AGAIN)},close:function(){this.watcher.close(),this.watcherSkipVideoAgain.close(),this._unwatchActivities(),this.remove()}});return a}),define("Plugbot/views/Taskbar/ItemView",["Plugbot/events/Taskbar/ItemEvents","Plugbot/tmpls/Taskbar/ItemView"],function(e,t){"use strict";var i=Backbone.View.extend({events:{mouseenter:"onMouseEnter",mouseleave:"onMouseLeave"},initialize:function(){this.dispatcher=e.getDispatcher(),this.template=new t({view:this})},render:function(){return this.template.setSelf({title:this.model.get("title")}),this},onMouseEnter:function(){this.dispatcher.dispatch("MOUSE_ENTER")},onMouseLeave:function(){this.dispatcher.dispatch("MOUSE_LEAVE")},close:function(){this.remove()}});return i}),define("Plugbot/views/Taskbar/View",["Plugbot/base/SubView","Plugbot/colls/Taskbar/ItemCollection","Plugbot/events/site/Events","Plugbot/tmpls/Taskbar/View","Plugbot/utils/Countdown","Plugbot/views/Taskbar/ItemView","Plugbot/views/utils/Ui","Plugbot/views/utils/UiHelpers"],function(e,t,i,s,n,o,r,l){"use strict";var a=e.extend({COUNTDOWN_IDS:{MOUSE_LEAVE:"mouse-leave",MOUSE_ENTER:"mouse-enter"},MAX_ZINDEX:1e4,COUNTDOWN_MOUSE_ENTER:100,COUNTDOWN_MOUSE_LEAVE:500,COUNTDOWN_ITEM_MOUSE_ENTER:300,COUNTDOWN_ITEM_MOUSE_LEAVE:300,DURATION_ANIMATE_EXPAND:200,DURATION_ANIMATE_COLLAPSE:200,events:{mouseenter:"onMouseEnter",mouseleave:"onMouseLeave"},initialize:function(){_.bindAll(this,"onWindowScroll"),this.parent=e.prototype,this.parent.initialize.call(this),this.currentWindow=void 0,this.countdownSlide=new n,this.countdownTask=new n,this.template=new s({view:this}),this.collection=new t,this.listenTo(this.collection,"add",this.addOne).listenTo(this.collection,"remove",this.removeOne),this.bindUiEvents(),this.listenToSiteEvents()},render:function(){return this.template.setSelf().cacheElements(),this.update(),this.$el.trigger("mouseleave"),this},update:function(){var e=r.plugdj.$window,t=r.plugdj.$header,i=r.plugdj.$room;this.$el.css({top:t.height()-e.scrollTop(),height:i.height()})},addOne:function(e,t){var i=new o({model:e}),s=t.indexOf(e),n=e.get("window");this.setSubView(e.cid,i),l.insertAt(i.render().el,this.$elContainer,s),this.listenToItem(i),this.listenToWindow(n)},removeOne:function(e){var t=e.cid,i=this.getSubView(t),s=e.get("window");this.countdownSlide.resumeAll(),this.countdownTask.resumeAll(),this.currentWindow=void 0,this.stopListeningItem(i),this.stopListeningWindow(s),this.closeSubView(t)},showWindow:function(e){e.model.set("zIndex",this.MAX_ZINDEX),e.show({x:this.$el.width()+r.plugdj.$window.scrollLeft(),y:this.model.get("windowTop")})},hideWindow:function(e){e.hide()},expand:function(){this.$el.animate({left:0},this.DURATION_ANIMATE_EXPAND)},collapse:function(){this.$el.animate({left:-this.$elContent.width()},this.DURATION_ANIMATE_COLLAPSE)},bindUiEvents:function(){r.plugdj.$window.on("scroll",this.onWindowScroll)},unbindUiEvents:function(){r.plugdj.$window.off("scroll",this.onWindowScroll)},listenToSiteEvents:function(){var e=this,t=i.getDispatcher();this.listenTo(t,t.RESIZE,function(){e.update(),void 0!==e.currentWindow&&e.showWindow(e.currentWindow)})},listenToItem:function(e){var t=this,i=e.dispatcher,s=e.model.get("window"),n=e.model.cid,o=this.COUNTDOWN_IDS.MOUSE_LEAVE+":"+n,r=this.COUNTDOWN_IDS.MOUSE_ENTER+":"+n;this.listenTo(i,i.MOUSE_ENTER,function(){t.countdownTask.remove(o).add(r,function(){t.currentWindow=s,t.showWindow(s)},{countdown:t.COUNTDOWN_ITEM_MOUSE_ENTER})}).listenTo(i,i.MOUSE_LEAVE,function(){t.countdownTask.remove(r).add(o,function(){t.currentWindow=void 0,t.hideWindow(s)},{countdown:t.COUNTDOWN_ITEM_MOUSE_LEAVE})})},listenToWindow:function(e){var t=e.dispatcher,i=this.countdownSlide,s=this.countdownTask;this.listenTo(t,t.MOUSE_ENTER,function(){i.suspendAll(),s.suspendAll()}).listenTo(t,t.MOUSE_LEAVE,function(){i.resumeAll(),s.resumeAll()})},stopListeningItem:function(e){var t=e.dispatcher,i=e.model.cid;this.stopListening(t),this.countdownTask.remove("mouse-enter:"+i).remove("mouse-leave:"+i)},stopListeningWindow:function(e){var t=e.dispatcher;this.stopListening(t)},onWindowScroll:function(){var e=this.currentWindow;this.update(),void 0!==e&&this.showWindow(this.currentWindow)},onMouseEnter:function(){var e=this;this.countdownSlide.remove(this.COUNTDOWN_IDS.MOUSE_LEAVE).add(this.COUNTDOWN_IDS.MOUSE_ENTER,function(){e.expand()},{countdown:this.COUNTDOWN_MOUSE_ENTER})},onMouseLeave:function(){var e=this;this.countdownSlide.remove(this.COUNTDOWN_IDS.MOUSE_ENTER).add(this.COUNTDOWN_IDS.MOUSE_LEAVE,function(){e.collapse()},{countdown:this.COUNTDOWN_MOUSE_LEAVE})},close:function(){this.collection.close(),this.unbindUiEvents(),this.closeAllSubViews(),this.remove()}});return a}),define("Plugbot/views/Userlist/HeadView",["Plugbot/models/Userlist/HeadModel","Plugbot/tmpls/Userlist/HeadView"],function(e,t){"use strict";var i=Backbone.View.extend({initialize:function(){this.model=new e,this.template=new t({view:this}),this.listenTo(this.model,"change",this.render)},renderFromParent:function(){this.model.update()},render:function(){var e=this.model.get("waitListPos");return this.template.setHtml({textWaitListPos:"Waitlist: "+(-1===e?"-":e+1)+" / "+this.model.get("waitListNum")}),this},close:function(){this.remove()}});return i}),define("Plugbot/views/Userlist/UsersItemView",["Plugbot/tmpls/Userlist/UsersItemView","Plugbot/utils/API","Plugbot/views/utils/Ui"],function(e,t,i){"use strict";var s=Backbone.View.extend({initialize:function(){this.template=new e({view:this}),this.render()},events:{click:"onClick"},render:function(){return this.template.setSelf({id:this.model.get("id"),clsVote:this.getClass(),text:this.model.get("username")}),this},getClass:function(){var e,i=this.template,s=t.USER.VOTE,n=this.model.get("curated"),o=this.model.get("vote");if(n)e=i.getClass("curated");else switch(o){case s.WOOT:e=i.getClass("woot");break;case s.MEH:e=i.getClass("meh");break;case s.UNDECIDED:e=i.getClass("undecided")}return e},onClick:function(){i.plugdj.$chatInputField.val("@"+this.model.get("username")+" ").focus()},close:function(){this.remove()}});return s}),define("Plugbot/views/Userlist/UsersView",["Plugbot/base/SubView","Plugbot/colls/Userlist/ItemCollection","Plugbot/models/Userlist/UsersModel","Plugbot/utils/Countdown","Plugbot/views/Userlist/UsersItemView","Plugbot/views/utils/UiHelpers"],function(e,t,i,s,n,o){"use strict";var r=e.extend({COUNTDOWN_IDS:{USERS_ERROR:"users-error"},COUNTDOWN_USERS_ERROR:1e4,initialize:function(){this.parent=e.prototype,this.parent.initialize.call(this),this.countdownError=new s,this.firstUpdateData=!0,this.model=new i,this.collection=new t,this.listenTo(this.collection,"add",this.addOne).listenTo(this.collection,"remove",this.removeOne).listenTo(this.collection,"change:vote change:curated change:username",this.changeOne)},updateData:function(){this.model.update(),this.collection.set(this.model.get("users")),this.firstUpdateData=!1},renderFromParent:function(){this.$el.hide(),this.updateData(),this.$el.show()},render:function(){this.collection.reset(),this.closeAllSubViews(),this.$el.empty(),this.firstUpdateData=!0,this.$el.hide(),this.updateData(),this.$el.show()},addOne:function(e,t){var i=this,s=t.indexOf(e),r=new n({model:e});this.setSubView(e.get("id"),r),_.defer(function(){o.insertAt(r.$el,i.$el,s)}),this.verify()},removeOne:function(e){this.closeSubView(e.get("id")),this.verify()},changeOne:function(e){var t=this.collection.indexOf(e),i=this.getSubView(e.get("id"));i.model.set({vote:e.get("vote"),curated:e.get("curated"),username:e.get("username")}),i.render(),o.replaceAt(i.$el,this.$el,t)},verify:function(){if(!this.firstUpdateData){var e,t=this,i=this.collection.models,s=this.$el.children(),n=!1,o=function(){t.render()};for(e=0;e<i.length;e+=1)if($(s[e]).text()!==i[e].get("username")){n=!0,this.countdownError.add(this.COUNTDOWN_IDS.USERS_ERROR,o,{countdown:this.COUNTDOWN_USERS_ERROR});break}n||this.countdownError.remove(this.COUNTDOWN_IDS.USERS_ERROR)}},checkValid:function(){var e=!0,t=0,i=API.getUsers();return _.each(this.$el.children(),function(s){if(e){var n=i[t];if(s=$(s),s.text()!==n.username)return void(e=!1);if(s.hasClass("item-woot")&&1!==n.vote)return void(e=!1);if(s.hasClass("item-meh")&&-1!==n.vote)return void(e=!1);if(s.hasClass("item-curated")&&!0!==n.curated)return void(e=!1);t+=1,t>i.length&&(e=!1)}}),e},close:function(){this.countdownError.close(),this.collection.close(),this.closeAllSubViews(),this.remove()}});return r}),define("Plugbot/views/Userlist/View",["Plugbot/base/SubView","Plugbot/main/mgrs/ResourceManager","Plugbot/models/Userlist/Model","Plugbot/tmpls/Userlist/View","Plugbot/utils/Ticker","Plugbot/views/layout/TableLayout","Plugbot/views/Userlist/HeadView","Plugbot/views/Userlist/UsersView"],function(e,t,i,s,n,o,r,l){"use strict";var a=e.extend({TICKER_IDS:{UPDATE_USERS_REAR_SPACE:"update-users-rear-space"},options:function(){return{moduleWindow:void 0,dispatcherWindow:void 0}},initialize:function(){var t;_.bindAll(this,"renderHead","renderUsers"),this.parent=e.prototype,this.parent.initialize.call(this),this.model=new i,this.renderOverElapsed=5,this.ticker=new n({interval:"optimal"}),this.pendingRenderHead=!1,this.pendingRenderUsers=!1,this.template=t=new s({view:this}),this.tableLayout=new o({el:this.$el,display:"column",classes:[t.getElement("clsHead"),t.getElement("clsUsers")],values:[0,0],styles:["auto","?"],grows:[0,1]}),this.listenToAPI()},render:function(){return this.template.setHtml().cacheElements(),this.$el.addClass("scheme-default-plugbot-userlist"),this.options.moduleWindow.set("tableLayout",this.tableLayout),this.tableLayout.render(),this.subViews({head:new r({el:this.$elHead}),users:new l({el:this.$elUsers})}).renderSub(),this.listenToWindow(),this},renderHead:function(){return this.renderSub("head"),this},renderUsers:function(){return this.renderSub("users"),this},updateListRearSpace:function(){var e=this;this.ticker.add(this.TICKER_IDS.UPDATE_USERS_REAR_SPACE,function(){e.$elUsers.css("padding-bottom",.5*e.$elWrapUsers.height())})},listenToAPI:function(){var e=this,i=this.model.cid,s=t.get("API-buffer"),n=function(t){var i;if(e.options.moduleWindow.get("visible"))i=API.getTimeElapsed()>=e.renderOverElapsed?!0:!1;else{switch(t){case"head":e.pendingRenderHead=!0;break;case"users":e.pendingRenderUsers=!0}i=!1}return i};s.addListening("head:"+i,this,[API.WAIT_LIST_UPDATE,API.DJ_UPDATE],{fnCheck:function(){return n("head")},callback:this.renderHead}),s.addListening("users:"+i,this,[API.VOTE_UPDATE,API.CURATE_UPDATE,API.USER_JOIN,API.USER_LEAVE],{fnCheck:function(){return n("users")},callback:this.renderUsers})},listenToWindow:function(){var e=this,t=this.options.moduleWindow,i=this.options.dispatcherWindow;this.listenTo(t,"change:visible",function(t){t.get("visible")&&(e.updateListRearSpace(),e.pendingRenderHead&&(e.renderHead(),e.pendingRenderHead=!1),e.pendingRenderUsers&&(e.renderUsers(),e.pendingRenderUsers=!1))}),this.listenTo(i,i.AFTER_RENDER,function(){e.updateListRearSpace()}).listenTo(i,i.RESIZE_NOW,function(){e.updateListRearSpace()}).listenTo(i,i.RESIZE_START,function(){e.updateListRearSpace()})},close:function(){this.ticker.close(),this.tableLayout.close(),this.closeAllSubViews(),this.remove()}});return a}),define("Plugbot/views/utils/Ui",[],function(){"use strict";function e(){var e,s=_.omit(t,i);for(e in s)s.hasOwnProperty(e)&&(t["$"+e]=$(t[e]))}var t={window:window,body:document.body,header:"#header",room:"#room",playback:"#playback",playlistPanel:"#playlist-panel",dialogPreview:"#dialog-preview",chatInputField:"#chat-input-field",woot:"#woot"},i=["dialogPreview"],s={mainUi:".plugbot-main-ui",userlist:".plugbot-userlist"};return function(){e()}(),{plugdj:t,plugbot:s}}),define("Plugbot/views/utils/UiHelpers",["Plugbot/utils/Watcher"],function(e){"use strict";function t(e){var t;return t="#"===e[0]?e.substr(1):null}function i(e){var t;return t="."===e[0]?e.substr(1):null}function s(e,t){var i;switch(t){case"width":i=e.outerWidth()-e.innerWidth();
break;case"height":i=e.outerHeight()-e.innerHeight();break;case"both":i={width:e.outerWidth()-e.innerWidth(),height:e.outerHeight()-e.innerHeight()}}return i}function n(e,t){var i;switch(t){case"width":i=e.innerWidth()-e.width();break;case"height":i=e.innerWidth()-e.width();break;case"both":i={width:e.innerWidth()-e.width(),height:e.innerWidth()-e.width()}}return i}function o(e,t){var i;switch(t){case"width":i=e.outerWidth(!0)-e.outerWidth();break;case"height":i=e.outerHeight(!0)-e.outerWidth();break;case"both":i={width:e.outerWidth(!0)-e.outerWidth(),height:e.outerHeight(!0)-e.outerWidth()}}return i}function r(e,t){var i,s,o=e.children();switch(t){case"width":s=n(e,"width");break;case"height":s=n(e,"height");break;case"both":s={width:n(e,"width"),height:n(e,"height")}}for(i=0;i!==o.length;i+=1)switch(t){case"width":s+=o[i].outerWidth(!0);break;case"height":s+=o[i].outerHeight(!0);break;case"both":s.width+=o[i].outerWidth(!0),s.height+=o[i].outerHeight(!0)}return s}function l(e,t,i){var s=t.children();s.length===i?t.append(e):s.eq(i).before(e)}function a(e,t){e.children().eq(t).remove()}function u(e,t,i){t.children().eq(i).replaceWith(e)}function d(e,t,i,s,n){var o=e.outerWidth(!0)-e.width(),r=e.outerHeight(!0)-e.height();switch(s=s||0,n=n||0,i){case"width":e.width(t.width()-o+s);break;case"height":e.height(t.height()-r+n);break;case"both":e.width(t.width()-o+s),e.height(t.height()-r+n)}}function h(t){var i=t.css("pointer-events"),s=new e,n=function(e){return 0===e.length?0:(e.css("pointer-events","none"),1)};return s.addFn(n,{args:[t]}),n(t),{close:function(){c(s,t,i)}}}function c(e,t,i){t.css("pointer-events",i),e.close()}return{getId:t,getClass:i,getBorder:s,getPadding:n,getMargin:o,getMinFloatSize:r,insertAt:l,removeAt:a,replaceAt:u,fitElement:d,iframeFix:h}});
//# sourceMappingURL=release.min.js.map