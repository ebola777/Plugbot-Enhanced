/* @license
 * Copyright (C) 2013  Shawn
 * This program is licensed under the MIT license.
 */
!function(){"use strict";var t;return t=document.getElementById("plugbot-js"),null!==t&&t.parentElement.removeChild(t),void 0!==window.Plugbot?(void 0!==Plugbot.reload&&Plugbot.reload(),void 0):(window.Plugbot={},Plugbot.simpleRemove=function(){void 0!==window.requirejs&&(requirejs.undef("Plugbot/Entry"),requirejs.undef("Plugbot/Loader")),delete window.Plugbot},Plugbot.initDone=function(){delete Plugbot.simpleRemove},void 0!==window.API&&requirejs.specified("room")?(require(["Plugbot/Loader"],function(t){t.initialize()}),void 0):(Plugbot.simpleRemove(),void 0))}(),define("Plugbot/Entry",[],function(){"use strict";var t=function(){return{environment:"RELEASE",baseUrl:"ebola777.github.io/files/Plugbot-Enhanced/",scriptDir:"js/",cssDir:"css/",scripts:["Plugbot/base/Events","Plugbot/base/Template","Plugbot/base/Timer","Plugbot/colls/MainUi/ItemCollection","Plugbot/colls/Taskbar/ItemCollection","Plugbot/colls/Userlist/ItemCollection","Plugbot/events/FloatedWindow/Events","Plugbot/events/Taskbar/ItemEvents","Plugbot/events/SiteEvents","Plugbot/main/Dispose","Plugbot/main/Init","Plugbot/main/Settings","Plugbot/main/WindowManager","Plugbot/models/FloatedWindow/Model","Plugbot/models/MainUi/ItemModel","Plugbot/models/MainUi/Model","Plugbot/models/Taskbar/ItemModel","Plugbot/models/Taskbar/Model","Plugbot/models/Userlist/ItemModel","Plugbot/models/Userlist/Model","Plugbot/store/LocalStorage","Plugbot/store/LZString","Plugbot/tmpls/FloatedWindow/View","Plugbot/tmpls/MainUi/ItemView","Plugbot/tmpls/Taskbar/ItemView","Plugbot/tmpls/Taskbar/View","Plugbot/tmpls/Userlist/HeadView","Plugbot/tmpls/Userlist/UsersItemView","Plugbot/tmpls/Userlist/View","Plugbot/utils/API","Plugbot/utils/APIBuffer","Plugbot/utils/Countdown","Plugbot/utils/Helpers","Plugbot/utils/Ticker","Plugbot/utils/Watcher","Plugbot/views/FloatedWindow/View","Plugbot/views/layout/TableLayout","Plugbot/views/MainUi/ItemView","Plugbot/views/MainUi/View","Plugbot/views/Taskbar/View","Plugbot/views/Taskbar/ItemView","Plugbot/views/Userlist/HeadView","Plugbot/views/Userlist/UsersItemView","Plugbot/views/Userlist/UsersView","Plugbot/views/Userlist/View","Plugbot/views/utils/Ui","Plugbot/views/utils/UiHelpers"],scriptDep:["Plugbot/main/Settings","Plugbot/main/Init","Plugbot/main/Dispose"],refScriptsUrl:["ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/jquery-ui.min.js"],cssUrl:["style.min.css"],refCssUrl:["ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/themes/smoothness/jquery-ui.min.css"],cssClassname:"css-plugbot-enhanced",getRefScriptUrl:function(t){return"http://"+t},getCssUrl:function(t){return"http://"+this.baseUrl+this.cssDir+t},getRefCssUrl:function(t){return"http://"+t}}}();return t}),define("Plugbot/Loader",["Plugbot/Entry"],function(t){"use strict";var e=function(){return{timeoutLoading:5e3,intervalRetry:1e3,maxNumRetry:2,fnNameLoadDep:"initialize",numFiles:void 0,numLoadedFiles:void 0,loadedFiles:void 0,aborted:void 0,initialize:function(){var e,i=0,s=[],n=[];for(this.numFiles=0,this.numLoadedFiles=0,this.loadedFiles={},this.aborted=!1,e=0;e!==t.refScriptsUrl.length;e+=1)s.push(t.getRefScriptUrl(t.refScriptsUrl[e])),i+=1;for(e=0;e!==t.cssUrl.length;e+=1)n.push(t.getCssUrl(t.cssUrl[e])),i+=1;for(e=0;e!==t.refCssUrl.length;e+=1)n.push(t.getRefCssUrl(t.refCssUrl[e])),i+=1;if(0===i)return this.loadDep(),void 0;for(this.numFiles=i,e=0;e!==n.length;e+=1)this.loadCss(n[e]);for(e=0;e!==s.length;e+=1)this.loadScript(s[e],0)},loadDep:function(){var e,i,s,n=this,o=t.scriptDep;require(o,function(){for(e=0;e!==o.length;e+=1)i=require(o[e]),void 0!==i&&(s=i[n.fnNameLoadDep],void 0!==s&&s())})},fileDone:function(t){this.isFileLoaded(t)||(this.loadedFiles[t]=!0,this.numLoadedFiles+=1,this.numLoadedFiles===this.numFiles&&this.loadDep())},fileFail:function(t,e){this.aborted||(this.aborted=!0,_.defaults(e,{textError:"Unknown"}),alert("Failed to load PlugBot file, stopping now.\n\nFile: "+t+"\nError: "+e.textError),Plugbot.simpleRemove())},loadScript:function(t,e){var i=this;this.aborted||this.getScript(t,{timeout:this.timeoutLoading},function(){i.aborted||i.fileDone(t)},function(s){return i.aborted?void 0:(e=e||0,e+=1,e===i.maxNumRetry?(i.fileFail(t,{textError:s.status}),void 0):(setTimeout(function(){i.aborted||i.isFileLoaded(t)||i.loadScript(t,e)},i.intervalRetry),void 0))})},loadCss:function(e,i){var s=this;this.aborted||this.getCss(e,{timeout:this.timeoutLoading,classname:t.cssClassname},function(){s.aborted||s.fileDone(e)},function(){return s.aborted?void 0:(i=i||0,i+=1,i===s.maxNumRetry?(s.fileFail(e,{textError:"Timeout"}),void 0):(setTimeout(function(){s.aborted||s.isFileLoaded(e)||s.loadCss(e,i)},s.intervalRetry),void 0))})},getScript:function(t,e,i,s){$.ajax({url:t,dataType:"script",crossDomain:!0,timeout:e.timeout,cache:!1}).done(i).fail(s)},getCss:function(t,e,i,s){var n,o;n=$(document.createElement("link")).prop({"class":e.classname,rel:"stylesheet",type:"text/css",href:t}),o=setTimeout(s,e.timeout),n[0].onload=function(){clearTimeout(o),i()},$(document.head).append(n)},isFileLoaded:function(t){return void 0!==this.loadedFiles[t]}}}();return e}),define("Plugbot/base/Events",[],function(){"use strict";var t={dispatch:function(t,e){var i=this[t];if(void 0===i)throw'Cannot find event "'+t+'".';this.trigger(this[t],e)}};return function(){_.extend(t,Backbone.Events)}(),t}),define("Plugbot/base/Template",["handlebars"],function(t){"use strict";var e=Backbone.View.extend({defaults:function(){return{view:void 0,precompiledHbs:void 0,settingsElem:void 0}},initialize:function(){_.bindAll(this)},cacheElements:function(){var t,e=this.elements,i=this.options.view;for(t in e)e.hasOwnProperty(t)&&(i["$"+t]=i.$(e[t]));return this},setSelf:function(t){return this.options.view.setElement(this._getCompiledHbs(t)),this},setHtml:function(t){return this.options.view.$el.html(this._getCompiledHbs(t)),this},_getCompiledHbs:function(t){var e;return this._precompile(),this._prepareSettings(),e=_.clone(this.settingsElem),this.precompiledHbs(_.defaults(e,t))},_precompile:function(){void 0===this.precompiledHbs&&(this.precompiledHbs=t.compile(this.template))},_prepareSettings:function(){var t,e,i;if(void 0===this.settingsElem){e=this.elements,i={};for(t in e)e.hasOwnProperty(t)&&(i[t]=e[t]);this.settingsElem=i}}});return e}),define("Plugbot/base/Timer",[],function(){"use strict";var t=Backbone.Model.extend({defaults:function(){return{interval:"optimal",optimalHz:12,autoStart:!0,exitWhenNoCall:!1,enabled:!1,items:{},idInterval:void 0,suspendedAll:!1}},initialize:function(){_.bindAll(this),_.defaults(this,this.attributes)},start:function(){var t=this.interval;return"optimal"===t?t=Math.round(1e3/this.optimalHz):"hz"===this.interval.substr(-2)&&(t=Math.round(1e3/+t.substr(0,t.length-2))),this.interval=t,this.idInterval=window.setInterval(this.fnTick,t),this.enabled=!0,this},fnTick:void 0,invoke:function(){return this.fnTick(),this},suspendAll:function(){return this.suspendedAll=!0,this},resumeAll:function(){return this.suspendedAll=!1,this},has:function(t){return void 0!==this.items[t]},setOptions:function(t,e){return this.items[t].options=e,this},setRuntime:function(t,e){return this.items[t].runtime=e,this},clear:function(){return this.items={},this},close:function(){clearInterval(this.idInterval),this.clear()}});return t}),define("Plugbot/colls/MainUi/ItemCollection",["Plugbot/models/MainUi/ItemModel"],function(t){"use strict";var e=Backbone.Collection.extend({model:t,initialize:function(){_.bindAll(this)},close:function(){this.reset()}});return e}),define("Plugbot/colls/Taskbar/ItemCollection",["Plugbot/models/Taskbar/ItemModel"],function(t){"use strict";var e=Backbone.Collection.extend({model:t,initialize:function(){_.bindAll(this)},comparator:function(t,e){var i=0,s=-1,n=t.get("window").model,o=e.get("window").model,l=n.get("oldZIndex"),a=o.get("oldZIndex");return a>l?i=-s:l>a&&(i=s),i},close:function(){this.reset()}});return e}),define("Plugbot/colls/Userlist/ItemCollection",["Plugbot/models/Userlist/ItemModel"],function(t){"use strict";var e=Backbone.Collection.extend({model:t,initialize:function(){_.bindAll(this)},comparator:function(t,e){var i=0,s=1,n=t.get("user"),o=e.get("user"),l=+n.permission,a=+o.permission,r=n.username.toUpperCase(),d=o.username.toUpperCase();return l>a?i=-s:a>l?i=s:d>r?i=-s:r>d&&(i=s),i},close:function(){this.reset()}});return e}),define("Plugbot/events/SiteEvents",["Plugbot/base/Events"],function(t){"use strict";function e(){$(window).on("resize",s)}function i(){$(window).off("resize",s)}function s(t){n.dispatch("RESIZE",[t])}var n={RESIZE:"resize"};return function(){_.extend(n,t)}(),{dispatcher:n,initDispatcher:e,removeDispatcher:i}}),define("Plugbot/events/FloatedWindow/Events",["Plugbot/base/Events"],function(t){"use strict";var e={CHANGEANY_MODEL:"change-any:model",AFTER_RENDER:"after:render",SHOW:"show",HIDE:"hide",RESIZE_START:"resize:start",RESIZE_NOW:"resize:now",RESIZE_STOP:"resize:stop",DRAG_START:"drag:start",DRAG_NOW:"drag:now",DRAG_STOP:"drag:stop",CONTROLBOX_MINIMIZE:"control-box:minimize",CONTROLBOX_MAXIMIZE:"control-box:maximize",CONTROLBOX_CLOSE:"control-box:close",MOUSE_ENTER:"mouse-enter",MOUSE_LEAVE:"mouse-leave"};return function(){_.extend(e,t)}(),e}),define("Plugbot/events/Taskbar/ItemEvents",["Plugbot/base/Events"],function(t){"use strict";var e={MOUSE_ENTER:"mouse-enter",MOUSE_LEAVE:"mouse-leave"};return function(){_.extend(e,t)}(),e}),define("Plugbot/main/Dispose",["Plugbot/Entry","Plugbot/Loader","Plugbot/events/SiteEvents","Plugbot/main/Settings","Plugbot/main/WindowManager","Plugbot/utils/APIBuffer","Plugbot/utils/Helpers"],function(t,e,i,s,n,o,l){"use strict";function a(){Plugbot.disposeAndClose=function(){s.clearSettings(),Plugbot.close({saveSettings:!1})},Plugbot.disposeAndReload=function(){s.clearSettings(),Plugbot.reload({saveSettings:!1})},Plugbot.close=function(t){r(t),delete window.Plugbot},Plugbot.reload=function(t){var i,s=["initDone"],n={};for(t=t||{},t.removeEntryAndLoader=!1,r(t),i=0;i!==s.length;i+=1)n[s[i]]=Plugbot[s[i]];for(delete window.Plugbot,window.Plugbot={},i=0;i!==s.length;i+=1)Plugbot[s[i]]=n[s[i]];e.initialize()}}function r(t){t=t||{},_.defaults(t,{saveSettings:!0,removeEntryAndLoader:!0}),t.saveSettings&&s.saveSettings({immediate:!0}),l.removeHandlebarsHelpers(),Plugbot.watcher.close(),Plugbot.ticker.close(),o.close(),i.removeDispatcher(),c(),d(t.removeEntryAndLoader),u()}function d(e){var i;if(e&&(requirejs.undef("Plugbot/Entry"),requirejs.undef("Plugbot/Loader")),"DEBUG"===t.environment)for(i=0;i!==t.scripts.length;i+=1)requirejs.undef(t.scripts[i])}function u(){$(document.head).children("."+t.cssClassname).remove()}function c(){n.removeTaskbar(),n.removeWindows(),n.removeEvents()}return{initialize:a}}),define("Plugbot/main/Init",["Plugbot/events/SiteEvents","Plugbot/main/Settings","Plugbot/main/WindowManager","Plugbot/utils/Helpers","Plugbot/utils/Ticker","Plugbot/utils/Watcher"],function(t,e,i,s,n,o){"use strict";function l(){e.readSettings(),s.initHandlebarsHelpers(),d(),u(),t.initDispatcher(),a(),Plugbot.initDone()}function a(){r(function(){i.initTaskbar(),i.initWindows(),i.initEvents(),i.initPublicMethods()})}function r(t){var e=new o({interval:"1 hz",exitWhenNoCall:!0,defaultOptions:{exitValue:!0,exitCall:t}});e.addFn(function(){return API.enabled}).invoke()}function d(){Plugbot.watcher=new o}function u(){Plugbot.ticker=function(){return{_ticker:new n,add:function(t,e,i){var s=this.getId(t);this._ticker.add(s,e,i)},remove:function(t){var e=this.getId(t);this._ticker.remove(e)},clear:function(){this._ticker.clear()},getId:function(t){var e,i=Plugbot.settings.tickerIds[t];if(void 0===i)throw"ticker key "+t+" not found";return e=i},close:function(){this._ticker.close()}}}()}return{initialize:l}}),define("Plugbot/main/Settings",["Plugbot/store/LocalStorage","Plugbot/utils/Helpers","Plugbot/views/utils/Ui","Plugbot/views/utils/UiHelpers"],function(t,e,i,s){"use strict";function n(){Plugbot.settings=Plugbot.settings||{}}function o(){var i=t.readSettings(),s=c.version,n=function(t){var i=_.clone(u);return e.extendDeep(t,i),i},o=function(){var t=_.clone(c);e.applyDeep(i,t),Plugbot.settings=n(t)},l=function(){Plugbot.settings=n(c)};void 0!==i.version?s===i.version?o():""!==d&&i.version>=d?(o(),Plugbot.settings.version=s):l():l()}function l(t){t=t||{},_.defaults(t,{immediate:!1}),t.immediate?r():Plugbot.ticker.add("saveSettings",function(){r()},{interval:Plugbot.settings.tickerInterval.saveSettings})}function a(){t.clearSettings()}function r(){var i=_.clone(c);e.applyDeep(Plugbot.settings,i),t.saveSettings(i)}var d="1.0.5.pre",u={tickerIds:{saveSettings:"save-settings",saveWindow:"save-window"},tickerInterval:{defaults:1e3,APICallback:3e3,saveSettings:5e3},windows:{MainUi:{name:"MainUi",bodyClass:s.getClass(i.plugbot.mainUi),view:"Plugbot/views/MainUi/View",narrowAction:"none",title:"Plugbot",callsign:"PB",zIndex:22,resizable:!1,draggable:!0},Userlist:{name:"Userlist",bodyClass:s.getClass(i.plugbot.userlist),view:"Plugbot/views/Userlist/View",narrowAction:"callsign",title:"Userlist",callsign:"UL",zIndex:21,resizable:!0,draggable:!0,minWidth:120,maxWidth:320,minHeight:0,maxHeight:720}}},c={version:"1.0.6.pre",windows:{MainUi:{status:"normal",oldZIndex:22,x:70,y:85,oldX:70,oldY:85,width:"auto",height:"auto"},Userlist:{status:"minimized",oldZIndex:21,x:730,y:70,oldX:730,oldY:70,width:240,height:400}},mainUi:{autoWoot:!0,autoJoin:!1}};return{initialize:n,readSettings:o,saveSettings:l,clearSettings:a}}),define("Plugbot/main/WindowManager",["Plugbot/events/SiteEvents","Plugbot/main/Settings","Plugbot/models/FloatedWindow/Model","Plugbot/models/Taskbar/Model","Plugbot/models/Taskbar/ItemModel","Plugbot/views/FloatedWindow/View","Plugbot/views/Taskbar/View","Plugbot/views/utils/Ui"],function(t,e,i,s,n,o,l,a){"use strict";function r(){var t=function(t){var e,i=Plugbot.windows,s=t?"removeClass":"addClass";Plugbot.taskbar.$el[s]("plugbot-taskbar-hidden");for(e in i)i.hasOwnProperty(e)&&i[e].$el[s]("plugbot-floated-window-hidden")};Plugbot.hide=function(){return t(!1),this},Plugbot.show=function(){return t(!0),this}}function d(){var t,e;t=new s({windows:Plugbot.settings.windows,windowTop:$(a.plugdj.header).height()}),e=new l({model:t}),$(document.body).append(e.render().el),Plugbot.taskbar=e,k()}function u(){var t,e,s,n,l=Plugbot.settings.windows;Plugbot.windows=Plugbot.windows||{};for(t in l)l.hasOwnProperty(t)&&(e=l[t],s=new i(e),n=new o({model:s}),$(document.body).append(n.render().el),Plugbot.windows[t]=n,P(n))}function c(){p(),w(),m()}function h(){b()}function g(){Plugbot.taskbar.close()}function f(){var t,e=Plugbot.windows;for(t in e)e.hasOwnProperty(t)&&e[t].close()}function m(){var e={},i=t.dispatcher,s=$(a.plugdj.room),n=s.width();_.extend(e,Backbone.Events),e.listenTo(i,i.RESIZE,function(){var t,e,i=s.width(),o=i/n,l=Plugbot.windows;k();for(t in l)l.hasOwnProperty(t)&&(e=l[t],e.model.set("x",e.model.get("x")*o),e.model.set("oldX",e.model.get("oldX")*o));n=i})}function p(){$(window).on("scroll",v)}function b(){$(window).off("scroll",v)}function v(){k()}function w(){var t=$(a.plugdj.playlistPanel),e=!0;Plugbot.watcher.addFn(function(){t.is(":visible")?e&&(Plugbot.hide(),e=!1):e||(Plugbot.show(),e=!0)})}function P(t){var i={},s=t.options.dispatcher;_.extend(i,Backbone.Events),i.listenTo(s,s.CHANGEANY_MODEL,function(){Plugbot.ticker.add("saveWindow",function(){Plugbot.settings.windows[t.model.get("name")]=t.model.attributes,e.saveSettings()})}).listenTo(s,s.AFTER_RENDER,function(){var e=t.model.get("status");"minimized"===e&&E(t,{recordOldPos:!1})}).listenTo(s,s.CONTROLBOX_MINIMIZE,function(){var e=t.model.get("status");"minimized"!==e&&E(t)}).listenTo(s,s.CONTROLBOX_MAXIMIZE,function(){var e=t.model.get("status");"minimized"===e&&A(t)})}function k(){Plugbot.taskbar.$el.css({top:$(a.plugdj.header).height()-$(window).scrollTop(),height:$(a.plugdj.room).height()})}function E(t,e){e=e||{},_.defaults(e,{recordOldPos:!0}),t.model.set("status","minimized"),t.switchResizable(!1),t.switchDraggable(!1),e.recordOldPos&&t.model.set({oldX:t.model.get("x"),oldY:t.model.get("y"),oldZIndex:t.model.get("zIndex")}),t.hide(),Plugbot.taskbar.collection.add(new n({name:t.model.get("name"),title:t.model.get("title"),window:t}))}function A(t){var e=Plugbot.taskbar.collection;t.model.set("status","normal"),t.switchResizable(!0),t.switchDraggable(!0),t.model.set({x:t.model.get("oldX"),y:t.model.get("oldY"),zIndex:t.model.get("oldZIndex")}),t.show(),e.remove(e.findWhere({name:t.model.get("name")}))}return{initPublicMethods:r,initTaskbar:d,initWindows:u,initEvents:c,removeEvents:h,removeTaskbar:g,removeWindows:f}}),define("Plugbot/models/FloatedWindow/Model",[],function(){"use strict";var t=Backbone.Model.extend({defaults:function(){return{name:void 0,bodyClass:"",status:"normal",view:void 0,visible:!0,narrowAction:"hidden",title:"Untitled",callsign:"AAA",zIndex:void 0,oldZIndex:void 0,resizable:!1,draggable:!1,x:0,y:0,oldX:0,oldY:0,width:"auto",height:"auto",minWidth:0,maxWidth:0,minHeight:0,maxHeight:0,minimizeBox:!1,restireBox:!1,closeBox:!1}},NarrowActions:{none:0,hidden:1,callsign:2,expanded:3},Status:{hidden:0,minimized:1,normal:2}});return t}),define("Plugbot/models/MainUi/ItemModel",["Plugbot/main/Settings"],function(t){"use strict";var e=Backbone.Model.extend({defaults:function(){return{id:void 0,text:void 0,enabled:!1}},initialize:function(){_.bindAll(this),this.listenTo(this,"change:enabled",this.setSettings)},setSettings:function(){var e=this.get("enabled");switch(this.get("id")){case"plugbot-btn-woot":Plugbot.settings.mainUi.autoWoot=e;break;case"plugbot-btn-join":Plugbot.settings.mainUi.autoJoin=e}t.saveSettings()}});return e}),define("Plugbot/models/MainUi/Model",[],function(){"use strict";var t=Backbone.Model.extend({defaults:function(){return{data:[{id:"plugbot-btn-woot",text:"auto-woot",enabled:Plugbot.settings.mainUi.autoWoot},{id:"plugbot-btn-join",text:"auto-join",enabled:Plugbot.settings.mainUi.autoJoin},{id:"plugbot-btn-skip-video",text:"skip video",enabled:!1}]}}});return t}),define("Plugbot/models/Taskbar/ItemModel",[],function(){"use strict";var t=Backbone.Model.extend({defaults:function(){return{name:void 0,title:"Unnamed",window:void 0}}});return t}),define("Plugbot/models/Taskbar/Model",[],function(){"use strict";var t=Backbone.Model.extend({defaults:function(){return{windows:void 0,windowTop:0}}});return t}),define("Plugbot/models/Userlist/ItemModel",[],function(){"use strict";var t=Backbone.Model.extend({defaults:function(){return{id:void 0,user:void 0}}});return t}),define("Plugbot/models/Userlist/Model",[],function(){"use strict";var t=Backbone.Model.extend({defaults:function(){return{numUsers:void 0,waitListPos:void 0,users:void 0}},updateAll:function(){this.updateUsers(),this.updateWaitList()},updateUsers:function(){this.set("users",API.getUsers())},updateWaitList:function(){this.set("waitListPos",API.getWaitListPosition()),this.set("waitListNum",API.getWaitList().length)}});return t}),define("Plugbot/store/LocalStorage",["Plugbot/store/LZString"],function(t){"use strict";function e(){var e,i,s={};try{e=localStorage.getItem(n),i=t.decompressFromUTF16(e)||"{}",s=JSON.parse(i)}catch(o){s={}}return s}function i(e){var i=_.compose(t.compressToUTF16,JSON.stringify)(e);localStorage.setItem(n,i)}function s(){localStorage.removeItem(n)}var n="PlugbotEnhanced";return{readSettings:e,saveSettings:i,clearSettings:s}}),define("Plugbot/store/LZString",[],function(){var t={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_f:String.fromCharCode,compressToBase64:function(e){if(null==e)return"";var i,s,n,o,l,a,r,d="",u=0;for(e=t.compress(e);u<2*e.length;)u%2==0?(i=e.charCodeAt(u/2)>>8,s=255&e.charCodeAt(u/2),n=u/2+1<e.length?e.charCodeAt(u/2+1)>>8:0/0):(i=255&e.charCodeAt((u-1)/2),(u+1)/2<e.length?(s=e.charCodeAt((u+1)/2)>>8,n=255&e.charCodeAt((u+1)/2)):s=n=0/0),u+=3,o=i>>2,l=(3&i)<<4|s>>4,a=(15&s)<<2|n>>6,r=63&n,isNaN(s)?a=r=64:isNaN(n)&&(r=64),d=d+t._keyStr.charAt(o)+t._keyStr.charAt(l)+t._keyStr.charAt(a)+t._keyStr.charAt(r);return d},decompressFromBase64:function(e){if(null==e)return"";var i,s,n,o,l,a,r,d,u="",c=0,h=0,g=t._f;for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");h<e.length;)l=t._keyStr.indexOf(e.charAt(h++)),a=t._keyStr.indexOf(e.charAt(h++)),r=t._keyStr.indexOf(e.charAt(h++)),d=t._keyStr.indexOf(e.charAt(h++)),s=l<<2|a>>4,n=(15&a)<<4|r>>2,o=(3&r)<<6|d,c%2==0?(i=s<<8,64!=r&&(u+=g(i|n)),64!=d&&(i=o<<8)):(u+=g(i|s),64!=r&&(i=n<<8),64!=d&&(u+=g(i|o))),c+=3;return t.decompress(u)},compressToUTF16:function(e){if(null==e)return"";var i,s,n,o="",l=0,a=t._f;for(e=t.compress(e),i=0;i<e.length;i++)switch(s=e.charCodeAt(i),l++){case 0:o+=a((s>>1)+32),n=(1&s)<<14;break;case 1:o+=a(n+(s>>2)+32),n=(3&s)<<13;break;case 2:o+=a(n+(s>>3)+32),n=(7&s)<<12;break;case 3:o+=a(n+(s>>4)+32),n=(15&s)<<11;break;case 4:o+=a(n+(s>>5)+32),n=(31&s)<<10;break;case 5:o+=a(n+(s>>6)+32),n=(63&s)<<9;break;case 6:o+=a(n+(s>>7)+32),n=(127&s)<<8;break;case 7:o+=a(n+(s>>8)+32),n=(255&s)<<7;break;case 8:o+=a(n+(s>>9)+32),n=(511&s)<<6;break;case 9:o+=a(n+(s>>10)+32),n=(1023&s)<<5;break;case 10:o+=a(n+(s>>11)+32),n=(2047&s)<<4;break;case 11:o+=a(n+(s>>12)+32),n=(4095&s)<<3;break;case 12:o+=a(n+(s>>13)+32),n=(8191&s)<<2;break;case 13:o+=a(n+(s>>14)+32),n=(16383&s)<<1;break;case 14:o+=a(n+(s>>15)+32,(32767&s)+32),l=0}return o+a(n+32)},decompressFromUTF16:function(e){if(null==e)return"";for(var i,s,n="",o=0,l=0,a=t._f;l<e.length;){switch(s=e.charCodeAt(l)-32,o++){case 0:i=s<<1;break;case 1:n+=a(i|s>>14),i=(16383&s)<<2;break;case 2:n+=a(i|s>>13),i=(8191&s)<<3;break;case 3:n+=a(i|s>>12),i=(4095&s)<<4;break;case 4:n+=a(i|s>>11),i=(2047&s)<<5;break;case 5:n+=a(i|s>>10),i=(1023&s)<<6;break;case 6:n+=a(i|s>>9),i=(511&s)<<7;break;case 7:n+=a(i|s>>8),i=(255&s)<<8;break;case 8:n+=a(i|s>>7),i=(127&s)<<9;break;case 9:n+=a(i|s>>6),i=(63&s)<<10;break;case 10:n+=a(i|s>>5),i=(31&s)<<11;break;case 11:n+=a(i|s>>4),i=(15&s)<<12;break;case 12:n+=a(i|s>>3),i=(7&s)<<13;break;case 13:n+=a(i|s>>2),i=(3&s)<<14;break;case 14:n+=a(i|s>>1),i=(1&s)<<15;break;case 15:n+=a(i|s),o=0}l++}return t.decompress(n)},compress:function(e){if(null==e)return"";var i,s,n,o={},l={},a="",r="",d="",u=2,c=3,h=2,g="",f=0,m=0,p=t._f;for(n=0;n<e.length;n+=1)if(a=e.charAt(n),Object.prototype.hasOwnProperty.call(o,a)||(o[a]=c++,l[a]=!0),r=d+a,Object.prototype.hasOwnProperty.call(o,r))d=r;else{if(Object.prototype.hasOwnProperty.call(l,d)){if(d.charCodeAt(0)<256){for(i=0;h>i;i++)f<<=1,15==m?(m=0,g+=p(f),f=0):m++;for(s=d.charCodeAt(0),i=0;8>i;i++)f=f<<1|1&s,15==m?(m=0,g+=p(f),f=0):m++,s>>=1}else{for(s=1,i=0;h>i;i++)f=f<<1|s,15==m?(m=0,g+=p(f),f=0):m++,s=0;for(s=d.charCodeAt(0),i=0;16>i;i++)f=f<<1|1&s,15==m?(m=0,g+=p(f),f=0):m++,s>>=1}u--,0==u&&(u=Math.pow(2,h),h++),delete l[d]}else for(s=o[d],i=0;h>i;i++)f=f<<1|1&s,15==m?(m=0,g+=p(f),f=0):m++,s>>=1;u--,0==u&&(u=Math.pow(2,h),h++),o[r]=c++,d=String(a)}if(""!==d){if(Object.prototype.hasOwnProperty.call(l,d)){if(d.charCodeAt(0)<256){for(i=0;h>i;i++)f<<=1,15==m?(m=0,g+=p(f),f=0):m++;for(s=d.charCodeAt(0),i=0;8>i;i++)f=f<<1|1&s,15==m?(m=0,g+=p(f),f=0):m++,s>>=1}else{for(s=1,i=0;h>i;i++)f=f<<1|s,15==m?(m=0,g+=p(f),f=0):m++,s=0;for(s=d.charCodeAt(0),i=0;16>i;i++)f=f<<1|1&s,15==m?(m=0,g+=p(f),f=0):m++,s>>=1}u--,0==u&&(u=Math.pow(2,h),h++),delete l[d]}else for(s=o[d],i=0;h>i;i++)f=f<<1|1&s,15==m?(m=0,g+=p(f),f=0):m++,s>>=1;u--,0==u&&(u=Math.pow(2,h),h++)}for(s=2,i=0;h>i;i++)f=f<<1|1&s,15==m?(m=0,g+=p(f),f=0):m++,s>>=1;for(;;){if(f<<=1,15==m){g+=p(f);break}m++}return g},decompress:function(e){if(null==e)return"";if(""==e)return null;var i,s,n,o,l,a,r,d,u=[],c=4,h=4,g=3,f="",m="",p=t._f,b={string:e,val:e.charCodeAt(0),position:32768,index:1};for(s=0;3>s;s+=1)u[s]=s;for(o=0,a=Math.pow(2,2),r=1;r!=a;)l=b.val&b.position,b.position>>=1,0==b.position&&(b.position=32768,b.val=b.string.charCodeAt(b.index++)),o|=(l>0?1:0)*r,r<<=1;switch(i=o){case 0:for(o=0,a=Math.pow(2,8),r=1;r!=a;)l=b.val&b.position,b.position>>=1,0==b.position&&(b.position=32768,b.val=b.string.charCodeAt(b.index++)),o|=(l>0?1:0)*r,r<<=1;d=p(o);break;case 1:for(o=0,a=Math.pow(2,16),r=1;r!=a;)l=b.val&b.position,b.position>>=1,0==b.position&&(b.position=32768,b.val=b.string.charCodeAt(b.index++)),o|=(l>0?1:0)*r,r<<=1;d=p(o);break;case 2:return""}for(u[3]=d,n=m=d;;){if(b.index>b.string.length)return"";for(o=0,a=Math.pow(2,g),r=1;r!=a;)l=b.val&b.position,b.position>>=1,0==b.position&&(b.position=32768,b.val=b.string.charCodeAt(b.index++)),o|=(l>0?1:0)*r,r<<=1;switch(d=o){case 0:for(o=0,a=Math.pow(2,8),r=1;r!=a;)l=b.val&b.position,b.position>>=1,0==b.position&&(b.position=32768,b.val=b.string.charCodeAt(b.index++)),o|=(l>0?1:0)*r,r<<=1;u[h++]=p(o),d=h-1,c--;break;case 1:for(o=0,a=Math.pow(2,16),r=1;r!=a;)l=b.val&b.position,b.position>>=1,0==b.position&&(b.position=32768,b.val=b.string.charCodeAt(b.index++)),o|=(l>0?1:0)*r,r<<=1;u[h++]=p(o),d=h-1,c--;break;case 2:return m}if(0==c&&(c=Math.pow(2,g),g++),u[d])f=u[d];else{if(d!==h)return null;f=n+n.charAt(0)}m+=f,u[h++]=n+f.charAt(0),c--,n=f,0==c&&(c=Math.pow(2,g),g++)}}};return t}),define("Plugbot/tmpls/FloatedWindow/View",["Plugbot/base/Template"],function(t){"use strict";var e=t.extend({elements:{elHeader:".header",elTitle:".title",elControlBox:".control-box",elMinimize:".minimize",elMaximize:".maximize",elClose:".close",elBody:".body"},template:'<div class="plugbot-floated-window">    <div class="{{getName elHeader}}">        <h1 class="{{getName elTitle}}">{{textTitle}}</h1>        <div class="{{getName elControlBox}}">            <button class="{{getName elMinimize}}" title="Minimize"></button>            <button class="{{getName elMaximize}}" title="Restore"></button>            <button class="{{getName elClose}}" title="Close"></button>        </div>    </div>    <div class="{{getName elBody}}"></div></div>'});return e}),define("Plugbot/tmpls/MainUi/ItemView",["Plugbot/base/Template"],function(t){"use strict";var e=t.extend({elements:{},template:'<p id="{{id}}" class="{{class}}">{{text}}</p>'});return e}),define("Plugbot/tmpls/Taskbar/ItemView",["Plugbot/base/Template"],function(t){"use strict";var e=t.extend({elements:{},template:'<li class="task">{{title}}</li>'});return e}),define("Plugbot/tmpls/Taskbar/View",["Plugbot/base/Template"],function(t){"use strict";var e=t.extend({elements:{elContent:".content",elHandle:".handle",elContainer:".container"},template:'<div class="plugbot-taskbar">    <div class="{{getName elContent}}">        <ul class="{{getName elContainer}}"></ul>    </div>    <div class="{{getName elHandle}}"></div></div>'});return e}),define("Plugbot/tmpls/Userlist/HeadView",["Plugbot/base/Template"],function(t){"use strict";var e=t.extend({elements:{},template:'<h1 class="userlist-wait-list-pos">{{textWaitListPos}}</h1>'});return e}),define("Plugbot/tmpls/Userlist/UsersItemView",["Plugbot/base/Template"],function(t){"use strict";var e=t.extend({elements:{},template:'<li class="userlist-item {{classVote}}" data-id="{{id}}">{{text}}</li>'});return e}),define("Plugbot/tmpls/Userlist/View",["Plugbot/base/Template"],function(t){"use strict";var e=t.extend({elements:{elHead:".head",elWrapList:".wrap-list",elList:".list"},template:'<div class="row-head">    <div class="{{getName elHead}}"></div></div><div class="row-list">    <div class="{{getName elWrapList}}">        <ul class="{{getName elList}}"></ul>    </div></div>'});return e}),define("Plugbot/utils/API",[],function(){"use strict";var t={VOTE:{WOOT:1,UNDECIDED:0,MEH:-1}};return{USER:t}}),define("Plugbot/utils/APIBuffer",["Plugbot/utils/Ticker"],function(t){"use strict";var e=Backbone.Model.extend({defaults:function(){return{ticker:new t}},initialize:function(){_.bindAll(this),_.defaults(this,this.defaults())},addListening:function(t,e,i,s){var n,o=this,l=function(i,s){e.listenTo(API,i,function(){o.ticker.add(t,function(){void 0!==s.fnCheck?s.fnCheck()&&s.callback():s.callback()},{interval:Plugbot.settings.tickerInterval.APICallback})})};for(s=s||{},_.defaults(s,{fnCheck:void 0,callback:void 0}),n=0;n!==i.length;n+=1)l(i[n],s)},stopListening:function(t,e){var i,s=function(e){t.stopListening(API,e)};if(void 0===e)t.stopListening(API);else for(i=0;i!==e.length;i+=1)s(e[i])},close:function(){this.ticker.close()}});return new e}),define("Plugbot/utils/Countdown",["Plugbot/base/Timer","Plugbot/utils/Helpers"],function(t,e){"use strict";var i=t.extend({defaults:function(){return{defaultOptions:{call:void 0,countdown:0},defaultRuntime:{suspended:!1,elapsed:0,waitCallbacks:[]}}},initialize:function(){_.bindAll(this),this.parent=t.prototype,this.parent.initialize.call(this),_.defaults(this,this.parent.defaults()),e.defaultsDeep(this.defaults(),this)},fnTick:function(){var t,e,i,s,n,o,l;if(!this.suspendedAll){i=!0,e=this.items;for(s in e)if(e.hasOwnProperty(s)&&(i=!1,n=e[s],l=n.runtime,!l.suspended))if(o=n.options,l.elapsed+=this.interval,l.elapsed>=o.countdown){if(void 0!==o.call)for(o.call.apply(this),t=0;t<l.waitCallbacks.length;t+=1)l.waitCallbacks[t]();this.remove(s)}else this.items[s].runtime=l;i&&this.exitWhenNoCall&&this.close()}},add:function(t,e){var i,s;return void 0!==this.items[t]?this:(i=this.defaultOptions,s=this.defaultRuntime,e=e||{},_.defaults(e,{call:i.call,countdown:i.countdown}),this.items[t]={options:e,runtime:{suspended:s.suspended,elapsed:s.elapsed,waitCallbacks:s.waitCallbacks}},this.enabled||this.autoStart&&this.start(),this)},remove:function(t){return void 0===this.items[t]?this:(delete this.items[t],this)},wait:function(t,e){return this.items[t].runtime.waitCallbacks.push(e),this},suspend:function(t){return this.items[t].runtime.suspended=!0,this},resume:function(t){return this.items[t].runtime.suspended=!1,this},setCountdown:function(t,e){return this.items[t].options.countdown=e,this},callAndRemove:function(t){return this.items[t].options.call(),delete this.items[t],this},setElapsed:function(t,e){return this.items[t].runtime.elapsed=e,this},resetElapsed:function(t){return this.items[t].runtime.elapsed=0,this},delay:function(t,e){return this.items[t].runtime.elapsed-=e,this},forward:function(t,e){return this.items[t].runtime.elapsed+=e,this}});return i}),define("Plugbot/utils/Helpers",["handlebars"],function(t){"use strict";function e(){t.registerHelper("getName",function(t){return t.substr(1)})}function i(){delete t.helpers.getName}function s(t,e){var i;for(i in t)t.hasOwnProperty(i)&&(e.hasOwnProperty(i)?s(t[i],e[i]):e[i]=t[i])}function n(t,e){var i,s,o;for(i in t)t.hasOwnProperty(i)&&(s=t[i],e.hasOwnProperty(i)?(o=e[i],"object"!=typeof s||"object"!=typeof o?e[i]=s:n(s,o)):e[i]=s)}function o(t,e){var i,s,n;for(i in t)t.hasOwnProperty(i)&&(s=t[i],e.hasOwnProperty(i)&&(n=e[i],"object"!=typeof s||"object"!=typeof n?e[i]=s:o(s,n)))}return{initHandlebarsHelpers:e,removeHandlebarsHelpers:i,defaultsDeep:s,extendDeep:n,applyDeep:o}}),define("Plugbot/utils/Ticker",[],function(){"use strict";var t=Backbone.Model.extend({defaults:function(){return{interval:"optimal",defaultHz:1,ids:{}}},initialize:function(){_.bindAll(this),_.defaults(this,this.attributes),_.defaults(this,this.defaults())},add:function(t,e,i){var s,n,o,l=this;return void 0!==this.ids[t]?this:(i=i||{},_.defaults(i,{interval:this.interval}),s=i.interval,"optimal"===s?s=Math.round(1e3/this.optimalHz):"hz"===this.interval.substr(-2)&&(s=Math.round(1e3/+s.substr(0,s.length-2))),n=(new Date).getTime(),o=s-n%s,this.ids[t]=setTimeout(function(){e.call(l),delete l.ids[t]},o),this)},remove:function(t){return clearInterval(this.ids[t]),delete this.ids[t],this},has:function(t){return void 0!==this.ids[t]},clear:function(){var t,e=this.ids;for(t in e)e.hasOwnProperty(t)&&this.remove(t);return this},close:function(){this.clear()}});return t}),define("Plugbot/utils/Watcher",["Plugbot/base/Timer","Plugbot/utils/Helpers"],function(t,e){"use strict";var i=t.extend({defaults:function(){return{defaultOptions:{call:void 0,args:void 0,exitValue:0,exitCall:void 0,maxNumCall:0},defaultRuntime:{suspended:!1,numCall:0}}},initialize:function(){_.bindAll(this),this.parent=t.prototype,this.parent.initialize.call(this),_.defaults(this,this.parent.defaults()),e.defaultsDeep(this.defaults(),this)
},fnTick:function(){var t,e,i,s,n,o,l,a;if(!this.suspendedAll){e=!0,t=this.items;for(i in t)t.hasOwnProperty(i)&&(e=!1,s=t[i],o=s.runtime,o.suspended||(n=s.options,a=0!==n.maxNumCall,l=n.call.apply(this,n.args),a&&(o.numCall+=1),l===n.exitValue||a&&o.numCall>n.maxNumCall?(n.exitCall&&n.exitCall(),this.remove(i)):this.items[i].runtime=o));e&&this.exitWhenNoCall&&this.close()}},addFn:function(t){return this.add(Date.now(),{call:t}),this},add:function(t,e){var i,s;return void 0!==this.items[t]?this:(i=this.defaultOptions,s=this.defaultRuntime,e=e||{},_.defaults(e,{call:i.call,exitValue:i.exitValue,exitCall:i.exitCall,maxNumCall:i.maxNumCall}),this.items[t]={options:e,runtime:{suspended:s.suspended,numCall:s.numCall}},this.enabled||this.autoStart&&this.start(),this)},remove:function(t){return void 0===this.items[t]?this:(delete this.items[t],this)},suspend:function(t){return this.items[t].runtime.suspended=!0,this},resume:function(t){return this.items[t].runtime.suspended=!1,this}});return i}),define("Plugbot/views/FloatedWindow/View",["Plugbot/events/FloatedWindow/Events","Plugbot/models/FloatedWindow/Model","Plugbot/tmpls/FloatedWindow/View","Plugbot/utils/Watcher","Plugbot/views/utils/Ui","Plugbot/views/utils/UiHelpers"],function(t,e,i,s,n,o){"use strict";var l=Backbone.View.extend({defaults:function(){return{dispatcher:_.clone(t),template:void 0,hasRenderedWindow:!1,hasRenderedBody:!1,bodyView:void 0,tableLayout:void 0,nowNarrowAction:this.NarrowActions.expanded}},events:{mouseenter:"onMouseEnter",mouseleave:"onMouseLeave"},TEMPLATE:i,initialize:function(){_.bindAll(this),_.defaults(this.options,this.defaults()),this.options.template=new this.TEMPLATE({view:this}),this.listenTo(this.model,"change",this.onChangeAll),this.listenTo(this.model,"change:visible",this.onChangeVisible),this.listenTo(this.model,"change:zIndex",this.onChangeZIndex),this.listenTo(this.model,"change:x change:y",this.onChangePos),this.listenTo(this.model,"change:width change:height",this.onChangeSize),this.listenTo(this.model,"change:resizable",this.onChangeResizable),this.listenTo(this.model,"change:draggable",this.onChangeDraggable),this.hide()},NarrowActions:e.prototype.NarrowActions,Status:e.prototype.Status,minWidth:160,minHeight:40,buttonClasses:["ui-icon-minus","ui-icon-extlink","ui-icon-close"],buttonNames:["minimize","maximize","close"],FIXED_ACCURACY:2,render:function(){var t,e,i=this;for(this.options.template.setSelf({textTitle:this.model.get("title")}).cacheElements(),this.$el.addClass("scheme-default-plugbot-floated-window"),e=[this.$elMinimize,this.$elMaximize,this.$elClose],t=0;t!==e.length;t+=1)e[t].button({icons:{primary:this.buttonClasses[t]},text:!1}),e[t].data("name",this.buttonNames[t]),e[t].on("click",this.onClickControlBoxButton);return this.$elBody.addClass(this.model.get("bodyClass")),this.$el.css({position:"absolute",left:this.model.get("x"),top:this.model.get("y"),width:this.model.get("width"),height:this.model.get("height"),"min-width":this.minWidth,"min-height":this.minHeight,"z-index":this.model.get("zIndex")}),this.bindUiEvents(),Plugbot.watcher.addFn(function(){var t;return i.$el.is(":visible")&&(i.afterRender(),i.options.hasRenderedWindow=!0,t=0),t}),require([this.model.get("view")],function(t){i.options.bodyView=new t({el:i.$elBody,modWindow:i.model,dispatcherWindow:i.options.dispatcher}),i.options.bodyView.render(),i.show(),i.options.hasRenderedBody=!0}),this},afterRender:function(){this.updateTitle(),this.resizeBody(),this.resizeTableLayout(),this.options.dispatcher.dispatch("AFTER_RENDER")},show:function(){this.model.set("visible",!0),this.resizeBody(),this.options.dispatcher.dispatch("SHOW")},hide:function(){this.model.set("visible",!1),this.options.dispatcher.dispatch("HIDE")},getBodyView:function(){return this.options.bodyView},getRemainingHeaderSpace:function(t){return this.$elHeader.width()-this.$elTitle.outerWidth(!0)-this.$elControlBox.outerWidth(!0)-t},resizeBody:function(){this.model.get("visible")&&o.fitElement(this.$elBody,this.$el,"both",0,-this.$elHeader.outerHeight(!0))},resizeTableLayout:function(){var t=this.model.get("tableLayout");void 0!==t&&t.resize()},updateTitle:function(){var t,e=this.NarrowActions,i=e[this.model.get("narrowAction")],s=this.model.get("title"),n=this.model.get("callsign"),o=8;switch(this.options.nowNarrowAction){case e.expanded:if(t=this.getRemainingHeaderSpace(o),0>t)switch(i){case e.none:this.$el.css("min-width",this.$el.width()-t),this.options.nowNarrowAction=e.none;break;case e.hidden:this.$elTitle.hide(),this.options.nowNarrowAction=e.hidden;break;case e.callsign:this.$elTitle.text("<"+n+">"),this.options.nowNarrowAction=e.callsign}break;case e.none:break;case e.hidden:this.$elTitle.text(s).show(),t=this.getRemainingHeaderSpace(o),t>=0?this.options.nowNarrowAction=e.expanded:this.$elTitle.hide();break;case e.callsign:this.$elTitle.text(s),t=this.getRemainingHeaderSpace(o),t>=0?this.options.nowNarrowAction=e.expanded:this.$elTitle.text("<"+n+">")}},switchResizable:function(t){this.model.get("resizable")&&(t?this.$el.resizable("enable"):this.$el.resizable("disable"))},switchDraggable:function(t){this.model.get("draggable")&&(t?this.$el.draggable("enable"):(this.$el.draggable("disable"),this.$el.css("opacity",1)))},bindUiEvents:function(){var t,e,i=this;this.model.get("resizable")&&this.$el.resizable({containment:"document",handles:"n, e, s, w, se",distance:0,grid:8,minWidth:Math.max(this.minWidth,this.model.get("minWidth")),minHeight:Math.max(this.minHeight,this.model.get("minHeight")),maxWidth:this.model.get("maxWidth"),maxHeight:this.model.get("maxHeight"),start:function(l,a){t=o.iframeFix($(n.plugdj.playback)),void 0!==i.model.get("tableLayout")&&(e=new s,e.addFn(i.resizeTableLayout)),i.options.dispatcher.dispatch("RESIZE_START",[l,a])},resize:function(t,e){i.updateTitle(),i.resizeBody(),i.options.dispatcher.dispatch("RESIZE_NOW",[t,e])},stop:function(s,n){o.removeIframeFix(t),void 0!==e&&e.close(),i.model.set({width:i._getFixed(n.size.width),height:i._getFixed(n.size.height)}),i.options.dispatcher.dispatch("RESIZE_STOP",[s,n])}}),this.model.get("draggable")&&this.$el.draggable({containment:"document",zIndex:10001,handle:".header",scroll:!0,scrollSensitivity:8,snap:"div",snapMode:"both",snapTolerance:8,cursor:"move",start:function(e,s){var l=$(this);l.css({width:l.width(),height:l.height()}).data({diffOfs:{X:s.position.left-s.offset.left,Y:s.position.top-s.offset.top}}),t=o.iframeFix($(n.plugdj.playback)),i.options.dispatcher.dispatch("DRAG_START",[e,s])},drag:function(t,e){var s=$(this).data("diffOfs");e.position.left-=s.X,e.position.top-=s.Y,i.options.dispatcher.dispatch("DRAG_NOW",[t,e])},stop:function(e,s){o.removeIframeFix(t),i.model.set({x:i._getFixed(s.position.left),y:i._getFixed(s.position.top)}),i.options.dispatcher.dispatch("DRAG_STOP",[e,s])}})},onMouseEnter:function(){this.options.dispatcher.dispatch("MOUSE_ENTER")},onMouseLeave:function(){this.options.dispatcher.dispatch("MOUSE_LEAVE")},onChangeVisible:function(){this.model.get("visible")?this.$el.show():this.$el.hide()},onChangeZIndex:function(){this.$el.css("z-index",this.model.get("zIndex"))},onChangePos:function(){this.$el.css({left:this.model.get("x"),top:this.model.get("y")})},onChangeSize:function(){this.$el.css({width:this.model.get("width"),height:this.model.get("height")})},onClickControlBoxButton:function(t){var e=this,i={cancel:!1,enabledCallback:!1,callback:function(){i.cancel||e.close()}};switch($(t.currentTarget).data("name")){case"minimize":this.options.dispatcher.dispatch("CONTROLBOX_MINIMIZE",i);break;case"maximize":this.options.dispatcher.dispatch("CONTROLBOX_MAXIMIZE",i);break;case"close":this.options.dispatcher.dispatch("CONTROLBOX_CLOSE",i),!i.enabledCallback}},onChangeAll:function(){this.options.dispatcher.dispatch("CHANGEANY_MODEL")},_getFixed:function(t){return+t.toFixed(this.FIXED_ACCURACY)},close:function(){this.remove(),this.options.bodyView.close()}});return l}),define("Plugbot/views/layout/TableLayout",["Plugbot/views/utils/UiHelpers"],function(t){"use strict";var e=Backbone.View.extend({defaults:function(){return{display:void 0,classes:[],values:[],styles:[],grows:[],cached:!1,elCached:[]}},initialize:function(){_.bindAll(this),_.defaults(this.options,this.defaults())},elTableLayout:".plugbot-table-layout",render:function(){this.$el.addClass(t.getClass(this.elTableLayout)),this.$el.children("div").addClass(this.options.display),this.resize()},resize:function(){var t,e,i,s,n,o,l,a,r,d="row"===this.options.display?"width":"height",u="row"===this.options.display?"outerWidth":"outerHeight";for(this.cached||this.cacheElements(),a=this.$el[d](),r=[],l=0,t=0;t!==this.options.classes.length;t+=1)switch(i=this.options.elCached[t],s=this.options.values[t],n=this.options.styles[t],o=this.options.grows[t],n){case"auto":i.css(d,"auto"),a-=i[u](!0);break;case"px":i.css(d,s+"px"),a-=i[u](!0);break;case"%":i.css(d,s+"%"),a-=i[u](!0);break;case"?":i.css(d,"auto"),l+=o,r.push(t)}if(0!==l)for(a/=l,t=0;t!==r.length;t+=1)e=r[t],i=this.options.elCached[e],o=this.options.grows[e],i.css(d,a*o-(i[u](!0)-i[d]())+"px")},cacheElements:function(){var t;for(t=0;t!==this.options.classes.length;t+=1)this.options.elCached[t]=this.$("."+this.options.classes[t]);this.cached=!0},close:function(){}});return e}),define("Plugbot/views/MainUi/ItemView",["Plugbot/tmpls/MainUi/ItemView"],function(t){"use strict";var e=Backbone.View.extend({defaults:function(){return{template:void 0}},TEMPLATE:t,initialize:function(){_.bindAll(this),_.defaults(this,this.defaults()),this.options.template=new this.TEMPLATE({view:this}),this.listenTo(this.model,"change:enabled",this.render2)},events:{click:"onClick"},render:function(){return this.options.template.setSelf({id:this.model.get("id"),"class":this.getClass(this.model.get("enabled")),text:this.model.get("text")}),this},render2:function(){return this.$el.prop("class",this.getClass(this.model.get("enabled"))),this},onClick:function(){this.model.set("enabled",!this.model.get("enabled"))},getClass:function(t){return t?"item-enabled":"item-disabled"},close:function(){this.remove()}});return e}),define("Plugbot/views/MainUi/View",["handlebars","Plugbot/colls/MainUi/ItemCollection","Plugbot/models/MainUi/ItemModel","Plugbot/models/MainUi/Model","Plugbot/utils/API","Plugbot/utils/APIBuffer","Plugbot/utils/Watcher","Plugbot/views/MainUi/ItemView","Plugbot/views/utils/Ui"],function(t,e,i,s,n,o,l,a,r){"use strict";var d=Backbone.View.extend({defaults:function(){return{dispatcherWindow:void 0,watcherAutoJoin:new l({interval:"1 hz"}),watcherSkipVideo:new l({interval:"1 hz"}),views:{},elemDialogAsk:void 0,lastPlaybackVolume:void 0}},model:new s,initialize:function(){_.bindAll(this),_.defaults(this.options,this.defaults()),this.collection=new e,this.listenTo(this.collection,"add",this.addOne),this.listenToWindow(),this.listenToAPI(),this.onClickAutoWoot(Plugbot.settings.mainUi.autoWoot).onClickAutoJoin(Plugbot.settings.mainUi.autoJoin).onClickSkipVideo(!1)},el:r.plugbot.mainUi,templateDialogAsk:t.compile('    <div title="Exit">    <p>Exit Plugbot Enhanced?    </p></div>'),events:{"click p":"onClick"},render:function(){var t,e,s=this.model.get("data");for(this.options.elemDialogAsk=$(this.templateDialogAsk()),t=0;t!==s.length;t+=1)e=new i(s[t]),this.collection.add(e);return this},addOne:function(t){var e=new a({model:t});this.options.views[t.id]=e,this.$el.append(e.render().el)},listenToAPI:function(){var t=this,e=this.model.cid;o.addListening("auto-woot-"+e,this,[API.DJ_ADVANCE],{fnCheck:function(){return Plugbot.settings.mainUi.autoWoot},callback:function(){$(r.plugdj.woot).click()}}),o.addListening("auto-join-"+e,this,[API.WAIT_LIST_UPDATE],{fnCheck:function(){return Plugbot.settings.mainUi.autoJoin},callback:this.enableAutoJoin}),o.addListening("skip-video-"+e,this,[API.DJ_ADVANCE],{fnCheck:function(){return t.options.watcherSkipVideo.remove("skip-video"),t.collection.get("plugbot-btn-skip-video").get("enabled")},callback:function(){var e,i=t.options.lastPlaybackVolume;e=100===e?99:i+1,t.disableSkipVideo(),t.options.watcherSkipVideo.add("skip-video",{call:function(){var t,s=API.getVolume();return s===i?(API.setVolume(e),API.setVolume(i)):t=0,t}})}})},listenToWindow:function(){var t=this.options.dispatcherWindow;this.listenTo(t,t.CONTROLBOX_CLOSE,function(t){t.enabledCallback=!0,this.options.elemDialogAsk.dialog({modal:!0,draggable:!1,resizable:!1,buttons:{OK:function(){t.callback(),Plugbot.close(),$(this).dialog("close")},Cancel:function(){t.cancel=!0,t.callback(),$(this).dialog("close")}}})})},onClick:function(t){var e=t.target.id,i=this.collection.get(e),s=i.get("enabled");switch(e){case"plugbot-btn-woot":this.onClickAutoWoot(s);break;case"plugbot-btn-join":this.onClickAutoJoin(s);break;case"plugbot-btn-skip-video":this.onClickSkipVideo(s)}},onClickAutoWoot:function(t){return t&&n.USER.VOTE.UNDECIDED===API.getUser().vote&&$(r.plugdj.woot).click(),this},onClickAutoJoin:function(t){return t?this.enableAutoJoin():this.disableAutoJoin(),this},onClickSkipVideo:function(t){return t?this.enableSkipVideo():this.disableSkipVideo(),this},enableAutoJoin:function(){var t=API.djJoin();0!==t&&this.options.watcherAutoJoin.add("auto-join",{call:function(){return API.djJoin()}})},disableAutoJoin:function(){this.options.watcherAutoJoin.remove("auto-join")},enableSkipVideo:function(){this.options.watcherSkipVideo.remove("skip-video"),this.options.lastPlaybackVolume=API.getVolume(),API.setVolume(0)},disableSkipVideo:function(){var t;void 0!==this.options.lastPlaybackVolume&&(t=this.collection.get("plugbot-btn-skip-video"),t.set("enabled",!1),0===API.getVolume()&&(API.setVolume(this.options.lastPlaybackVolume),this.options.lastPlaybackVolume=void 0))},close:function(){var t,e=this.options.views;this.remove(),this.collection.close();for(t in e)e.hasOwnProperty(t)&&e[t].close();this.options.watcherAutoJoin.close(),this.options.watcherSkipVideo.close()}});return d}),define("Plugbot/views/Taskbar/ItemView",["Plugbot/events/Taskbar/ItemEvents","Plugbot/tmpls/Taskbar/ItemView"],function(t,e){"use strict";var i=Backbone.View.extend({defaults:function(){return{dispatcher:_.clone(t),template:void 0}},events:{mouseenter:"onMouseEnter",mouseleave:"onMouseLeave"},TEMPLATE:e,initialize:function(){_.bindAll(this),_.defaults(this.options,this.defaults()),this.options.template=new this.TEMPLATE({view:this})},render:function(){return this.options.template.setSelf({title:this.model.get("title")}),this},onMouseEnter:function(){this.options.dispatcher.dispatch("MOUSE_ENTER",{model:this.model})},onMouseLeave:function(){this.options.dispatcher.dispatch("MOUSE_LEAVE",{model:this.model})},close:function(){this.remove()}});return i}),define("Plugbot/views/Taskbar/View",["Plugbot/colls/Taskbar/ItemCollection","Plugbot/tmpls/Taskbar/View","Plugbot/utils/Countdown","Plugbot/views/Taskbar/ItemView","Plugbot/views/utils/UiHelpers"],function(t,e,i,s,n){"use strict";var o=Backbone.View.extend({defaults:function(){return{template:void 0,views:{},countdownSlide:new i,countdownTask:new i,currentWindow:void 0}},events:{mouseenter:"onMouseEnter",mouseleave:"onMouseLeave"},TEMPLATE:e,initialize:function(){_.bindAll(this),_.defaults(this.options,this.defaults()),this.options.template=new this.TEMPLATE({view:this}),this.collection=new t,this.listenTo(this.collection,"add",this.addOne),this.listenTo(this.collection,"remove",this.removeOne),this.bindUiEvents()},render:function(){return this.options.template.setSelf().cacheElements(),this.$el.trigger("mouseleave"),this},addOne:function(t){var e,i=new s({model:t});this.options.views[t.cid]=i,e=this.collection.indexOf(t),n.insertAt(i.render().el,this.$elContainer,e),this.listenToItem(i),this.listenToWindow(t.get("window"))},removeOne:function(t){var e=t.cid,i=this.options.views;this.stopListeningItem(this.options.views[t.cid]),this.stopListeningWindow(t.get("window")),this.options.countdownSlide.resumeAll(),this.options.countdownTask.resumeAll(),this.options.currentWindow=void 0,i[e].close(),delete i[e]},listenToItem:function(t){var e=this,i=t.options.dispatcher,s=t.model.cid,n="mouse-enter",o="mouse-leave";this.listenTo(i,i.MOUSE_ENTER,function(t){e.options.countdownTask.remove(n+":"+s).add(n+":"+s,{call:function(){var i=t.model.get("window");e.options.currentWindow=i,e.showWindow(i)},countdown:300})}),this.listenTo(i,i.MOUSE_LEAVE,function(t){e.options.countdownTask.remove(o+":"+s).add(o+":"+s,{call:function(){var i=t.model.get("window");e.options.currentWindow=void 0,e.hideWindow(i)},countdown:300})})},listenToWindow:function(t){var e=t.options.dispatcher,i=this.options.countdownSlide,s=this.options.countdownTask;this.listenTo(e,e.MOUSE_ENTER,function(){i.suspendAll(),s.suspendAll()}),this.listenTo(e,e.MOUSE_LEAVE,function(){i.resumeAll(),s.resumeAll()})},stopListeningItem:function(t){var e=t.options.dispatcher,i=t.model.cid;this.stopListening(e),this.options.countdownTask.remove("mouse-enter:"+i).remove("mouse-leave:"+i)},stopListeningWindow:function(t){var e=t.options.dispatcher;this.stopListening(e)},showWindow:function(t){t.model.set({x:this.$el.width()+$(window).scrollLeft(),y:this.model.get("windowTop"),zIndex:1e4}),t.show()},hideWindow:function(t){t.hide()},expand:function(){this.$el.animate({left:0},200)},collapse:function(){this.$el.animate({left:-this.$elContent.width()},200)},bindUiEvents:function(){$(window).on("scroll",this.onWindowScroll)},unbindUiEvents:function(){$(window).off("scroll",this.onWindowScroll)},onWindowScroll:function(){var t=this.options.currentWindow;void 0!==t&&this.showWindow(this.options.currentWindow)},onMouseEnter:function(){var t=this,e=this.options.countdownSlide;e.remove("mouse-leave").add("mouse-enter",{call:function(){t.expand()},countdown:100})},onMouseLeave:function(){var t=this,e=this.options.countdownSlide;e.remove("mouse-enter").add("mouse-leave",{call:function(){t.collapse()},countdown:500})},close:function(){var t,e=this.options.views;this.unbindUiEvents(),this.remove(),this.collection.close();for(t in e)e.hasOwnProperty(t)&&e[t].close()}});return o}),define("Plugbot/views/Userlist/HeadView",["Plugbot/tmpls/Userlist/HeadView"],function(t){"use strict";var e=Backbone.View.extend({defaults:function(){return{template:void 0}},TEMPLATE:t,initialize:function(){_.bindAll(this),_.defaults(this,this.defaults()),this.options.template=new this.TEMPLATE({view:this})},render:function(){var t=this.model.get("waitListPos");return this.options.template.setHtml({textWaitListPos:"Waitlist: "+(-1===t?"-":t+1)+" / "+this.model.get("waitListNum")}),this},close:function(){this.remove()}});return e}),define("Plugbot/views/Userlist/UsersItemView",["Plugbot/tmpls/Userlist/UsersItemView","Plugbot/utils/API"],function(t,e){"use strict";var i=Backbone.View.extend({defaults:function(){return{template:void 0}},TEMPLATE:t,initialize:function(){_.bindAll(this),_.defaults(this,this.defaults()),this.options.template=new this.TEMPLATE({view:this})},render:function(){var t=this.model.get("user");return this.options.template.setSelf({id:this.model.get("id"),classVote:this.getClass(+t.vote),text:t.username}),this},getClass:function(t){var i,s=e.USER.VOTE;switch(t){case s.WOOT:i="item-woot";break;case s.UNDECIDED:i="item-undecided";break;case s.MEH:i="item-meh"}return i},close:function(){this.remove()}});return i}),define("Plugbot/views/Userlist/UsersView",["Plugbot/colls/Userlist/ItemCollection","Plugbot/views/Userlist/UsersItemView","Plugbot/views/utils/Ui"],function(t,e,i){"use strict";var s=Backbone.View.extend({defaults:function(){return{views:{}}},initialize:function(){_.bindAll(this),_.defaults(this.options,this.defaults()),this.collection=new t,this.render()},events:{"click .userlist-item":"onClick"},render:function(){var t,i,s,n,o,l=this.model.get("users");for(this.removeViews(),this.collection.reset(),t=0;t<l.length;t+=1)i=l[t],this.collection.add({id:i.id,user:i});for(s=this.collection.models,t=0;t!==s.length;t+=1)n=s[t],o=new e({model:n}),this.$el.append(o.render().$el),this.options.views[n.get("id")]=o},onClick:function(t){var e=$(t.currentTarget).data("id"),s=this.collection.get(e),n=s.get("user");$(i.plugdj.chatInputField).val("@"+n.username+" ").focus()},removeViews:function(){var t,e=this.options.views;for(t in e)e.hasOwnProperty(t)&&e[t].close()},close:function(){var t;this.remove(),this.collection.reset();for(t in this.views)this.views.hasOwnProperty(t)&&this.views[t].close()}});return s}),define("Plugbot/views/Userlist/View",["Plugbot/models/Userlist/Model","Plugbot/tmpls/Userlist/View","Plugbot/utils/APIBuffer","Plugbot/utils/Ticker","Plugbot/views/layout/TableLayout","Plugbot/views/Userlist/HeadView","Plugbot/views/Userlist/UsersView"],function(t,e,i,s,n,o,l){"use strict";var a=Backbone.View.extend({defaults:function(){return{modWindow:void 0,dispatcherWindow:void 0,renderOverElapsed:5,ticker:new s({interval:"12 hz"}),template:void 0,pendingRenderHead:!1,pendingRenderList:!1,tableLayout:void 0,viewHead:void 0,viewList:void 0}},model:new t,TEMPLATE:e,initialize:function(){_.bindAll(this),_.defaults(this.options,this.defaults()),this.options.template=new this.TEMPLATE({view:this}),this.listenToAPI()},render:function(){return this.model.updateAll(),this.options.template.setHtml().cacheElements(),this.$el.addClass("scheme-default-plugbot-userlist"),this.options.tableLayout=new n({el:this.$el,display:"column",classes:["row-head","row-list"],values:[0,0],styles:["auto","?"],grows:[0,1]}),this.options.modWindow.set("tableLayout",this.options.tableLayout),this.options.viewHead=new o({model:this.model,el:this.$elHead}),this.options.viewList=new l({model:this.model,el:this.$elList}),this.options.tableLayout.render(),this.options.viewHead.render(),this.options.viewList.render(),this.options.tableLayout.resize(),this.listenToWindow(),this},renderHead:function(){return this.model.updateWaitList(),this.options.viewHead.render(),this.options.pendingRenderHead=!1,this},renderList:function(){return this.model.updateUsers(),this.options.viewList.render(),this.options.pendingRenderList=!1,this},listenToAPI:function(){var t=this,e=this.model.cid,s=function(e){var i;if(t.options.modWindow.get("visible"))i=API.getTimeElapsed()>=t.options.renderOverElapsed?!0:!1;else{switch(e){case"head":t.options.pendingRenderHead=!0;break;case"list":t.options.pendingRenderList=!0}i=!1}return i};i.addListening("head-"+e,this,[API.WAIT_LIST_UPDATE,API.DJ_UPDATE],{fnCheck:function(){return s("head")},callback:this.renderHead}),i.addListening("list-"+e,this,[API.VOTE_UPDATE,API.USER_JOIN,API.USER_LEAVE],{fnCheck:function(){return s("list")},callback:this.renderList})},listenToWindow:function(){var t=this,e=this.options.modWindow,i=this.options.dispatcherWindow;this.listenTo(e,"change:visible",function(){e.get("visible")&&(t.updateUsersRearSpace(),t.options.pendingRenderHead&&t.renderHead(),t.options.pendingRenderList&&t.renderList())}),this.listenTo(i,i.AFTER_RENDER,function(){t.updateUsersRearSpace()}).listenTo(i,i.RESIZE_NOW,function(){t.updateUsersRearSpace()}).listenTo(i,i.RESIZE_START,function(){t.updateUsersRearSpace()})},updateUsersRearSpace:function(){var t=this;this.options.ticker.add("update-users-rear-space",function(){t.$elList.css("padding-bottom",.5*t.$elWrapList.height())})},close:function(){this.remove(),this.options.tableLayout.close(),this.options.viewHead.close(),this.options.viewList.close(),this.options.ticker.close()}});return a}),define("Plugbot/views/utils/Ui",[],function(){"use strict";var t={header:"#header",room:"#room",playback:"#playback",playlistPanel:"#playlist-panel",chatInputField:"#chat-input-field",woot:"#woot"},e={mainUi:".plugbot-ui",userlist:".plugbot-userlist"};return{plugdj:t,plugbot:e}}),define("Plugbot/views/utils/UiHelpers",["Plugbot/utils/Watcher"],function(t){"use strict";function e(t){var e;return e="#"===t[0]?t.substr(1):null}function i(t){var e;return e="."===t[0]?t.substr(1):null}function s(t,e){var i;switch(e){case"width":i=t.outerWidth()-t.innerWidth();break;case"height":i=t.outerHeight()-t.innerHeight();break;case"both":i={width:t.outerWidth()-t.innerWidth(),height:t.outerHeight()-t.innerHeight()}}return i}function n(t,e){var i;switch(e){case"width":i=t.innerWidth()-t.width();break;case"height":i=t.innerWidth()-t.width();break;case"both":i={width:t.innerWidth()-t.width(),height:t.innerWidth()-t.width()}}return i}function o(t,e){var i;switch(e){case"width":i=t.outerWidth(!0)-t.outerWidth();break;case"height":i=t.outerHeight(!0)-t.outerWidth();break;case"both":i={width:t.outerWidth(!0)-t.outerWidth(),height:t.outerHeight(!0)-t.outerWidth()}}return i}function l(t,e){var i,s,o=t.children();switch(e){case"width":s=n(t,"width");break;case"height":s=n(t,"height");break;case"both":s={width:n(t,"width"),height:n(t,"height")}}for(i=0;i!==o.length;i+=1)switch(e){case"width":s+=o[i].outerWidth(!0);break;case"height":s+=o[i].outerHeight(!0);break;case"both":s.width+=o[i].outerWidth(!0),s.height+=o[i].outerHeight(!0)}return s}function a(t,e,i){0===i?e.prepend(t):e.children().eq(i-1).after(t)}function r(t,e,i,s,n){var o=t.outerWidth(!0)-t.width(),l=t.outerHeight(!0)-t.height();switch(s=s||0,n=n||0,i){case"width":t.width(e.width()-o+s);break;case"height":t.height(e.height()-l+n);break;case"both":t.width(e.width()-o+s),t.height(e.height()-l+n)}}function d(t){var e,i=null;return e=t.next(),0===e.length&&(i=t.parent()),t=t.detach(),{elem:t,nextSibling:e,parent:i}}function u(t){null===t.parent?t.nextSibling.before(t.elem):t.parent.append(t.elem)}function c(e){var i=e.css("pointer-events"),s=new t,n=function(t){return 0===t.length?0:(t.css("pointer-events","none"),1)};return s.add("iframe-fix",{call:n,args:[e]}),n(e),{watcher:s,iframe:e,oriPointerEvents:i}}function h(t){t.iframe.css("pointer-events",t.oriPointerEvents),t.watcher.close()}return{getId:e,getClass:i,getBorder:s,getPadding:n,getMargin:o,getMinFloatSize:l,insertAt:a,fitElement:r,detach:d,reattach:u,iframeFix:c,removeIframeFix:h}});
//# sourceMappingURL=release.min.js.map