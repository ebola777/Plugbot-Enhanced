/* @license
 * Copyright (C) 2013  Shawn
 * This program is licensed under the MIT license.
 */
!function(){"use strict";var e;return e=document.getElementById("plugbot-js"),null!==e&&e.parentElement.removeChild(e),window.hasOwnProperty("Plugbot")?(void 0!==Plugbot.reload&&Plugbot.reload(),void 0):(window.Plugbot={},Plugbot.simpleRemove=function(){void 0!==window.requirejs&&(requirejs.undef("Plugbot/Entry"),requirejs.undef("Plugbot/Loader")),delete window.Plugbot},Plugbot.initDone=function(){delete Plugbot.simpleRemove},void 0!==window.API&&requirejs.specified("room")?(require(["Plugbot/Loader"],function(e){e.initialize()}),void 0):(Plugbot.simpleRemove(),void 0))}(),define("Plugbot/Entry",[],function(){"use strict";var e=function(){var e={environment:"RELEASE",baseUrl:"ebola777.github.io/files/Plugbot-Enhanced/",scriptDir:"js/",cssDir:"css/",scripts:["Plugbot/base/Events","Plugbot/base/Timer","Plugbot/events/dialog/FloatedWindowEvents","Plugbot/events/dialog/TaskbarItemEvents","Plugbot/events/SiteEvents","Plugbot/main/Dispose","Plugbot/main/Init","Plugbot/main/Settings","Plugbot/main/WindowManager","Plugbot/models/dialog/FloatedWindow","Plugbot/models/dialog/Taskbar","Plugbot/models/dialog/TaskbarCollection","Plugbot/models/dialog/TaskbarItemModel","Plugbot/models/MainUi/ItemCollection","Plugbot/models/MainUi/ItemModel","Plugbot/models/MainUi/Model","Plugbot/models/Userlist/ItemCollection","Plugbot/models/Userlist/ItemModel","Plugbot/models/Userlist/Model","Plugbot/store/LocalStorage","Plugbot/utils/API","Plugbot/utils/APIBuffer","Plugbot/utils/Countdown","Plugbot/utils/Helpers","Plugbot/utils/Ticker","Plugbot/utils/Watcher","Plugbot/views/dialog/FloatedWindow","Plugbot/views/dialog/Taskbar","Plugbot/views/dialog/TaskbarItemView","Plugbot/views/layout/TableLayout","Plugbot/views/MainUi/ItemView","Plugbot/views/MainUi/View","Plugbot/views/Userlist/HeadView","Plugbot/views/Userlist/UsersItemView","Plugbot/views/Userlist/UsersView","Plugbot/views/Userlist/View","Plugbot/views/utils/Ui","Plugbot/views/utils/UiHelpers"],scriptDep:["Plugbot/main/Settings","Plugbot/main/Init","Plugbot/main/Dispose"],refScriptsUrl:["ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/jquery-ui.min.js"],cssUrl:["style.min.css"],refCssUrl:["ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/themes/smoothness/jquery-ui.min.css"],cssClassname:"css-plugbot-enhanced",getRefScriptUrl:function(e){return"http://"+e},getCssUrl:function(t){return"http://"+e.baseUrl+e.cssDir+t},getRefCssUrl:function(e){return"http://"+e}};return e}();return e}),define("Plugbot/Loader",["Plugbot/Entry"],function(e){"use strict";var t=function(){var t={timeoutLoading:5e3,intervalRetry:1e3,maxNumRetry:2,numFiles:void 0,numLoadedFiles:void 0,loadedFiles:void 0,aborted:void 0,initialize:function(){var i,s=0,n=[],o=[];for(t.numFiles=0,t.numLoadedFiles=0,t.loadedFiles={},t.aborted=!1,i=0;i!==e.refScriptsUrl.length;i+=1)n.push(e.getRefScriptUrl(e.refScriptsUrl[i])),s+=1;for(i=0;i!==e.cssUrl.length;i+=1)o.push(e.getCssUrl(e.cssUrl[i])),s+=1;for(i=0;i!==e.refCssUrl.length;i+=1)o.push(e.getRefCssUrl(e.refCssUrl[i])),s+=1;if(0===s)return t.loadDep(),void 0;for(t.numFiles=s,i=0;i!==o.length;i+=1)t.loadCss(o[i]);for(i=0;i!==n.length;i+=1)t.loadScript(n[i],0)},loadDep:function(){var t,i,s=e.scriptDep;require(s,function(){for(t=0;t!==s.length;t+=1)i=require(s[t]),void 0!==i&&void 0!==i.initialize&&i.initialize()})},fileDone:function(e){t.isFileLoaded(e)||(t.loadedFiles[e]=!0,t.numLoadedFiles+=1,t.numLoadedFiles===t.numFiles&&t.loadDep())},fileFail:function(e,i){t.aborted||(t.aborted=!0,_.defaults(i,{textError:"Unknown"}),alert("Failed to load PlugBot file, stopping now.\n\nFile: "+e+"\nError: "+i.textError),Plugbot.simpleRemove())},loadScript:function(e,i){t.aborted||t.getScript(e,{timeout:t.timeoutLoading},function(){t.aborted||t.fileDone(e)},function(s){return t.aborted?void 0:(i=i||0,i+=1,i===t.maxNumRetry?(t.fileFail(e,{textError:s.status}),void 0):(setTimeout(function(){t.aborted||t.isFileLoaded(e)||t.loadScript(e,i)},t.intervalRetry),void 0))})},loadCss:function(i,s){t.aborted||t.getCss(i,{timeout:t.timeoutLoading,classname:e.cssClassname},function(){t.aborted||t.fileDone(i)},function(){return t.aborted?void 0:(s=s||0,s+=1,s===t.maxNumRetry?(t.fileFail(i,{textError:"Timeout"}),void 0):(setTimeout(function(){t.aborted||t.isFileLoaded(i)||t.loadCss(i,s)},t.intervalRetry),void 0))})},getScript:function(e,t,i,s){$.ajax({url:e,dataType:"script",crossDomain:!0,timeout:t.timeout,cache:!1}).done(i).fail(s)},getCss:function(e,t,i,s){var n,o;n=$(document.createElement("link")).prop({"class":t.classname,rel:"stylesheet",type:"text/css",href:e}),o=setTimeout(s,t.timeout),n[0].onload=function(){clearTimeout(o),i()},$(document.head).append(n)},isFileLoaded:function(e){return void 0!==t.loadedFiles[e]}};return t}();return t}),define("Plugbot/base/Events",[],function(){"use strict";var e={dispatch:function(e,t){var i=this[e];if(void 0===i)throw'Cannot find event "'+e+'".';this.trigger(this[e],t)}};return function(){_.extend(e,Backbone.Events)}(),e}),define("Plugbot/base/Timer",[],function(){"use strict";var e=Backbone.Model.extend({defaults:function(){return{interval:"optimal",optimalHz:12,autoStart:!0,exitWhenNoCall:!1,enabled:!1,items:{},idInterval:void 0,suspendedAll:!1}},initialize:function(){_.bindAll(this),_.defaults(this,this.attributes)},start:function(){var e=this.interval;return"optimal"===e?e=Math.round(1e3/this.optimalHz):"hz"===this.interval.substr(-2)&&(e=Math.round(1e3/+e.substr(0,e.length-2))),this.interval=e,this.idInterval=window.setInterval(this.fnTick,e),this.enabled=!0,this},fnTick:void 0,invoke:function(){return this.fnTick(),this},suspendAll:function(){return this.suspendedAll=!0,this},resumeAll:function(){return this.suspendedAll=!1,this},has:function(e){return void 0!==this.items[e]},setOptions:function(e,t){return this.items[e].options=t,this},setRuntime:function(e,t){return this.items[e].runtime=t,this},clear:function(){return this.items={},this},close:function(){clearInterval(this.idInterval),this.clear()}});return e}),define("Plugbot/events/SiteEvents",["Plugbot/base/Events"],function(e){"use strict";function t(){$(window).on("resize",s)}function i(){$(window).off("resize",s)}function s(e){n.dispatch("RESIZE",[e])}var n={RESIZE:"resize"};return function(){_.extend(n,e)}(),{dispatcher:n,initDispatcher:t,removeDispatcher:i}}),define("Plugbot/events/dialog/FloatedWindowEvents",["Plugbot/base/Events"],function(e){"use strict";var t={CHANGEANY_MODEL:"change-any:model",AFTER_RENDER:"after:render",SHOW:"show",HIDE:"hide",RESIZE_START:"resize:start",RESIZE_NOW:"resize:now",RESIZE_STOP:"resize:stop",DRAG_START:"drag:start",DRAG_NOW:"drag:now",DRAG_STOP:"drag:stop",CONTROLBOX_MINIMIZE:"control-box:minimize",CONTROLBOX_MAXIMIZE:"control-box:maximize",CONTROLBOX_CLOSE:"control-box:close",MOUSE_ENTER:"mouse-enter",MOUSE_LEAVE:"mouse-leave"};return function(){_.extend(t,e)}(),t}),define("Plugbot/events/dialog/TaskbarItemEvents",["Plugbot/base/Events"],function(e){"use strict";var t={MOUSE_ENTER:"mouse-enter",MOUSE_LEAVE:"mouse-leave"};return function(){_.extend(t,e)}(),t}),define("Plugbot/main/Dispose",["Plugbot/Entry","Plugbot/Loader","Plugbot/events/SiteEvents","Plugbot/main/Settings","Plugbot/main/WindowManager","Plugbot/utils/Helpers"],function(e,t,i,s,n,o){"use strict";function l(){Plugbot.disposeAndClose=function(){s.clearSettings(),Plugbot.close({saveSettings:!1})},Plugbot.disposeAndReload=function(){s.clearSettings(),Plugbot.reload({saveSettings:!1})},Plugbot.close=function(e){a(e),delete window.Plugbot},Plugbot.reload=function(e){var i,s=["initDone"],n={};for(e=e||{},e.removeEntryLoader=!1,a(e),i=0;i!==s.length;i+=1)n[s[i]]=Plugbot[s[i]];for(delete window.Plugbot,window.Plugbot={},i=0;i!==s.length;i+=1)Plugbot[s[i]]=n[s[i]];t.initialize()}}function a(e){e=e||{},_.defaults(e,{saveSettings:!0,removeEntryLoader:!0}),e.saveSettings&&s.saveSettings(),o.removeHandlebarsHelpers(),Plugbot.ticker.close(),Plugbot.watcher.close(),i.removeDispatcher(),u(),r(e.removeEntryLoader),d()}function r(t){var i;if(t&&(requirejs.undef("Plugbot/Entry"),requirejs.undef("Plugbot/Loader")),"DEBUG"===e.environment)for(i=0;i!==e.scripts.length;i+=1)requirejs.undef(e.scripts[i])}function d(){$(document.head).children("."+e.cssClassname).remove()}function u(){n.removeTaskbar(),n.removeWindows(),n.removeEvents()}return{initialize:l}}),define("Plugbot/main/Init",["Plugbot/events/SiteEvents","Plugbot/main/Settings","Plugbot/main/WindowManager","Plugbot/utils/Helpers","Plugbot/utils/Ticker","Plugbot/utils/Watcher"],function(e,t,i,s,n,o){"use strict";function l(){t.readSettings(),s.initHandlebarsHelpers(),Plugbot.ticker=new n,Plugbot.watcher=new o,e.initDispatcher(),a(),Plugbot.initDone()}function a(){i.initTaskbar(),i.initWindows(),i.initEvents(),i.initPublicMethods()}return{initialize:l}}),define("Plugbot/main/Settings",["Plugbot/store/LocalStorage","Plugbot/utils/Helpers","Plugbot/views/utils/Ui","Plugbot/views/utils/UiHelpers"],function(e,t,i,s){"use strict";function n(){Plugbot.settings=Plugbot.settings||{},r()}function o(){var i=e.readSettings(),s=c.version,n=function(e){var i=_.clone(u);return t.extendDeep(e,i),i},o=function(){var e=_.clone(c);t.applyDeep(i,e),Plugbot.settings=n(e)},l=function(){Plugbot.settings=n(c)};void 0!==i.version?s===i.version?o():""!==d&&i.version>=d?(o(),Plugbot.settings.version=s):l():l()}function l(){var i=_.clone(c);Plugbot.ticker.add(function(){t.applyDeep(Plugbot.settings,i),e.saveSettings(i)},{interval:Plugbot.tickerInterval.saveSettings})}function a(){e.clearSettings()}function r(){Plugbot.tickerInterval=Plugbot.tickerInterval||{},_.defaults(Plugbot.tickerInterval,{defaults:1e3,APICallback:3e3,saveSettings:5e3})}var d="1.0.3.pre",u={windows:{MainUi:{name:"MainUi",bodyClass:s.getClass(i.plugbot.mainUi),view:"Plugbot/views/MainUi/View",narrowAction:"none",title:"Plugbot",callsign:"PB",zIndex:22,resizable:!1,draggable:!0},Userlist:{name:"Userlist",bodyClass:s.getClass(i.plugbot.userlist),view:"Plugbot/views/Userlist/View",narrowAction:"callsign",title:"Userlist",callsign:"UL",zIndex:21,resizable:!0,draggable:!0,minWidth:120,maxWidth:320,minHeight:0,maxHeight:720}}},c={version:"1.0.4.pre",windows:{MainUi:{status:"normal",oldZIndex:22,x:70,y:85,oldX:70,oldY:85,width:"auto",height:"auto"},Userlist:{status:"minimized",oldZIndex:21,x:730,y:70,oldX:730,oldY:70,width:240,height:400}},ui:{autoWoot:!0,autoQueue:!1}};return{initialize:n,readSettings:o,saveSettings:l,clearSettings:a}}),define("Plugbot/main/WindowManager",["Plugbot/events/SiteEvents","Plugbot/main/Settings","Plugbot/models/dialog/FloatedWindow","Plugbot/models/dialog/Taskbar","Plugbot/models/dialog/TaskbarItemModel","Plugbot/utils/Watcher","Plugbot/views/dialog/FloatedWindow","Plugbot/views/dialog/Taskbar","Plugbot/views/utils/Ui"],function(e,t,i,s,n,o,l,a,r){"use strict";function d(){var e=function(e){var t,i=Plugbot.windows,s=e?"removeClass":"addClass";Plugbot.taskbar.$el[s]("plugbot-taskbar-hidden");for(t in i)i.hasOwnProperty(t)&&i[t].$el[s]("plugbot-floated-window-hidden")};Plugbot.hide=function(){return e(!1),this},Plugbot.show=function(){return e(!0),this}}function u(){var e,t;e=new s({windows:Plugbot.settings.windows,windowTop:$(r.plugdj.header).height()}),t=new a({model:e}),$(document.body).append(t.render().el),Plugbot.taskbar=t,E()}function c(){var e,t,s,n,o=Plugbot.settings.windows;Plugbot.windows=Plugbot.windows||{};for(e in o)o.hasOwnProperty(e)&&(t=o[e],s=new i(t),n=new l({model:s}),$(document.body).append(n.render().el),Plugbot.windows[e]=n,k(n))}function h(){p(),P(),b()}function g(){v()}function m(){Plugbot.taskbar.close()}function f(){var e,t=Plugbot.windows;for(e in t)t.hasOwnProperty(e)&&t[e].close()}function b(){var t={},i=e.dispatcher,s=$(r.plugdj.room),n=s.width();_.extend(t,Backbone.Events),t.listenTo(i,i.RESIZE,function(){var e,t,i=s.width(),o=i/n,l=Plugbot.windows;E();for(e in l)l.hasOwnProperty(e)&&(t=l[e],t.model.set("x",t.model.get("x")*o),t.model.set("oldX",t.model.get("oldX")*o));n=i})}function p(){$(window).on("scroll",w)}function v(){$(window).off("scroll",w)}function w(){E()}function P(){var e=$(r.plugdj.playlistPanel),t=!0;Plugbot.watcher.addFn(function(){e.is(":visible")?t&&(Plugbot.hide(),t=!1):t||(Plugbot.show(),t=!0)})}function k(e){var i={},s=e.options.dispatcher;_.extend(i,Backbone.Events),i.listenTo(s,s.CHANGEANY_MODEL,function(){Plugbot.ticker.add(function(){Plugbot.settings.windows[e.model.get("name")]=e.model.attributes,t.saveSettings()})}).listenTo(s,s.AFTER_RENDER,function(){var t=e.model.get("status");"minimized"===t&&x(e,{recordOldPos:!1})}).listenTo(s,s.CONTROLBOX_MINIMIZE,function(){var t=e.model.get("status");"minimized"!==t&&x(e)}).listenTo(s,s.CONTROLBOX_MAXIMIZE,function(){var t=e.model.get("status");"minimized"===t&&C(e)})}function E(){Plugbot.taskbar.$el.css({top:$(r.plugdj.header).height()-$(window).scrollTop(),height:$(r.plugdj.room).height()})}function x(e,t){t=t||{},_.defaults(t,{recordOldPos:!0}),e.model.set("status","minimized"),e.switchResizable(!1),e.switchDraggable(!1),t.recordOldPos&&e.model.set({oldX:e.model.get("x"),oldY:e.model.get("y"),oldZIndex:e.model.get("zIndex")}),e.hide(),Plugbot.taskbar.collection.add(new n({name:e.model.get("name"),title:e.model.get("title"),window:e}))}function C(e){var t=Plugbot.taskbar.collection;e.model.set("status","normal"),e.switchResizable(!0),e.switchDraggable(!0),e.model.set({x:e.model.get("oldX"),y:e.model.get("oldY"),zIndex:e.model.get("oldZIndex")}),e.show(),t.remove(t.findWhere({name:e.model.get("name")}))}return{initPublicMethods:d,initTaskbar:u,initWindows:c,initEvents:h,removeEvents:g,removeTaskbar:m,removeWindows:f}}),define("Plugbot/models/dialog/FloatedWindow",[],function(){"use strict";var e=Backbone.Model.extend({defaults:function(){return{name:void 0,bodyClass:"",status:"normal",view:void 0,visible:!0,narrowAction:"hidden",title:"Untitled",callsign:"AAA",zIndex:void 0,oldZIndex:void 0,resizable:!1,draggable:!1,x:0,y:0,oldX:0,oldY:0,width:"auto",height:"auto",minWidth:0,maxWidth:0,minHeight:0,maxHeight:0,minimizeBox:!1,restireBox:!1,closeBox:!1}},NarrowActions:{none:0,hidden:1,callsign:2,expanded:3},Status:{hidden:0,minimized:1,normal:2}});return e}),define("Plugbot/models/dialog/Taskbar",[],function(){"use strict";var e=Backbone.Model.extend({defaults:function(){return{windows:void 0,windowTop:0}}});return e}),define("Plugbot/models/dialog/TaskbarCollection",["Plugbot/models/dialog/TaskbarItemModel"],function(e){"use strict";var t=Backbone.Collection.extend({model:e,initialize:function(){_.bindAll(this)},comparator:function(e,t){var i=0,s=-1,n=e.get("window").model,o=t.get("window").model,l=n.get("oldZIndex"),a=o.get("oldZIndex");return a>l?i=-s:l>a&&(i=s),i},close:function(){this.reset()}});return t}),define("Plugbot/models/dialog/TaskbarItemModel",[],function(){"use strict";var e=Backbone.Model.extend({defaults:function(){return{name:void 0,title:"Unnamed",window:void 0}}});return e}),define("Plugbot/models/MainUi/ItemCollection",["Plugbot/models/MainUi/ItemModel"],function(e){"use strict";var t=Backbone.Collection.extend({model:e,initialize:function(){_.bindAll(this)},close:function(){this.reset()}});return t}),define("Plugbot/models/MainUi/ItemModel",[],function(){"use strict";var e=Backbone.Model.extend({defaults:function(){return{id:void 0,text:void 0,enabled:!1}},initialize:function(){_.bindAll(this),this.listenTo(this,"change:enabled",this.setSettings)},setSettings:function(){var e=this.get("enabled");switch(this.get("id")){case"plugbot-btn-woot":Plugbot.settings.ui.autoWoot=e;break;case"plugbot-btn-queue":Plugbot.settings.ui.autoQueue=e}}});return e}),define("Plugbot/models/MainUi/Model",[],function(){"use strict";var e=Backbone.Model.extend({defaults:function(){return{data:[{id:"plugbot-btn-woot",text:"auto-woot",enabled:Plugbot.settings.ui.autoWoot},{id:"plugbot-btn-queue",text:"auto-queue",enabled:Plugbot.settings.ui.autoQueue},{id:"plugbot-btn-skip-video",text:"skip video",enabled:!1}]}}});return e}),define("Plugbot/models/Userlist/ItemCollection",["Plugbot/models/Userlist/ItemModel"],function(e){"use strict";var t=Backbone.Collection.extend({model:e,initialize:function(){_.bindAll(this)},comparator:function(e,t){var i=0,s=1,n=e.get("user"),o=t.get("user"),l=+n.permission,a=+o.permission,r=n.username.toUpperCase(),d=o.username.toUpperCase();return l>a?i=-s:a>l?i=s:d>r?i=-s:r>d&&(i=s),i},close:function(){this.reset()}});return t}),define("Plugbot/models/Userlist/ItemModel",[],function(){"use strict";var e=Backbone.Model.extend({defaults:function(){return{id:void 0,user:void 0}}});return e}),define("Plugbot/models/Userlist/Model",[],function(){"use strict";var e=Backbone.Model.extend({defaults:function(){return{numUsers:void 0,waitListPos:void 0,users:void 0}},updateAll:function(){this.updateUsers(),this.updateWaitList()},updateUsers:function(){this.set("users",API.getUsers())},updateWaitList:function(){this.set("waitListPos",API.getWaitListPosition()),this.set("waitListNum",API.getWaitList().length)}});return e}),define("Plugbot/store/LocalStorage",[],function(){"use strict";function e(){var e={};try{e=JSON.parse(localStorage.getItem(s))||{}}catch(t){e={}}return e}function t(e){localStorage.setItem(s,JSON.stringify(e))}function i(){localStorage.removeItem(s)}var s="PlugbotEnhanced";return{readSettings:e,saveSettings:t,clearSettings:i}}),define("Plugbot/utils/API",[],function(){"use strict";var e={VOTE:{WOOT:1,UNDECIDED:0,MEH:-1}};return{USER:e}}),define("Plugbot/utils/APIBuffer",[],function(){"use strict";function e(e,t,i,s){var n,o=function(i,s){t.listenTo(API,i,function(){Plugbot.ticker.addId(e,function(){void 0!==s.fnCheck?s.fnCheck()&&s.callback():s.callback()},{interval:Plugbot.tickerInterval.APICallback})})};for(s=s||{},_.defaults(s,{fnCheck:void 0,callback:void 0}),n=0;n!==i.length;n+=1)o(i[n],s)}function t(e,t){var i,s=function(t){e.stopListening(API,t)};if(void 0===t)e.stopListening(API);else for(i=0;i!==t.length;i+=1)s(t[i])}return{addListening:e,stopListening:t}}),define("Plugbot/utils/Countdown",["Plugbot/base/Timer","Plugbot/utils/Helpers"],function(e,t){"use strict";var i=e.extend({defaults:function(){return{defaultOptions:{call:void 0,countdown:0},defaultRuntime:{suspended:!1,elapsed:0,waitCallbacks:[]}}},initialize:function(){_.bindAll(this),this.parent=e.prototype,this.parent.initialize.call(this),_.defaults(this,this.parent.defaults()),t.defaultsDeep(this.defaults(),this)},fnTick:function(){var e,t,i,s,n,o,l;if(!this.suspendedAll){i=!0,t=this.items;for(s in t)if(t.hasOwnProperty(s)&&(i=!1,n=t[s],l=n.runtime,!l.suspended))if(o=n.options,l.elapsed+=this.interval,l.elapsed>=o.countdown){if(void 0!==o.call)for(o.call(),e=0;e<l.waitCallbacks.length;e+=1)l.waitCallbacks[e]();this.remove(s)}else this.items[s].runtime=l;i&&this.exitWhenNoCall&&this.close()}},add:function(e,t){var i,s;return void 0!==this.items[e]?this:(i=this.defaultOptions,s=this.defaultRuntime,t=t||{},_.defaults(t,{call:i.call,countdown:i.countdown}),this.items[e]={options:t,runtime:{suspended:s.suspended,elapsed:s.elapsed,waitCallbacks:s.waitCallbacks}},this.enabled||this.autoStart&&this.start(),this)},remove:function(e){return void 0===this.items[e]?this:(delete this.items[e],this)},wait:function(e,t){this.items[e].runtime.waitCallbacks.push(t)},suspend:function(e){return this.items[e].runtime.suspended=!0,this},resume:function(e){return this.items[e].runtime.suspended=!1,this},setCountdown:function(e,t){return this.items[e].options.countdown=t,this},callAndRemove:function(e){return this.items[e].options.call(),delete this.items[e],this},setElapsed:function(e,t){return this.items[e].runtime.elapsed=t,this},resetElapsed:function(e){return this.items[e].runtime.elapsed=0,this},delay:function(e,t){return this.items[e].runtime.elapsed-=t,this},forward:function(e,t){return this.items[e].runtime.elapsed+=t,this}});return i}),define("Plugbot/utils/Helpers",["handlebars"],function(e){"use strict";function t(){e.registerHelper("getName",function(e){return e.substr(1)})}function i(){delete e.helpers.getName}function s(e,t){var i;for(i in e)e.hasOwnProperty(i)&&(t.hasOwnProperty(i)?s(e[i],t[i]):t[i]=e[i])}function n(e,t){var i,s,o;for(i in e)e.hasOwnProperty(i)&&(s=e[i],t.hasOwnProperty(i)?(o=t[i],"object"!=typeof s||"object"!=typeof o?t[i]=s:n(s,o)):t[i]=s)}function o(e,t){var i,s,n;for(i in e)e.hasOwnProperty(i)&&(s=e[i],t.hasOwnProperty(i)&&(n=t[i],"object"!=typeof s||"object"!=typeof n?t[i]=s:o(s,n)))}return{initHandlebarsHelpers:t,removeHandlebarsHelpers:i,defaultsDeep:s,extendDeep:n,applyDeep:o}}),define("Plugbot/utils/Ticker",[],function(){"use strict";var e=Backbone.Model.extend({defaults:function(){return{interval:1e3,calls:[]}},initialize:function(){_.bindAll(this),_.defaults(this,this.attributes),_.defaults(this,this.defaults())},add:function(e,t){var i,s,n=this;-1===this.calls.indexOf(e)&&(t=t||{},_.defaults(t,{interval:this.interval}),i=t.interval,this.calls.push(e),s=i-Date.now()%i,setTimeout(function(){var t;t=n.calls.indexOf(e),-1!==t&&(e(),n.calls.splice(t,1))},s))},addId:function(e,t,i){var s,n,o,l=this;-1===this.calls.indexOf(e)&&(i=i||{},_.defaults(i,{interval:this.interval}),s=i.interval,this.calls.push(e),n=(new Date).getTime(),o=s-n%s,setTimeout(function(){var i;i=l.calls.indexOf(e),-1!==i&&(t(),l.calls.splice(i,1))},o))},remove:function(e){var t=this.calls.indexOf(e);-1!==t&&this.calls.splice(t,1)},removeId:function(e){this.remove(e)},clear:function(){this.calls=[]},close:function(){this.clear()}});return e}),define("Plugbot/utils/Watcher",["Plugbot/base/Timer","Plugbot/utils/Helpers"],function(e,t){"use strict";var i=e.extend({defaults:function(){return{defaultOptions:{call:void 0,args:void 0,exitValue:0,exitCall:void 0,maxNumCall:0},defaultRuntime:{suspended:!1,numCall:0}}},initialize:function(){_.bindAll(this),this.parent=e.prototype,this.parent.initialize.call(this),_.defaults(this,this.parent.defaults()),t.defaultsDeep(this.defaults(),this)},fnTick:function(){var e,t,i,s,n,o,l,a;if(!this.suspendedAll){t=!0,e=this.items;for(i in e)e.hasOwnProperty(i)&&(t=!1,s=e[i],o=s.runtime,o.suspended||(n=s.options,a=0!==n.maxNumCall,l=n.call.apply(null,n.args),a&&(o.numCall+=1),l===n.exitValue||a&&o.numCall>n.maxNumCall?(n.exitCall&&n.exitCall(),this.remove(i)):this.items[i].runtime=o));t&&this.exitWhenNoCall&&this.close()}},addFn:function(e){this.add(Date.now(),{call:e})},add:function(e,t){var i,s;return void 0!==this.items[e]?this:(i=this.defaultOptions,s=this.defaultRuntime,t=t||{},_.defaults(t,{call:i.call,exitValue:i.exitValue,exitCall:i.exitCall,maxNumCall:i.maxNumCall}),this.items[e]={options:t,runtime:{suspended:s.suspended,numCall:s.numCall}},this.enabled||this.autoStart&&this.start(),void 0)},remove:function(e){return void 0===this.items[e]?this:(delete this.items[e],this)},suspend:function(e){return this.items[e].runtime.suspended=!0,this},resume:function(e){return this.items[e].runtime.suspended=!1,this}});return i}),define("Plugbot/views/dialog/FloatedWindow",["handlebars","Plugbot/events/dialog/FloatedWindowEvents","Plugbot/models/dialog/FloatedWindow","Plugbot/utils/Watcher","Plugbot/views/utils/Ui","Plugbot/views/utils/UiHelpers"],function(e,t,i,s,n,o){"use strict";var l=Backbone.View.extend({defaults:function(){return{dispatcher:_.clone(t),hasRenderedWindow:!1,hasRenderedBody:!1,bodyView:void 0,tableLayout:void 0,nowNarrowAction:this.NarrowActions.expanded}},events:{mouseenter:"onMouseEnter",mouseleave:"onMouseLeave"},initialize:function(){_.bindAll(this),_.defaults(this.options,this.defaults()),this.listenTo(this.model,"change",this.onChangeAll),this.listenTo(this.model,"change:visible",this.onChangeVisible),this.listenTo(this.model,"change:zIndex",this.onChangeZIndex),this.listenTo(this.model,"change:x change:y",this.onChangePos),this.listenTo(this.model,"change:width change:height",this.onChangeSize),this.listenTo(this.model,"change:resizable",this.onChangeResizable),this.listenTo(this.model,"change:draggable",this.onChangeDraggable),this.hide()},NarrowActions:i.prototype.NarrowActions,Status:i.prototype.Status,minWidth:160,minHeight:40,buttonClasses:["ui-icon-minus","ui-icon-extlink","ui-icon-close"],buttonNames:["minimize","maximize","close"],elHeader:".header",elTitle:".title",elControlBox:".control-box",elMinimize:".minimize",elMaximize:".maximize",elClose:".close",elBody:".body",template:e.compile('    <div class="plugbot-floated-window">    <div class="{{getName classHeader}}">        <h1 class="{{getName classTitle}}">{{textTitle}}</h1>        <div class="{{getName classControlBox}}">            <button class="{{getName classMinimize}}" title="Minimize"></button>            <button class="{{getName classMaximize}}" title="Restore"></button>            <button class="{{getName classClose}}" title="Close"></button>        </div>    </div>    <div class="{{getName classBody}}"></div></div>'),render:function(){var e,t,i,s=this;for(this.setElement(this.template({textTitle:this.model.get("title"),classHeader:this.elHeader,classTitle:this.elTitle,classControlBox:this.elControlBox,classMinimize:this.elMinimize,classMaximize:this.elMaximize,classClose:this.elClose,classBody:this.elBody})),this.$el.addClass("scheme-default-plugbot-floated-window"),t=[this.$(this.elMinimize),this.$(this.elMaximize),this.$(this.elClose)],i=this.$(this.elBody),e=0;e!==t.length;e+=1)t[e].button({icons:{primary:this.buttonClasses[e]},text:!1}),t[e].data("name",this.buttonNames[e]),t[e].on("click",this.onClickControlBoxButton);return i.addClass(this.model.get("bodyClass")),this.$el.css({position:"absolute",left:this.model.get("x"),top:this.model.get("y"),width:this.model.get("width"),height:this.model.get("height"),"min-width":this.minWidth,"min-height":this.minHeight,"z-index":this.model.get("zIndex")}),this.bindUiEvents(),Plugbot.watcher.addFn(function(){var e;return s.$el.is(":visible")&&(s.afterRender(),s.options.hasRenderedWindow=!0,e=0),e}),require([this.model.get("view")],function(e){s.options.bodyView=new e({el:i,modWindow:s.model,dispatcherWindow:s.options.dispatcher}),s.options.bodyView.render(),s.show(),s.options.hasRenderedBody=!0}),this},afterRender:function(){this.updateTitle(),this.resizeBody(),this.resizeTableLayout(),this.options.dispatcher.dispatch("AFTER_RENDER")},show:function(){this.model.set("visible",!0),this.resizeBody(),this.options.dispatcher.dispatch("SHOW")},hide:function(){this.model.set("visible",!1),this.options.dispatcher.dispatch("HIDE")},getBodyView:function(){return this.options.bodyView},getRemainingHeaderSpace:function(e){var t=this.$(this.elHeader),i=this.$(this.elTitle),s=this.$(this.elControlBox);return t.width()-i.outerWidth(!0)-s.outerWidth(!0)-e},resizeBody:function(){var e=this.$(this.elBody),t=this.$(this.elHeader);this.model.get("visible")&&o.fitElement(e,this.$el,"both",0,-t.outerHeight(!0))},resizeTableLayout:function(){var e=this.model.get("tableLayout");void 0!==e&&e.resize()},updateTitle:function(){var e,t=this.$(this.elTitle),i=this.NarrowActions,s=i[this.model.get("narrowAction")],n=this.model.get("title"),o=this.model.get("callsign"),l=8;switch(this.options.nowNarrowAction){case i.expanded:if(e=this.getRemainingHeaderSpace(l),0>e)switch(s){case i.none:this.$el.css("min-width",this.$el.width()-e),this.options.nowNarrowAction=i.none;break;case i.hidden:t.hide(),this.options.nowNarrowAction=i.hidden;break;case i.callsign:t.text("<"+o+">"),this.options.nowNarrowAction=i.callsign}break;case i.none:break;case i.hidden:t.text(n),t.show(),e=this.getRemainingHeaderSpace(l),e>=0?this.options.nowNarrowAction=i.expanded:t.hide();break;case i.callsign:t.text(n),e=this.getRemainingHeaderSpace(l),e>=0?this.options.nowNarrowAction=i.expanded:t.text("<"+o+">")}},switchResizable:function(e){this.model.get("resizable")&&(e?this.$el.resizable("enable"):this.$el.resizable("disable"))},switchDraggable:function(e){this.model.get("draggable")&&(e?this.$el.draggable("enable"):(this.$el.draggable("disable"),this.$el.css("opacity",1)))},bindUiEvents:function(){var e,t,i=this;this.model.get("resizable")&&this.$el.resizable({containment:"document",handles:"n, e, s, w, se",distance:0,grid:8,minWidth:Math.max(this.minWidth,this.model.get("minWidth")),minHeight:Math.max(this.minHeight,this.model.get("minHeight")),maxWidth:this.model.get("maxWidth"),maxHeight:this.model.get("maxHeight"),start:function(l,a){e=o.iframeFix($(n.plugdj.playback)),void 0!==i.model.get("tableLayout")&&(t=new s,t.addFn(i.resizeTableLayout)),i.options.dispatcher.dispatch("RESIZE_START",[l,a])},resize:function(e,t){i.updateTitle(),i.resizeBody(),i.options.dispatcher.dispatch("RESIZE_NOW",[e,t])},stop:function(s,n){o.removeIframeFix(e),void 0!==t&&t.close(),i.model.set({width:n.size.width,height:n.size.height}),i.options.dispatcher.dispatch("RESIZE_STOP",[s,n])}}),this.model.get("draggable")&&this.$el.draggable({containment:"document",zIndex:10001,handle:".header",scroll:!0,scrollSensitivity:8,snap:"div",snapMode:"both",snapTolerance:8,cursor:"move",start:function(t,s){var l=$(this);l.css({width:l.width(),height:l.height()}).data({diffOfs:{X:s.position.left-s.offset.left,Y:s.position.top-s.offset.top}}),e=o.iframeFix($(n.plugdj.playback)),i.options.dispatcher.dispatch("DRAG_START",[t,s])},drag:function(e,t){var s=$(this).data("diffOfs");t.position.left-=s.X,t.position.top-=s.Y,i.options.dispatcher.dispatch("DRAG_NOW",[e,t])},stop:function(t,s){o.removeIframeFix(e),i.model.set({x:s.position.left,y:s.position.top}),i.options.dispatcher.dispatch("DRAG_STOP",[t,s])}})},onMouseEnter:function(){this.options.dispatcher.dispatch("MOUSE_ENTER")},onMouseLeave:function(){this.options.dispatcher.dispatch("MOUSE_LEAVE")},onChangeVisible:function(){this.model.get("visible")?this.$el.show():this.$el.hide()},onChangeZIndex:function(){this.$el.css("z-index",this.model.get("zIndex"))},onChangePos:function(){this.$el.css({left:this.model.get("x"),top:this.model.get("y")})},onChangeSize:function(){this.$el.css({width:this.model.get("width"),height:this.model.get("height")})},onClickControlBoxButton:function(e){var t=this,i={cancel:!1,enabledCallback:!1,callback:function(){i.cancel||t.close()}};switch($(e.currentTarget).data("name")){case"minimize":this.options.dispatcher.dispatch("CONTROLBOX_MINIMIZE",i);break;case"maximize":this.options.dispatcher.dispatch("CONTROLBOX_MAXIMIZE",i);break;case"close":this.options.dispatcher.dispatch("CONTROLBOX_CLOSE",i),!i.enabledCallback}},onChangeAll:function(){this.options.dispatcher.dispatch("CHANGEANY_MODEL")},close:function(){this.remove(),this.options.bodyView.close()}});return l}),define("Plugbot/views/dialog/Taskbar",["handlebars","Plugbot/models/dialog/Taskbar","Plugbot/models/dialog/TaskbarCollection","Plugbot/utils/Countdown","Plugbot/views/dialog/TaskbarItemView","Plugbot/views/utils/UiHelpers"],function(e,t,i,s,n,o){"use strict";var l=Backbone.View.extend({defaults:function(){return{views:{},countdownSlide:new s,countdownTask:new s,currentWindow:void 0}},events:{mouseenter:"onMouseEnter",mouseleave:"onMouseLeave"},initialize:function(){_.bindAll(this),_.defaults(this.options,this.defaults()),this.collection=new i,this.listenTo(this.collection,"add",this.addOne),this.listenTo(this.collection,"remove",this.removeOne),this.bindUiEvents()},elContent:".content",elHandle:".handle",elContainer:".container",template:e.compile('    <div class="plugbot-taskbar">    <div class="{{getName classContent}}">        <ul class="{{getName classContainer}}"></ul>    </div>    <div class="{{getName classHandle}}"></div></div>'),render:function(){return this.setElement(this.template({classContent:this.elContent,classHandle:this.elHandle,classContainer:this.elContainer})),this.$el.trigger("mouseleave"),this},addOne:function(e){var t,i=new n({model:e}),s=this.$(this.elContainer);this.options.views[e.cid]=i,t=this.collection.indexOf(e),o.insertAt(i.render().el,s,t),this.listenToItem(i),this.listenToWindow(e.get("window"))},removeOne:function(e){var t=e.cid,i=this.options.views;this.stopListeningItem(this.options.views[e.cid]),this.stopListeningWindow(e.get("window")),this.options.countdownSlide.resumeAll(),this.options.countdownTask.resumeAll(),this.options.currentWindow=void 0,i[t].close(),delete i[t]
},listenToItem:function(e){var t=this,i=e.options.dispatcher,s=e.model.cid,n="mouse-enter",o="mouse-leave";this.listenTo(i,i.MOUSE_ENTER,function(e){t.options.countdownTask.remove(n+":"+s).add(n+":"+s,{call:function(){var i=e.model.get("window");t.options.currentWindow=i,t.showWindow(i)},countdown:300})}),this.listenTo(i,i.MOUSE_LEAVE,function(e){t.options.countdownTask.remove(o+":"+s).add(o+":"+s,{call:function(){var i=e.model.get("window");t.options.currentWindow=void 0,t.hideWindow(i)},countdown:300})})},listenToWindow:function(e){var t=e.options.dispatcher,i=this.options.countdownSlide,s=this.options.countdownTask;this.listenTo(t,t.MOUSE_ENTER,function(){i.suspendAll(),s.suspendAll()}),this.listenTo(t,t.MOUSE_LEAVE,function(){i.resumeAll(),s.resumeAll()})},stopListeningItem:function(e){var t=e.options.dispatcher,i=e.model.cid;this.stopListening(t),this.options.countdownTask.remove("mouse-enter:"+i).remove("mouse-leave:"+i)},stopListeningWindow:function(e){var t=e.options.dispatcher;this.stopListening(t)},showWindow:function(e){e.model.set({x:this.$el.width()+$(window).scrollLeft(),y:this.model.get("windowTop"),zIndex:1e4}),e.show()},hideWindow:function(e){e.hide()},expand:function(){this.$el.animate({left:0},200)},collapse:function(){var e=this.$(this.elContent);this.$el.animate({left:-e.width()},200)},bindUiEvents:function(){$(window).on("scroll",this.onWindowScroll)},unbindUiEvents:function(){$(window).off("scroll",this.onWindowScroll)},onWindowScroll:function(){var e=this.options.currentWindow;void 0!==e&&this.showWindow(this.options.currentWindow)},onMouseEnter:function(){var e=this,t=this.options.countdownSlide;t.remove("mouse-leave").add("mouse-enter",{call:function(){e.expand()},countdown:100})},onMouseLeave:function(){var e=this,t=this.options.countdownSlide;t.remove("mouse-enter").add("mouse-leave",{call:function(){e.collapse()},countdown:500})},close:function(){var e,t=this.options.views;this.unbindUiEvents(),this.remove(),this.collection.close();for(e in t)t.hasOwnProperty(e)&&t[e].close()}});return l}),define("Plugbot/views/dialog/TaskbarItemView",["handlebars","Plugbot/events/dialog/TaskbarItemEvents"],function(e,t){"use strict";var i=Backbone.View.extend({defaults:function(){return{dispatcher:_.clone(t)}},events:{mouseenter:"onMouseEnter",mouseleave:"onMouseLeave"},initialize:function(){_.bindAll(this),_.defaults(this.options,this.defaults())},template:e.compile('    <li class="task">{{title}}</li>'),render:function(){return this.setElement(this.template({title:this.model.get("title")})),this},onMouseEnter:function(){this.options.dispatcher.dispatch("MOUSE_ENTER",{model:this.model})},onMouseLeave:function(){this.options.dispatcher.dispatch("MOUSE_LEAVE",{model:this.model})},close:function(){this.remove()}});return i}),define("Plugbot/views/layout/TableLayout",["Plugbot/views/utils/UiHelpers"],function(e){"use strict";var t=Backbone.View.extend({defaults:function(){return{display:void 0,classes:[],values:[],styles:[],grows:[]}},initialize:function(){_.bindAll(this),_.defaults(this.options,this.defaults)},elTableLayout:".plugbot-table-layout",render:function(){this.$el.addClass(e.getClass(this.elTableLayout)),this.$el.children("div").addClass(this.options.display),this.resize()},resize:function(){var e,t,i,s,n,o,l,a,r="row"===this.options.display?"width":"height",d="row"===this.options.display?"outerWidth":"outerHeight";for(l=this.$el[r](),a=[],o=0,e=0;e!==this.options.classes.length;e+=1)switch(t=this.$("."+this.options.classes[e]),i=this.options.values[e],s=this.options.styles[e],n=this.options.grows[e],s){case"auto":t.css(r,"auto"),l-=t[d](!0);break;case"px":t.css(r,i+"px"),l-=t[d](!0);break;case"%":t.css(r,i+"%"),l-=t[d](!0);break;case"?":t.css(r,"auto"),o+=n,a.push(e)}if(0!==o)for(l/=o,e=0;e!==a.length;e+=1)t=this.$("."+this.options.classes[a[e]]),n=this.options.grows[a[e]],t.css(r,l*n-(t[d](!0)-t[r]())+"px")},close:function(){}});return t}),define("Plugbot/views/MainUi/ItemView",["handlebars"],function(e){"use strict";var t=Backbone.View.extend({initialize:function(){_.bindAll(this),this.listenTo(this.model,"change:enabled",this.render2)},events:{click:"onClick"},template:e.compile('<p id="{{id}}" class="{{class}}">{{text}}</p>'),render:function(){return this.setElement(this.template({id:this.model.get("id"),"class":this.getClass(this.model.get("enabled")),text:this.model.get("text")})),this},render2:function(){return this.$el.prop("class",this.getClass(this.model.get("enabled"))),this},getClass:function(e){return e?"item-enabled":"item-disabled"},onClick:function(){this.model.set("enabled",!this.model.get("enabled"))},close:function(){this.remove()}});return t}),define("Plugbot/views/MainUi/View",["handlebars","Plugbot/models/MainUi/ItemCollection","Plugbot/models/MainUi/ItemModel","Plugbot/models/MainUi/Model","Plugbot/utils/API","Plugbot/utils/APIBuffer","Plugbot/utils/Watcher","Plugbot/views/MainUi/ItemView","Plugbot/views/utils/Ui"],function(e,t,i,s,n,o,l,a,r){"use strict";var d=Backbone.View.extend({defaults:function(){return{dispatcherWindow:void 0,watcherAutoQueue:new l({interval:"1 hz"}),watcherSkipVideo:new l({interval:"1 hz"}),views:{},elemDialogAsk:void 0,lastPlaybackVolume:void 0}},model:new s,initialize:function(){_.bindAll(this),_.defaults(this.options,this.defaults()),this.collection=new t,this.listenTo(this.collection,"add",this.addOne),this.listenToWindow(),this.listenToAPI(),this.onClickWoot(Plugbot.settings.ui.autoWoot).onClickQueue(Plugbot.settings.ui.autoQueue).onClickSkipVideo(!1)},el:r.plugbot.mainUi,templateDialogAsk:e.compile('    <div title="Exit">    <p>Exit Plugbot Enhanced?    </p></div>'),events:{"click p":"onClick"},render:function(){var e,t,s=this.model.get("data");for(this.options.elemDialogAsk=$(this.templateDialogAsk()),e=0;e!==s.length;e+=1)t=new i(s[e]),this.collection.add(t);return this},addOne:function(e){var t=new a({model:e});this.options.views[e.id]=t,this.$el.append(t.render().el)},listenToAPI:function(){var e=this,t=this.model.cid;o.addListening("auto-woot-"+t,this,[API.DJ_ADVANCE],{fnCheck:function(){return Plugbot.settings.ui.autoWoot},callback:function(){$(r.plugdj.woot).click()}}),o.addListening("auto-queue-"+t,this,[API.WAIT_LIST_UPDATE],{fnCheck:function(){return Plugbot.settings.ui.autoQueue},callback:this.enableAutoQueue}),o.addListening("skip-video-"+t,this,[API.DJ_ADVANCE],{fnCheck:function(){return e.options.watcherSkipVideo.remove("skip-video"),e.collection.get("plugbot-btn-skip-video").get("enabled")},callback:function(){var t=e.options.lastPlaybackVolume;e.disableSkipVideo(),API.setVolume(0),e.options.watcherSkipVideo.add("skip-video",{call:function(e){var t,i=API.getVolume();return 0===i||i===e?API.setVolume(e):t=0,t},args:[t]})}})},listenToWindow:function(){var e=this.options.dispatcherWindow;this.listenTo(e,e.CONTROLBOX_CLOSE,function(e){e.enabledCallback=!0,this.options.elemDialogAsk.dialog({modal:!0,draggable:!1,resizable:!1,buttons:{OK:function(){e.callback(),Plugbot.close(),$(this).dialog("close")},Cancel:function(){e.cancel=!0,e.callback(),$(this).dialog("close")}}})})},onClick:function(e){var t=e.target.id,i=this.collection.get(t),s=i.get("enabled");switch(t){case"plugbot-btn-woot":this.onClickWoot(s);break;case"plugbot-btn-queue":this.onClickQueue(s);break;case"plugbot-btn-skip-video":this.onClickSkipVideo(s)}},onClickWoot:function(e){return e&&n.USER.VOTE.UNDECIDED===API.getUser().vote&&$(r.plugdj.woot).click(),this},onClickQueue:function(e){return e?this.enableAutoQueue():this.disableAutoQueue(),this},onClickSkipVideo:function(e){return e?this.enableSkipVideo():this.disableSkipVideo(),this},enableAutoQueue:function(){var e=API.djJoin();0!==e&&this.options.watcherAutoQueue.add("auto-queue",{call:function(){return API.djJoin()}})},disableAutoQueue:function(){this.options.watcherAutoQueue.remove("auto-queue")},enableSkipVideo:function(){this.options.watcherSkipVideo.remove("skip-video"),this.options.lastPlaybackVolume=API.getVolume(),API.setVolume(0)},disableSkipVideo:function(){var e;void 0!==this.options.lastPlaybackVolume&&(e=this.collection.get("plugbot-btn-skip-video"),e.set("enabled",!1),0===API.getVolume()&&(API.setVolume(this.options.lastPlaybackVolume),this.options.lastPlaybackVolume=void 0))},close:function(){var e,t=this.options.views;this.remove(),this.collection.close();for(e in t)t.hasOwnProperty(e)&&t[e].close();this.options.watcherAutoQueue.close(),this.options.watcherSkipVideo.close()}});return d}),define("Plugbot/views/Userlist/HeadView",["handlebars"],function(e){"use strict";var t=Backbone.View.extend({initialize:function(){_.bindAll(this)},template:e.compile('   <h1 class="userlist-queuespot">{{textQueueSpot}}</h1>'),render:function(){var e=this.model.get("waitListPos");return this.$el.html(this.template({textQueueSpot:"Waitlist: "+(-1===e?"-":e)+" / "+this.model.get("waitListNum")})),this},close:function(){this.remove()}});return t}),define("Plugbot/views/Userlist/UsersItemView",["handlebars","Plugbot/utils/API"],function(e,t){"use strict";var i=Backbone.View.extend({initialize:function(){_.bindAll(this)},template:e.compile('    <li class="userlist-item {{classVote}}" data-id="{{id}}">{{text}}</li>'),render:function(){var e=this.model.get("user");return this.setElement(this.template({id:this.model.get("id"),classVote:this.getClass(+e.vote),text:e.username})),this},getClass:function(e){var i,s=t.USER.VOTE;switch(e){case s.WOOT:i="item-woot";break;case s.UNDECIDED:i="item-undecided";break;case s.MEH:i="item-meh"}return i},close:function(){this.remove()}});return i}),define("Plugbot/views/Userlist/UsersView",["Plugbot/models/Userlist/ItemCollection","Plugbot/views/Userlist/UsersItemView","Plugbot/views/utils/Ui"],function(e,t,i){"use strict";var s=Backbone.View.extend({defaults:function(){return{views:{}}},initialize:function(){_.bindAll(this),_.defaults(this.options,this.defaults()),this.collection=new e,this.render()},events:{"click .userlist-item":"onClick"},render:function(){var e,i,s,n,o,l=this.model.get("users");for(this.removeViews(),this.collection.reset(),e=0;e<l.length;e+=1)i=l[e],this.collection.add({id:i.id,user:i});for(s=this.collection.models,e=0;e!==s.length;e+=1)n=s[e],o=new t({model:n}),this.$el.append(o.render().$el),this.options.views[n.get("id")]=o},onClick:function(e){var t=$(e.currentTarget).data("id"),s=this.collection.get(t),n=s.get("user");$(i.plugdj.chatInputField).val("@"+n.username+" ").focus()},removeViews:function(){var e,t=this.options.views;for(e in t)t.hasOwnProperty(e)&&t[e].close()},close:function(){var e;this.remove(),this.collection.reset();for(e in this.views)this.views.hasOwnProperty(e)&&this.views[e].close()}});return s}),define("Plugbot/views/Userlist/View",["handlebars","Plugbot/models/Userlist/Model","Plugbot/utils/APIBuffer","Plugbot/views/layout/TableLayout","Plugbot/views/Userlist/HeadView","Plugbot/views/Userlist/UsersView"],function(e,t,i,s,n,o){"use strict";var l=Backbone.View.extend({defaults:function(){return{modWindow:void 0,dispatcherWindow:void 0,renderOverElapsed:5,pendingRenderHead:!1,pendingRenderList:!1,tableLayout:void 0,viewHead:void 0,viewList:void 0}},model:new t,initialize:function(){_.bindAll(this),_.defaults(this.options,this.defaults()),this.listenToAPI()},elHead:".head",elWrapList:".wrap-list",elList:".list",template:e.compile('    <div class="row-head">    <div class="{{getName classHead}}"></div></div><div class="row-list">    <div class="{{getName classWrapList}}">        <ul class="{{getName classList}}"></ul>    </div></div>'),render:function(){return this.model.updateAll(),this.$el.html(this.template({classHead:this.elHead,classWrapList:this.elWrapList,classList:this.elList})),this.$el.addClass("scheme-default-plugbot-userlist"),this.options.tableLayout=new s({el:this.$el,display:"column",classes:["row-head","row-list"],values:[0,0],styles:["auto","?"],grows:[0,1]}),this.options.modWindow.set("tableLayout",this.options.tableLayout),this.options.viewHead=new n({model:this.model,el:this.$(this.elHead)}),this.options.viewList=new o({model:this.model,el:this.$(this.elList)}),this.options.tableLayout.render(),this.options.viewHead.render(),this.options.viewList.render(),this.options.tableLayout.resize(),this.listenToWindow(),this},renderHead:function(){return this.model.updateWaitList(),this.options.viewHead.render(),this.options.pendingRenderHead=!1,this},renderList:function(){return this.model.updateUsers(),this.options.viewList.render(),this.options.pendingRenderList=!1,this},listenToAPI:function(){var e=this,t=this.model.cid,s=function(t){var i;if(e.options.modWindow.get("visible"))i=API.getTimeElapsed()>=e.options.renderOverElapsed?!0:!1;else{switch(t){case"head":e.options.pendingRenderHead=!0;break;case"list":e.options.pendingRenderList=!0}i=!1}return i};i.addListening("head-"+t,this,[API.WAIT_LIST_UPDATE,API.DJ_UPDATE],{fnCheck:function(){return s("head")},callback:this.renderHead}),i.addListening("list-"+t,this,[API.VOTE_UPDATE,API.USER_JOIN,API.USER_LEAVE],{fnCheck:function(){return s("list")},callback:this.renderList})},listenToWindow:function(){var e=this,t=this.options.modWindow,i=this.options.dispatcherWindow;this.listenTo(t,"change:visible",function(){t.get("visible")&&(e.updateUsersRearSpace(),e.options.pendingRenderHead&&e.renderHead(),e.options.pendingRenderList&&e.renderList())}),this.listenTo(i,i.AFTER_RENDER,function(){e.updateUsersRearSpace()}).listenTo(i,i.RESIZE_NOW,function(){e.updateUsersRearSpace()}).listenTo(i,i.RESIZE_START,function(){e.updateUsersRearSpace()})},updateUsersRearSpace:function(){var e=this.$(this.elWrapList),t=this.$(this.elList);t.css("padding-bottom",.5*e.height())},close:function(){this.remove(),this.options.tableLayout.close(),this.options.viewHead.close(),this.options.viewList.close()}});return l}),define("Plugbot/views/utils/Ui",[],function(){"use strict";var e={header:"#header",room:"#room",playback:"#playback",playlistPanel:"#playlist-panel",chatInputField:"#chat-input-field",woot:"#woot"},t={mainUi:".plugbot-ui",userlist:".plugbot-userlist"};return{plugdj:e,plugbot:t}}),define("Plugbot/views/utils/UiHelpers",["Plugbot/utils/Watcher"],function(e){"use strict";function t(e){var t;return t="#"===e[0]?e.substr(1):null}function i(e){var t;return t="."===e[0]?e.substr(1):null}function s(e,t){var i;switch(t){case"width":i=e.outerWidth()-e.innerWidth();break;case"height":i=e.outerHeight()-e.innerHeight();break;case"both":i={width:e.outerWidth()-e.innerWidth(),height:e.outerHeight()-e.innerHeight()}}return i}function n(e,t){var i;switch(t){case"width":i=e.innerWidth()-e.width();break;case"height":i=e.innerWidth()-e.width();break;case"both":i={width:e.innerWidth()-e.width(),height:e.innerWidth()-e.width()}}return i}function o(e,t){var i;switch(t){case"width":i=e.outerWidth(!0)-e.outerWidth();break;case"height":i=e.outerHeight(!0)-e.outerWidth();break;case"both":i={width:e.outerWidth(!0)-e.outerWidth(),height:e.outerHeight(!0)-e.outerWidth()}}return i}function l(e,t){var i,s,o=e.children();switch(t){case"width":s=n(e,"width");break;case"height":s=n(e,"height");break;case"both":s={width:n(e,"width"),height:n(e,"height")}}for(i=0;i!==o.length;i+=1)switch(t){case"width":s+=o[i].outerWidth(!0);break;case"height":s+=o[i].outerHeight(!0);break;case"both":s.width+=o[i].outerWidth(!0),s.height+=o[i].outerHeight(!0)}return s}function a(e,t,i){0===i?t.prepend(e):t.children().eq(i-1).after(e)}function r(e,t,i,s,n){var o=e.outerWidth(!0)-e.width(),l=e.outerHeight(!0)-e.height();switch(s=s||0,n=n||0,i){case"width":e.width(t.width()-o+s);break;case"height":e.height(t.height()-l+n);break;case"both":e.width(t.width()-o+s),e.height(t.height()-l+n)}}function d(e){var t,i=null;return t=e.next(),0===t.length&&(i=e.parent()),e=e.detach(),{elem:e,nextSibling:t,parent:i}}function u(e){null===e.parent?e.nextSibling.before(e.elem):e.parent.append(e.elem)}function c(t){var i=t.css("pointer-events"),s=new e,n=function(e){return 0===e.length?0:(e.css("pointer-events","none"),1)};return s.add("iframe-fix",{call:n,args:[t]}),n(t),{watcher:s,iframe:t,oriPointerEvents:i}}function h(e){e.iframe.css("pointer-events",e.oriPointerEvents),e.watcher.close()}return{getId:t,getClass:i,getBorder:s,getPadding:n,getMargin:o,getMinFloatSize:l,insertAt:a,fitElement:r,detach:d,reattach:u,iframeFix:c,removeIframeFix:h}});
//# sourceMappingURL=release.min.js.map